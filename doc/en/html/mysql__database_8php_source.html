<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ultimix: G:/projects/webdev/wwwroot/ultimix/packages/database/packages/mysql_database/mysql_database.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>G:/projects/webdev/wwwroot/ultimix/packages/database/packages/mysql_database/mysql_database.php</h1>  </div>
</div>
<div class="contents">
<a href="mysql__database_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003       <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment">      *     This source code is a part of the Ultimix Project. </span>
<a name="l00005"></a>00005 <span class="comment">      *     It is distributed under BSD license. All other third side source code (like tinyMCE) is distributed under </span>
<a name="l00006"></a>00006 <span class="comment">      *     it&#39;s own license wich could be found from the corresponding files or sources. </span>
<a name="l00007"></a>00007 <span class="comment">      *     This source code is provided &quot;as is&quot; without any warranties or garanties.</span>
<a name="l00008"></a>00008 <span class="comment">      *</span>
<a name="l00009"></a>00009 <span class="comment">      *     Have a nice day!</span>
<a name="l00010"></a>00010 <span class="comment">      *</span>
<a name="l00011"></a>00011 <span class="comment">      *     @url http://ultimix.sorceforge.net</span>
<a name="l00012"></a>00012 <span class="comment">      *</span>
<a name="l00013"></a>00013 <span class="comment">      *     @author Alexey &quot;gdever&quot; Dodonov</span>
<a name="l00014"></a>00014 <span class="comment">      */</span>
<a name="l00015"></a>00015       
<a name="l00026"></a><a class="code" href="classmysql__database__1__0__0.html">00026</a>       <span class="keyword">class </span><a class="code" href="classmysql__database__1__0__0.html">mysql_database_1_0_0</a>{
<a name="l00027"></a>00027             
<a name="l00038"></a><a class="code" href="classmysql__database__1__0__0.html#ad9cee0c7bf95f6b992fdd7b162d3c45d">00038</a>             var                           <a class="code" href="classmysql__database__1__0__0.html#ad9cee0c7bf95f6b992fdd7b162d3c45d">$Connection</a> = <span class="keyword">false</span>;
<a name="l00039"></a>00039             
<a name="l00050"></a><a class="code" href="classmysql__database__1__0__0.html#a29b06261b060cbd416e401a241d76013">00050</a>             <span class="keyword">static</span>                        <a class="code" href="classmysql__database__1__0__0.html#a29b06261b060cbd416e401a241d76013">$LockedTables</a> = <span class="keyword">false</span>;
<a name="l00051"></a>00051             
<a name="l00062"></a><a class="code" href="classmysql__database__1__0__0.html#a108dcfbbef135f73e8533a4888ab42a6">00062</a>             <span class="keyword">static</span>                        <a class="code" href="classmysql__database__1__0__0.html#a108dcfbbef135f73e8533a4888ab42a6">$LockModes</a> = <span class="keyword">false</span>;
<a name="l00063"></a>00063             
<a name="l00076"></a><a class="code" href="classmysql__database__1__0__0.html#aa2a8d02af0698b6bbeeddf18878e3487">00076</a>             <span class="keyword">static</span>                        <a class="code" href="classmysql__database__1__0__0.html#aa2a8d02af0698b6bbeeddf18878e3487">$QueryMode</a> = DB_ASSOC_ARRAY;
<a name="l00077"></a>00077             
<a name="l00088"></a><a class="code" href="classmysql__database__1__0__0.html#ad019d6ecb4db4cd981fb7aeae7fbfc2c">00088</a>             var                           <a class="code" href="classmysql__database__1__0__0.html#ad019d6ecb4db4cd981fb7aeae7fbfc2c">$Host</a>;
<a name="l00089"></a><a class="code" href="classmysql__database__1__0__0.html#a0e2ea0d42b9b800eb5bf8660587f5f7f">00089</a>             var                           <a class="code" href="classmysql__database__1__0__0.html#a0e2ea0d42b9b800eb5bf8660587f5f7f">$Username</a>;
<a name="l00090"></a><a class="code" href="classmysql__database__1__0__0.html#ae3ac8512c0fd8924c7112671ead08cf7">00090</a>             var                           <a class="code" href="classmysql__database__1__0__0.html#ae3ac8512c0fd8924c7112671ead08cf7">$Password</a>;
<a name="l00091"></a><a class="code" href="classmysql__database__1__0__0.html#ae10cc045c1502f148d1aa728183898e7">00091</a>             var                           <a class="code" href="classmysql__database__1__0__0.html#ae10cc045c1502f148d1aa728183898e7">$Database</a>;
<a name="l00092"></a><a class="code" href="classmysql__database__1__0__0.html#acf6482d64a97f1ecd87f69e707e0e72f">00092</a>             var                           <a class="code" href="classmysql__database__1__0__0.html#acf6482d64a97f1ecd87f69e707e0e72f">$TablenamePrefix</a>;
<a name="l00093"></a>00093             
<a name="l00112"></a><a class="code" href="classmysql__database__1__0__0.html#a0e96e5dadb8bce1c610ccd99dd2a134d">00112</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a0e96e5dadb8bce1c610ccd99dd2a134d">connect</a>( $ConfigRow )
<a name="l00113"></a>00113             {
<a name="l00114"></a>00114                   <span class="keywordflow">try</span>
<a name="l00115"></a>00115                   {
<a name="l00116"></a>00116                         $Config = explode( <span class="stringliteral">&quot;#&quot;</span> , $ConfigRow );
<a name="l00117"></a>00117                         $this-&gt;Host = $Config[ 0 ];
<a name="l00118"></a>00118                         $this-&gt;Username = $Config[ 1 ];
<a name="l00119"></a>00119                         $this-&gt;Password = $Config[ 2 ];
<a name="l00120"></a>00120                         $this-&gt;Database = $Config[ 3 ];
<a name="l00121"></a>00121                         $this-&gt;TablenamePrefix = $Config[ 4 ];
<a name="l00122"></a>00122                         
<a name="l00123"></a>00123                         $this-&gt;Connection = @<span class="keyword">new</span> mysqli( $this-&gt;Host , $this-&gt;Username , $this-&gt;Password , $this-&gt;Database );
<a name="l00124"></a>00124                   }
<a name="l00125"></a>00125                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00126"></a>00126                   {
<a name="l00127"></a>00127                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00128"></a>00128                   }
<a name="l00129"></a>00129             }
<a name="l00130"></a>00130             
<a name="l00151"></a><a class="code" href="classmysql__database__1__0__0.html#ac26e3605b8df54586a080a47df7f3a95">00151</a>             function                <a class="code" href="classmysql__database__1__0__0.html#ac26e3605b8df54586a080a47df7f3a95">get_connection</a>( $ForceReconnect = <span class="keyword">false</span> )
<a name="l00152"></a>00152             {
<a name="l00153"></a>00153                   <span class="keywordflow">try</span>
<a name="l00154"></a>00154                   {
<a name="l00155"></a>00155                         <span class="keywordflow">if</span>( $this-&gt;Connection === <span class="keyword">false</span> || $ForceReconnect === <span class="keyword">true</span> )
<a name="l00156"></a>00156                         {
<a name="l00157"></a>00157                               <span class="keywordflow">if</span>( $this-&gt;Connection !== <span class="keyword">false</span> )
<a name="l00158"></a>00158                               {
<a name="l00159"></a>00159                                     $this-&gt;Connection-&gt;close();
<a name="l00160"></a>00160                               }
<a name="l00161"></a>00161                               $DBConfigSet = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;database::db_config_set&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00162"></a>00162                               $DBConfigSet-&gt;load_config( dirname( __FILE__ ).<span class="stringliteral">&#39;/conf/cf_mysql_database&#39;</span> );
<a name="l00163"></a>00163                               $this-&gt;Connection = $DBConfigSet-&gt;connect( $this );
<a name="l00164"></a>00164 
<a name="l00165"></a>00165                               <span class="keywordflow">if</span>( mysqli_connect_error() )
<a name="l00166"></a>00166                               {
<a name="l00167"></a>00167                                     <span class="keywordflow">throw</span>( 
<a name="l00168"></a>00168                                           <span class="keyword">new</span> Exception( 
<a name="l00169"></a>00169                                                 <span class="stringliteral">&#39;An error occured while setting connection to the database &#39;</span>.mysqli_connect_error()
<a name="l00170"></a>00170                                           )
<a name="l00171"></a>00171                                     );
<a name="l00172"></a>00172                               }
<a name="l00173"></a>00173                               
<a name="l00174"></a>00174                               $this-&gt;Connection-&gt;query( <span class="stringliteral">&#39;SET AUTOCOMMIT = 0&#39;</span> );
<a name="l00175"></a>00175                               $this-&gt;Connection-&gt;query( <span class="stringliteral">&#39;SET NAMES utf8&#39;</span> );
<a name="l00176"></a>00176                         }
<a name="l00177"></a>00177                         <span class="keywordflow">return</span>( $this-&gt;Connection );
<a name="l00178"></a>00178                   }
<a name="l00179"></a>00179                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00180"></a>00180                   {
<a name="l00181"></a>00181                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00182"></a>00182                   }
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184             
<a name="l00205"></a><a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">00205</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( $Query )
<a name="l00206"></a>00206             {
<a name="l00207"></a>00207                   <span class="keywordflow">try</span>
<a name="l00208"></a>00208                   {
<a name="l00209"></a>00209                         <a class="code" href="classmysql__database__1__0__0.html#ad9cee0c7bf95f6b992fdd7b162d3c45d">$Connection</a> = $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#ac26e3605b8df54586a080a47df7f3a95">get_connection</a>();
<a name="l00210"></a>00210                         
<a name="l00211"></a>00211                         $Query = str_replace( <span class="stringliteral">&#39;umx_&#39;</span> , $this-&gt;TablenamePrefix , $Query );
<a name="l00212"></a>00212                   
<a name="l00213"></a>00213                         $Result = <a class="code" href="classmysql__database__1__0__0.html#ad9cee0c7bf95f6b992fdd7b162d3c45d">$Connection</a>-&gt;query( $Query );
<a name="l00214"></a>00214                         
<a name="l00215"></a>00215                         <span class="keywordflow">if</span>( <a class="code" href="classmysql__database__1__0__0.html#ad9cee0c7bf95f6b992fdd7b162d3c45d">$Connection</a>-&gt;errno !== 0 )
<a name="l00216"></a>00216                         {
<a name="l00217"></a>00217                               <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&#39;An error occured while query execution &#39;</span>.<a class="code" href="classmysql__database__1__0__0.html#ad9cee0c7bf95f6b992fdd7b162d3c45d">$Connection</a>-&gt;error ) );
<a name="l00218"></a>00218                         }
<a name="l00219"></a>00219                         
<a name="l00220"></a>00220                         <span class="keywordflow">return</span>( $Result );
<a name="l00221"></a>00221                   }
<a name="l00222"></a>00222                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00223"></a>00223                   {
<a name="l00224"></a>00224                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00225"></a>00225                   }
<a name="l00226"></a>00226             }
<a name="l00227"></a>00227             
<a name="l00246"></a><a class="code" href="classmysql__database__1__0__0.html#adf105fb130a7bcf91a218cb71383b763">00246</a>             function                <a class="code" href="classmysql__database__1__0__0.html#adf105fb130a7bcf91a218cb71383b763">query_as</a>( $theQueryMode )
<a name="l00247"></a>00247             {
<a name="l00248"></a>00248                   <span class="keywordflow">try</span>
<a name="l00249"></a>00249                   {
<a name="l00250"></a>00250                         self::$QueryMode = $theQueryMode;
<a name="l00251"></a>00251                   }
<a name="l00252"></a>00252                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00253"></a>00253                   {
<a name="l00254"></a>00254                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00255"></a>00255                   }
<a name="l00256"></a>00256             }
<a name="l00257"></a>00257             
<a name="l00288"></a><a class="code" href="classmysql__database__1__0__0.html#af4ba8b7dff98b096f3ffa9548ad7118c">00288</a>             function                <a class="code" href="classmysql__database__1__0__0.html#af4ba8b7dff98b096f3ffa9548ad7118c">select</a>( $What , $Tables , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l00289"></a>00289             {
<a name="l00290"></a>00290                   <span class="keywordflow">try</span>
<a name="l00291"></a>00291                   {
<a name="l00292"></a>00292                         $Result = $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;SELECT $What FROM $Tables WHERE $Condition&quot;</span> );
<a name="l00293"></a>00293 
<a name="l00294"></a>00294                         <span class="keywordflow">return</span>( $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a13280dd843e6580477936a03fc0ef733">fetch_results</a>( $Result ) );
<a name="l00295"></a>00295                   }
<a name="l00296"></a>00296                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00297"></a>00297                   {
<a name="l00298"></a>00298                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00299"></a>00299                   }
<a name="l00300"></a>00300             }
<a name="l00301"></a>00301             
<a name="l00324"></a><a class="code" href="classmysql__database__1__0__0.html#a13280dd843e6580477936a03fc0ef733">00324</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a13280dd843e6580477936a03fc0ef733">fetch_results</a>( $Result )
<a name="l00325"></a>00325             {
<a name="l00326"></a>00326                   <span class="keywordflow">try</span>
<a name="l00327"></a>00327                   {                       
<a name="l00328"></a>00328                         $RetValues = array();
<a name="l00329"></a>00329                               
<a name="l00330"></a>00330                         <span class="keywordflow">for</span>( $i = 0; $i &lt; $Result-&gt;num_rows ; $i++ )
<a name="l00331"></a>00331                         {
<a name="l00332"></a>00332                               <span class="keywordflow">if</span>( self::$QueryMode == <a class="code" href="database_8php.html#ab95b6141e90427e28cc6d7c10f1705b3">DB_ASSOC_ARRAY</a> )
<a name="l00333"></a>00333                               {
<a name="l00334"></a>00334                                     $RetValues [] = $Result-&gt;fetch_array( MYSQLI_ASSOC );
<a name="l00335"></a>00335                               }
<a name="l00336"></a>00336                               elseif( self::$QueryMode == <a class="code" href="database_8php.html#a7178cd508a7b1efd29c30c8f680dfaeb">DB_ARRAY</a> )
<a name="l00337"></a>00337                               {
<a name="l00338"></a>00338                                     $RetValues [] = $Result-&gt;fetch_array( MYSQLI_NUM );
<a name="l00339"></a>00339                               }
<a name="l00340"></a>00340                               elseif( self::$QueryMode == <a class="code" href="database_8php.html#acaeb4240927648affc96a96788ea2b26">DB_OBJECT</a> )
<a name="l00341"></a>00341                               {
<a name="l00342"></a>00342                                     $RetValues [] = $Result-&gt;fetch_object();
<a name="l00343"></a>00343                               }
<a name="l00344"></a>00344                         }
<a name="l00345"></a>00345                               
<a name="l00346"></a>00346                         $Result-&gt;close();
<a name="l00347"></a>00347 
<a name="l00348"></a>00348                         <span class="keywordflow">return</span>( $RetValues );
<a name="l00349"></a>00349                   }
<a name="l00350"></a>00350                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00351"></a>00351                   {
<a name="l00352"></a>00352                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00353"></a>00353                   }
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355             
<a name="l00382"></a><a class="code" href="classmysql__database__1__0__0.html#ace8196a67308124a7cbf3dfe3f877881">00382</a>             function                <a class="code" href="classmysql__database__1__0__0.html#ace8196a67308124a7cbf3dfe3f877881">insert</a>( $Table , $Fields , $Values )
<a name="l00383"></a>00383             {
<a name="l00384"></a>00384                   <span class="keywordflow">try</span>
<a name="l00385"></a>00385                   {
<a name="l00386"></a>00386                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;INSERT INTO $Table ( $Fields ) VALUES ( $Values )&quot;</span> );
<a name="l00387"></a>00387                   }
<a name="l00388"></a>00388                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00389"></a>00389                   {
<a name="l00390"></a>00390                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00391"></a>00391                   }
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393             
<a name="l00416"></a><a class="code" href="classmysql__database__1__0__0.html#a45afb41c468a328d9778e8e6b0c846c4">00416</a>             function                <span class="keyword">delete</span>( $Table , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l00417"></a>00417             {
<a name="l00418"></a>00418                   <span class="keywordflow">try</span>
<a name="l00419"></a>00419                   {
<a name="l00420"></a>00420                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;DELETE FROM $Table WHERE $Condition&quot;</span> );
<a name="l00421"></a>00421                   }
<a name="l00422"></a>00422                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00423"></a>00423                   {
<a name="l00424"></a>00424                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00425"></a>00425                   }
<a name="l00426"></a>00426             }
<a name="l00427"></a>00427             
<a name="l00458"></a><a class="code" href="classmysql__database__1__0__0.html#a3e84056248d9894f143cb7b360d167de">00458</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a3e84056248d9894f143cb7b360d167de">update</a>( $Table , $Fields , $Values , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l00459"></a>00459             {
<a name="l00460"></a>00460                   <span class="keywordflow">try</span>
<a name="l00461"></a>00461                   {
<a name="l00462"></a>00462                         $SubQuery = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00463"></a>00463                         
<a name="l00464"></a>00464                         <span class="keywordflow">for</span>( $i = 0 ; $i &lt; count( $Fields ) - 1 ; $i++ )
<a name="l00465"></a>00465                         {
<a name="l00466"></a>00466                               $SubQuery .= $Fields[ $i ].<span class="stringliteral">&#39; = &#39;</span>.$Values[ $i ].<span class="stringliteral">&#39; , &#39;</span>;
<a name="l00467"></a>00467                         }
<a name="l00468"></a>00468                         $SubQuery .= $Fields[ count( $Fields ) - 1 ].<span class="stringliteral">&#39; = &#39;</span>.$Values[ count( $Fields ) - 1 ];
<a name="l00469"></a>00469                         
<a name="l00470"></a>00470                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;UPDATE $Table SET $SubQuery WHERE $Condition&quot;</span> );
<a name="l00471"></a>00471                   }
<a name="l00472"></a>00472                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00473"></a>00473                   {
<a name="l00474"></a>00474                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00475"></a>00475                   }
<a name="l00476"></a>00476             }
<a name="l00477"></a>00477             
<a name="l00500"></a><a class="code" href="classmysql__database__1__0__0.html#a31e6529ed04211e9b1b4b808446af47a">00500</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a31e6529ed04211e9b1b4b808446af47a">create</a>( $Table , $FirstIndexField = <span class="stringliteral">&#39;id&#39;</span> )
<a name="l00501"></a>00501             {
<a name="l00502"></a>00502                   <span class="keywordflow">try</span>
<a name="l00503"></a>00503                   {
<a name="l00504"></a>00504                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( 
<a name="l00505"></a>00505                               <span class="stringliteral">&quot;CREATE TABLE `$Table` ( `$FirstIndexField` INTEGER UNSIGNED NOT NULL DEFAULT NULL &quot;</span>.
<a name="l00506"></a>00506                                     <span class="stringliteral">&quot;AUTO_INCREMENT , PRIMARY KEY ( `$FirstIndexField` ) )&quot;</span>
<a name="l00507"></a>00507                         );
<a name="l00508"></a>00508                   }
<a name="l00509"></a>00509                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00510"></a>00510                   {
<a name="l00511"></a>00511                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00512"></a>00512                   }
<a name="l00513"></a>00513             }
<a name="l00514"></a>00514             
<a name="l00533"></a><a class="code" href="classmysql__database__1__0__0.html#aa781c13ec985a57829a2c7b2c1298d02">00533</a>             function                <a class="code" href="classmysql__database__1__0__0.html#aa781c13ec985a57829a2c7b2c1298d02">drop</a>( $Table )
<a name="l00534"></a>00534             {
<a name="l00535"></a>00535                   <span class="keywordflow">try</span>
<a name="l00536"></a>00536                   {
<a name="l00537"></a>00537                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;DROP TABLE $Table&quot;</span> );
<a name="l00538"></a>00538                   }
<a name="l00539"></a>00539                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00540"></a>00540                   {
<a name="l00541"></a>00541                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00542"></a>00542                   }
<a name="l00543"></a>00543             }
<a name="l00544"></a>00544             
<a name="l00575"></a><a class="code" href="classmysql__database__1__0__0.html#aae9890f7d450e4b9e346fd620660990f">00575</a>             function                <a class="code" href="classmysql__database__1__0__0.html#aae9890f7d450e4b9e346fd620660990f">add_column</a>( $Table , $ColumnName , $Type , $Mode = <span class="stringliteral">&#39;NOT NULL AFTER `id`&#39;</span> )
<a name="l00576"></a>00576             {
<a name="l00577"></a>00577                   <span class="keywordflow">try</span>
<a name="l00578"></a>00578                   {
<a name="l00579"></a>00579                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;ALTER TABLE `$Table` ADD COLUMN `$ColumnName` $Type $Mode&quot;</span> );
<a name="l00580"></a>00580                   }
<a name="l00581"></a>00581                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00582"></a>00582                   {
<a name="l00583"></a>00583                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00584"></a>00584                   }
<a name="l00585"></a>00585             }
<a name="l00586"></a>00586             
<a name="l00609"></a><a class="code" href="classmysql__database__1__0__0.html#a91a17d943d9065bae6c6f65aa292fa1b">00609</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a91a17d943d9065bae6c6f65aa292fa1b">drop_column</a>( $Table , $ColumnName )
<a name="l00610"></a>00610             {
<a name="l00611"></a>00611                   <span class="keywordflow">try</span>
<a name="l00612"></a>00612                   {
<a name="l00613"></a>00613                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&quot;ALTER TABLE `$Table` DROP COLUMN `$ColumnName`&quot;</span> );
<a name="l00614"></a>00614                   }
<a name="l00615"></a>00615                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00616"></a>00616                   {
<a name="l00617"></a>00617                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00618"></a>00618                   }
<a name="l00619"></a>00619             }
<a name="l00620"></a>00620             
<a name="l00643"></a><a class="code" href="classmysql__database__1__0__0.html#a08fa863205708a7368fdd84a2c625d81">00643</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a08fa863205708a7368fdd84a2c625d81">initial_lock</a>( $Tables , $Modes )
<a name="l00644"></a>00644             {
<a name="l00645"></a>00645                   <span class="keywordflow">try</span>
<a name="l00646"></a>00646                   {
<a name="l00647"></a>00647                         $QueryPart = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00648"></a>00648                         
<a name="l00651"></a>00651                         <span class="keywordflow">for</span>( $i = 0 ; $i &lt; count( $Tables ) - 1 ; $i++ )
<a name="l00652"></a>00652                         {
<a name="l00653"></a>00653                               $QueryPart .= $Tables[ $i ].<span class="charliteral">&#39; &#39;</span>.$Modes[ $i ].<span class="stringliteral">&#39;, &#39;</span>;
<a name="l00654"></a>00654                         }
<a name="l00655"></a>00655                         $QueryPart .= $Tables[ count( $Tables ) - 1 ].<span class="charliteral">&#39; &#39;</span>.$Modes[ count( $Tables ) - 1 ];
<a name="l00656"></a>00656                         
<a name="l00657"></a>00657                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&#39;LOCK TABLES &#39;</span>.$QueryPart );
<a name="l00658"></a>00658                         
<a name="l00659"></a>00659                         self::$LockedTables = $Tables;
<a name="l00660"></a>00660                         self::$LockModes = $Modes;
<a name="l00661"></a>00661                   }
<a name="l00662"></a>00662                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00663"></a>00663                   {
<a name="l00664"></a>00664                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00665"></a>00665                   }
<a name="l00666"></a>00666             }
<a name="l00667"></a>00667             
<a name="l00694"></a><a class="code" href="classmysql__database__1__0__0.html#a0568ba3d540c9c30d14493570d099446">00694</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a0568ba3d540c9c30d14493570d099446">try_lock_table</a>( $Tables , $Modes , $i )
<a name="l00695"></a>00695             {
<a name="l00696"></a>00696                   <span class="keywordflow">try</span>
<a name="l00697"></a>00697                   {
<a name="l00698"></a>00698                         $Key = array_search( $Tables[ $i ] , self::$LockedTables );
<a name="l00699"></a>00699                                     
<a name="l00700"></a>00700                         <span class="keywordflow">if</span>( $Key === <span class="keyword">false</span> )
<a name="l00701"></a>00701                         {
<a name="l00702"></a>00702                               <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&quot;Lock tables error. Invalid lock logic.&quot;</span> ) );
<a name="l00703"></a>00703                         }
<a name="l00704"></a>00704                         <span class="keywordflow">if</span>( self::$LockedTables[ $Key ] == <span class="stringliteral">&#39;WRITE&#39;</span> )
<a name="l00705"></a>00705                         {
<a name="l00706"></a>00706                               <span class="comment">/* nop */</span>
<a name="l00707"></a>00707                         }
<a name="l00708"></a>00708                         <span class="keywordflow">else</span>
<a name="l00709"></a>00709                         {
<a name="l00712"></a>00712                               <span class="keywordflow">if</span>( $Modes[ $i ] === <span class="stringliteral">&#39;WRITE&#39;</span> &amp;&amp; self::$LockModes[ $Key ] === <span class="stringliteral">&#39;READ&#39;</span> )
<a name="l00713"></a>00713                               {
<a name="l00714"></a>00714                                     <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&quot;Lock tables error. Invalid lock mode logic.&quot;</span> ) );
<a name="l00715"></a>00715                               }
<a name="l00716"></a>00716                         }
<a name="l00717"></a>00717                   }
<a name="l00718"></a>00718                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00719"></a>00719                   {
<a name="l00720"></a>00720                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00721"></a>00721                   }
<a name="l00722"></a>00722             }
<a name="l00723"></a>00723             
<a name="l00746"></a><a class="code" href="classmysql__database__1__0__0.html#a85c4301faecdaf42f198bfe05d87d503">00746</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a85c4301faecdaf42f198bfe05d87d503">lock</a>( $Tables , $Modes )
<a name="l00747"></a>00747             {
<a name="l00748"></a>00748                   <span class="keywordflow">try</span>
<a name="l00749"></a>00749                   {
<a name="l00750"></a>00750                         <span class="keywordflow">if</span>( self::$LockedTables === <span class="keyword">false</span> )
<a name="l00751"></a>00751                         {
<a name="l00752"></a>00752                               $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a08fa863205708a7368fdd84a2c625d81">initial_lock</a>( $Tables , $Modes );
<a name="l00753"></a>00753                         }
<a name="l00754"></a>00754                         <span class="keywordflow">else</span>
<a name="l00755"></a>00755                         {
<a name="l00758"></a>00758                               <span class="keywordflow">for</span>( $i = 0 ; $i &lt; count( $Tables ) ; $i++ )
<a name="l00759"></a>00759                               {
<a name="l00760"></a>00760                                     $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a0568ba3d540c9c30d14493570d099446">try_lock_table</a>( $Tables , $Modes , $i );
<a name="l00761"></a>00761                               }
<a name="l00762"></a>00762                         }
<a name="l00763"></a>00763                   }
<a name="l00764"></a>00764                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00765"></a>00765                   {
<a name="l00766"></a>00766                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00767"></a>00767                   }
<a name="l00768"></a>00768             }
<a name="l00769"></a>00769             
<a name="l00784"></a><a class="code" href="classmysql__database__1__0__0.html#afb061ecbff1e66db62b9eddfea6e915f">00784</a>             function                <a class="code" href="classmysql__database__1__0__0.html#afb061ecbff1e66db62b9eddfea6e915f">unlock</a>()
<a name="l00785"></a>00785             {
<a name="l00786"></a>00786                   <span class="keywordflow">try</span>
<a name="l00787"></a>00787                   {
<a name="l00788"></a>00788                         self::$LockedTables = <span class="keyword">false</span>;
<a name="l00789"></a>00789                         self::$LockModes = <span class="keyword">false</span>;
<a name="l00790"></a>00790                         
<a name="l00791"></a>00791                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&#39;UNLOCK TABLES&#39;</span> );
<a name="l00792"></a>00792                   }
<a name="l00793"></a>00793                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00794"></a>00794                   {
<a name="l00795"></a>00795                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00796"></a>00796                   }
<a name="l00797"></a>00797             }
<a name="l00798"></a>00798             
<a name="l00817"></a><a class="code" href="classmysql__database__1__0__0.html#a747ff948167d2a17416a7ed9a144a53a">00817</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a747ff948167d2a17416a7ed9a144a53a">savepoint</a>( $Savepoint )
<a name="l00818"></a>00818             {
<a name="l00819"></a>00819                   <span class="keywordflow">try</span>
<a name="l00820"></a>00820                   {
<a name="l00821"></a>00821                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&#39;SAVEPOINT &#39;</span>.$Savepoint );
<a name="l00822"></a>00822                   }
<a name="l00823"></a>00823                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00824"></a>00824                   {
<a name="l00825"></a>00825                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00826"></a>00826                   }
<a name="l00827"></a>00827             }
<a name="l00828"></a>00828             
<a name="l00847"></a><a class="code" href="classmysql__database__1__0__0.html#ad7b7e0fb9407e143ab7b0bcd8f9fa20e">00847</a>             function                <a class="code" href="classmysql__database__1__0__0.html#ad7b7e0fb9407e143ab7b0bcd8f9fa20e">rollback</a>( $Savepoint )
<a name="l00848"></a>00848             {
<a name="l00849"></a>00849                   <span class="keywordflow">try</span>
<a name="l00850"></a>00850                   {
<a name="l00851"></a>00851                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&#39;ROLLBACK TO SAVEPOINT &#39;</span>.$Savepoint );
<a name="l00852"></a>00852                   }
<a name="l00853"></a>00853                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00854"></a>00854                   {
<a name="l00855"></a>00855                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00856"></a>00856                   }
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858             
<a name="l00873"></a><a class="code" href="classmysql__database__1__0__0.html#a6f5e7602837a6f85fcb02751c073b181">00873</a>             function                <a class="code" href="classmysql__database__1__0__0.html#a6f5e7602837a6f85fcb02751c073b181">transaction</a>()
<a name="l00874"></a>00874             {
<a name="l00875"></a>00875                   <span class="keywordflow">try</span>
<a name="l00876"></a>00876                   {
<a name="l00877"></a>00877                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&#39;START TRANSACTION&#39;</span> );
<a name="l00878"></a>00878                   }
<a name="l00879"></a>00879                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00880"></a>00880                   {
<a name="l00881"></a>00881                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00882"></a>00882                   }
<a name="l00883"></a>00883             }
<a name="l00884"></a>00884             
<a name="l00899"></a><a class="code" href="classmysql__database__1__0__0.html#af5674c27d4a92f6228565010eacbb9cb">00899</a>             function                <a class="code" href="classmysql__database__1__0__0.html#af5674c27d4a92f6228565010eacbb9cb">commit</a>()
<a name="l00900"></a>00900             {
<a name="l00901"></a>00901                   <span class="keywordflow">try</span>
<a name="l00902"></a>00902                   {
<a name="l00903"></a>00903                         $this-&gt;<a class="code" href="classmysql__database__1__0__0.html#a6b5765262de7bbecc5aab15ec52c101a">query</a>( <span class="stringliteral">&#39;COMMIT&#39;</span> );
<a name="l00904"></a>00904                   }
<a name="l00905"></a>00905                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00906"></a>00906                   {
<a name="l00907"></a>00907                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00908"></a>00908                   }
<a name="l00909"></a>00909             }
<a name="l00910"></a>00910       }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Oct 3 2011 14:49:47 for ultimix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
