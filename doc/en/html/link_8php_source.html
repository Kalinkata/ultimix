<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ultimix: G:/projects/webdev/wwwroot/ultimix/packages/link/link.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>G:/projects/webdev/wwwroot/ultimix/packages/link/link.php</h1>  </div>
</div>
<div class="contents">
<a href="link_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003       <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment">      *     This source code is a part of the Ultimix Project. </span>
<a name="l00005"></a>00005 <span class="comment">      *     It is distributed under BSD license. All other third side source code (like tinyMCE) is distributed under </span>
<a name="l00006"></a>00006 <span class="comment">      *     it&#39;s own license wich could be found from the corresponding files or sources. </span>
<a name="l00007"></a>00007 <span class="comment">      *     This source code is provided &quot;as is&quot; without any warranties or garanties.</span>
<a name="l00008"></a>00008 <span class="comment">      *</span>
<a name="l00009"></a>00009 <span class="comment">      *     Have a nice day!</span>
<a name="l00010"></a>00010 <span class="comment">      *</span>
<a name="l00011"></a>00011 <span class="comment">      *     @url http://ultimix.sorceforge.net</span>
<a name="l00012"></a>00012 <span class="comment">      *</span>
<a name="l00013"></a>00013 <span class="comment">      *     @author Alexey &quot;gdever&quot; Dodonov</span>
<a name="l00014"></a>00014 <span class="comment">      */</span>
<a name="l00015"></a>00015       
<a name="l00026"></a><a class="code" href="classlink__1__0__0.html">00026</a>       <span class="keyword">class </span><a class="code" href="classlink__1__0__0.html">link_1_0_0</a>{
<a name="l00027"></a>00027             
<a name="l00038"></a><a class="code" href="classlink__1__0__0.html#afae1e5da4e0a35964c9b826d60f13e28">00038</a>             var                           <a class="code" href="classlink__1__0__0.html#afae1e5da4e0a35964c9b826d60f13e28">$LinkTypesDictionary</a> = <span class="keyword">false</span>;
<a name="l00039"></a>00039             
<a name="l00050"></a><a class="code" href="classlink__1__0__0.html#ae10cc045c1502f148d1aa728183898e7">00050</a>             var                           <a class="code" href="classlink__1__0__0.html#ae10cc045c1502f148d1aa728183898e7">$Database</a> = <span class="keyword">false</span>;
<a name="l00051"></a><a class="code" href="classlink__1__0__0.html#aaae5f70ebc2b60f22e8159944cd2d518">00051</a>             var                           <a class="code" href="classlink__1__0__0.html#aaae5f70ebc2b60f22e8159944cd2d518">$Security</a> = <span class="keyword">false</span>;
<a name="l00052"></a><a class="code" href="classlink__1__0__0.html#a541f49d5b9cf7bae2f91f639abcf3458">00052</a>             var                           <a class="code" href="classlink__1__0__0.html#a541f49d5b9cf7bae2f91f639abcf3458">$String</a> = <span class="keyword">false</span>;
<a name="l00053"></a><a class="code" href="classlink__1__0__0.html#a2c1da60c6cd872abbb042bcd58b7c10d">00053</a>             var                           <a class="code" href="classlink__1__0__0.html#a2c1da60c6cd872abbb042bcd58b7c10d">$Settings</a> = <span class="keyword">false</span>;
<a name="l00054"></a><a class="code" href="classlink__1__0__0.html#ad3377fd103ea8c6d35b0ee60e4e9c46d">00054</a>             var                           <a class="code" href="classlink__1__0__0.html#ad3377fd103ea8c6d35b0ee60e4e9c46d">$UserAlgorithms</a> = <span class="keyword">false</span>;
<a name="l00055"></a>00055             
<a name="l00070"></a><a class="code" href="classlink__1__0__0.html#a095c5d389db211932136b53f25f39685">00070</a>             function                <a class="code" href="classlink__1__0__0.html#a095c5d389db211932136b53f25f39685">__construct</a>()
<a name="l00071"></a>00071             {
<a name="l00072"></a>00072                   <span class="keywordflow">try</span>
<a name="l00073"></a>00073                   {
<a name="l00074"></a>00074                         $this-&gt;Database = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;database&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00075"></a>00075                         $this-&gt;Security = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;security&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00076"></a>00076                         $this-&gt;String = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;string&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00077"></a>00077                         $this-&gt;UserAlgorithms = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;user::user_algorithms&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00078"></a>00078                   }
<a name="l00079"></a>00079                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00080"></a>00080                   {
<a name="l00081"></a>00081                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00082"></a>00082                   }
<a name="l00083"></a>00083             }
<a name="l00084"></a>00084             
<a name="l00111"></a><a class="code" href="classlink__1__0__0.html#af26ecfec5774a0f6be80a79263e10407">00111</a>             function                <a class="code" href="classlink__1__0__0.html#af26ecfec5774a0f6be80a79263e10407">get_type_from_cache</a>( $Object1Type , $Object2Type )
<a name="l00112"></a>00112             {
<a name="l00113"></a>00113                   <span class="keywordflow">try</span>
<a name="l00114"></a>00114                   {
<a name="l00115"></a>00115                         $Types = array();
<a name="l00116"></a>00116                         <span class="keywordflow">foreach</span>( $this-&gt;LinkTypesDictionary as $k =&gt; $v )
<a name="l00117"></a>00117                         {
<a name="l00118"></a>00118                               <span class="keywordflow">if</span>( $Object1Type !== <span class="keyword">false</span> &amp;&amp; $v-&gt;object1_type != $Object1Type )
<a name="l00119"></a>00119                               {
<a name="l00120"></a>00120                                     <span class="keywordflow">continue</span>;
<a name="l00121"></a>00121                               }
<a name="l00122"></a>00122                               <span class="keywordflow">if</span>( $Object2Type !== <span class="keyword">false</span> &amp;&amp; $v-&gt;object2_type != $Object2Type )
<a name="l00123"></a>00123                               {
<a name="l00124"></a>00124                                     <span class="keywordflow">continue</span>;
<a name="l00125"></a>00125                               }
<a name="l00126"></a>00126                               
<a name="l00127"></a>00127                               $Types [] = $v-&gt;id;
<a name="l00128"></a>00128                         }
<a name="l00129"></a>00129                         
<a name="l00130"></a>00130                         <span class="keywordflow">if</span>( isset( $Types[ 0 ] ) )
<a name="l00131"></a>00131                         {
<a name="l00132"></a>00132                               <span class="keywordflow">return</span>( implode( <span class="charliteral">&#39;,&#39;</span> , $Types ) );
<a name="l00133"></a>00133                         }
<a name="l00134"></a>00134                         
<a name="l00135"></a>00135                         <span class="keywordflow">return</span>( <span class="keyword">false</span> );
<a name="l00136"></a>00136                   }
<a name="l00137"></a>00137                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00138"></a>00138                   {
<a name="l00139"></a>00139                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00140"></a>00140                   }
<a name="l00141"></a>00141             }
<a name="l00142"></a>00142             
<a name="l00157"></a><a class="code" href="classlink__1__0__0.html#a1d9a89a8012ae245f1438787bcec253a">00157</a>             function                <a class="code" href="classlink__1__0__0.html#a1d9a89a8012ae245f1438787bcec253a">fill_cache</a>()
<a name="l00158"></a>00158             {
<a name="l00159"></a>00159                   <span class="keywordflow">try</span>
<a name="l00160"></a>00160                   {
<a name="l00161"></a>00161                         <span class="keywordflow">if</span>( $this-&gt;LinkTypesDictionary === <span class="keyword">false</span> )
<a name="l00162"></a>00162                         {
<a name="l00163"></a>00163                               $this-&gt;Database-&gt;query_as( <a class="code" href="database_8php.html#acaeb4240927648affc96a96788ea2b26">DB_OBJECT</a> );
<a name="l00164"></a>00164                               $this-&gt;LinkTypesDictionary = $this-&gt;Database-&gt;select( <span class="charliteral">&#39;*&#39;</span> , <span class="stringliteral">&#39;umx_link_dictionary&#39;</span> , <span class="stringliteral">&quot;1 = 1&quot;</span> );
<a name="l00165"></a>00165                         }
<a name="l00166"></a>00166                   }
<a name="l00167"></a>00167                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00168"></a>00168                   {
<a name="l00169"></a>00169                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00170"></a>00170                   }
<a name="l00171"></a>00171             }
<a name="l00172"></a>00172             
<a name="l00199"></a><a class="code" href="classlink__1__0__0.html#a92a7913984cc8361f0334e68fb2319a2">00199</a>             function                <a class="code" href="classlink__1__0__0.html#a92a7913984cc8361f0334e68fb2319a2">get_type_from_db</a>( $Object1Type , $Object2Type )
<a name="l00200"></a>00200             {
<a name="l00201"></a>00201                   <span class="keywordflow">try</span>
<a name="l00202"></a>00202                   {
<a name="l00203"></a>00203                         $this-&gt;<a class="code" href="classlink__1__0__0.html#a1d9a89a8012ae245f1438787bcec253a">fill_cache</a>();
<a name="l00204"></a>00204 
<a name="l00205"></a>00205                         <span class="keywordflow">return</span>( $this-&gt;<a class="code" href="classlink__1__0__0.html#af26ecfec5774a0f6be80a79263e10407">get_type_from_cache</a>( $Object1Type , $Object2Type ) );
<a name="l00206"></a>00206                   }
<a name="l00207"></a>00207                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00208"></a>00208                   {
<a name="l00209"></a>00209                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00210"></a>00210                   }
<a name="l00211"></a>00211             }
<a name="l00212"></a>00212             
<a name="l00235"></a><a class="code" href="classlink__1__0__0.html#a2318bd82a1991bb16350b01e0584a45a">00235</a>             function                      <a class="code" href="classlink__1__0__0.html#a2318bd82a1991bb16350b01e0584a45a">create_link_type</a>( $Object1Type , $Object2Type )
<a name="l00236"></a>00236             {
<a name="l00237"></a>00237                   <span class="keywordflow">try</span>
<a name="l00238"></a>00238                   {
<a name="l00239"></a>00239                         $Object1Type = $this-&gt;Security-&gt;get( $Object1Type , <span class="stringliteral">&#39;string&#39;</span> );
<a name="l00240"></a>00240                         $Object2Type = $this-&gt;Security-&gt;get( $Object2Type , <span class="stringliteral">&#39;string&#39;</span> );
<a name="l00241"></a>00241                         
<a name="l00242"></a>00242                         $this-&gt;Database-&gt;lock( array( <span class="stringliteral">&#39;umx_link_dictionary&#39;</span> ) , array( <span class="stringliteral">&#39;WRITE&#39;</span> ) );
<a name="l00243"></a>00243                         $this-&gt;Database-&gt;insert( <span class="stringliteral">&#39;umx_link_dictionary&#39;</span> , <span class="stringliteral">&#39;object1_type , object2_type&#39;</span> , 
<a name="l00244"></a>00244                                                              <span class="stringliteral">&quot;&#39;$Object1Type&#39; , &#39;$Object2Type&#39;&quot;</span> );
<a name="l00245"></a>00245                         $this-&gt;Database-&gt;commit();
<a name="l00246"></a>00246                         $this-&gt;Database-&gt;unlock();
<a name="l00247"></a>00247                         
<a name="l00248"></a>00248                         $this-&gt;LinkTypesDictionary = <span class="keyword">false</span>;
<a name="l00249"></a>00249                   }
<a name="l00250"></a>00250                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00251"></a>00251                   {
<a name="l00252"></a>00252                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00253"></a>00253                   }
<a name="l00254"></a>00254             }
<a name="l00255"></a>00255             
<a name="l00282"></a><a class="code" href="classlink__1__0__0.html#a4f865d3fc401219538a03cb37bfe456e">00282</a>             function                <a class="code" href="classlink__1__0__0.html#a4f865d3fc401219538a03cb37bfe456e">get_link_type</a>( $Object1Type , $Object2Type )
<a name="l00283"></a>00283             {
<a name="l00284"></a>00284                   <span class="keywordflow">try</span>
<a name="l00285"></a>00285                   {
<a name="l00286"></a>00286                         $LinkType = $this-&gt;<a class="code" href="classlink__1__0__0.html#a92a7913984cc8361f0334e68fb2319a2">get_type_from_db</a>( $Object1Type , $Object2Type );
<a name="l00287"></a>00287                         
<a name="l00288"></a>00288                         <span class="keywordflow">if</span>( $LinkType === <span class="keyword">false</span> )
<a name="l00289"></a>00289                         {
<a name="l00290"></a>00290                               <span class="keywordflow">if</span>( $Object1Type === <span class="keyword">false</span> || $Object2Type === <span class="keyword">false</span> )
<a name="l00291"></a>00291                               {
<a name="l00292"></a>00292                                     <span class="comment">/* type with this parameters was not found */</span>
<a name="l00293"></a>00293                                     <span class="keywordflow">return</span>( 0 );
<a name="l00294"></a>00294                               }
<a name="l00295"></a>00295                               <span class="keywordflow">else</span>
<a name="l00296"></a>00296                               {
<a name="l00297"></a>00297                                     <span class="comment">/* both types defined so we can create new link type */</span>
<a name="l00298"></a>00298                                     $this-&gt;<a class="code" href="classlink__1__0__0.html#a2318bd82a1991bb16350b01e0584a45a">create_link_type</a>( $Object1Type , $Object2Type );
<a name="l00299"></a>00299                                     
<a name="l00300"></a>00300                                     <span class="keywordflow">return</span>( $this-&gt;<a class="code" href="classlink__1__0__0.html#a4f865d3fc401219538a03cb37bfe456e">get_link_type</a>( $Object1Type , $Object2Type ) );
<a name="l00301"></a>00301                               }
<a name="l00302"></a>00302                         }
<a name="l00303"></a>00303                         <span class="keywordflow">else</span>
<a name="l00304"></a>00304                         {
<a name="l00305"></a>00305                               <span class="keywordflow">return</span>( $LinkType );
<a name="l00306"></a>00306                         }
<a name="l00307"></a>00307                   }
<a name="l00308"></a>00308                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00309"></a>00309                   {
<a name="l00310"></a>00310                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00311"></a>00311                   }
<a name="l00312"></a>00312             }
<a name="l00313"></a>00313             
<a name="l00340"></a><a class="code" href="classlink__1__0__0.html#a2bc662ee8f897d955f98b93ec144cc06">00340</a>             function                <a class="code" href="classlink__1__0__0.html#a2bc662ee8f897d955f98b93ec144cc06">get_link_literal_type</a>( &amp;$Type )
<a name="l00341"></a>00341             {
<a name="l00342"></a>00342                   <span class="keywordflow">try</span>
<a name="l00343"></a>00343                   {
<a name="l00344"></a>00344                         $Type = is_array( $Type ) === <span class="keyword">true</span> ? $Type : array( $Type );
<a name="l00345"></a>00345                         $this-&gt;<a class="code" href="classlink__1__0__0.html#a1d9a89a8012ae245f1438787bcec253a">fill_cache</a>();
<a name="l00346"></a>00346                         $Types = array();
<a name="l00347"></a>00347                         <span class="keywordflow">foreach</span>( $this-&gt;LinkTypesDictionary as $k =&gt; $v )
<a name="l00348"></a>00348                         {
<a name="l00349"></a>00349                               <span class="keywordflow">foreach</span>( $Type as $i =&gt; $t )
<a name="l00350"></a>00350                               {
<a name="l00351"></a>00351                                     <span class="keywordflow">if</span>( $v-&gt;id == $t )
<a name="l00352"></a>00352                                     {
<a name="l00353"></a>00353                                           $Types [] = array( 
<a name="l00354"></a>00354                                                 <span class="stringliteral">&#39;object1_type&#39;</span> =&gt; $v-&gt;object1_type , <span class="stringliteral">&#39;object2_type&#39;</span> =&gt; $v-&gt;object2_type
<a name="l00355"></a>00355                                           );
<a name="l00356"></a>00356                                     }
<a name="l00357"></a>00357                               }
<a name="l00358"></a>00358                         }
<a name="l00359"></a>00359                         <span class="keywordflow">if</span>( isset( $Types[ 0 ] ) === <span class="keyword">false</span> )
<a name="l00360"></a>00360                         {
<a name="l00361"></a>00361                               <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&#39;Literal type of the link was not found&#39;</span> ) );
<a name="l00362"></a>00362                         }
<a name="l00363"></a>00363                         <span class="keywordflow">return</span>( $Types );
<a name="l00364"></a>00364                   }
<a name="l00365"></a>00365                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00366"></a>00366                   {
<a name="l00367"></a>00367                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00368"></a>00368                   }
<a name="l00369"></a>00369             }
<a name="l00370"></a>00370             
<a name="l00405"></a><a class="code" href="classlink__1__0__0.html#aadd34bab3e726d2a6b604302c5849036">00405</a>             function                <a class="code" href="classlink__1__0__0.html#aadd34bab3e726d2a6b604302c5849036">create_link_object</a>( $Object1Id , $Object2Id , $Object1Type , 
<a name="l00406"></a>00406                                                              $Object2Type , $SingleLinkOnly = <span class="keyword">false</span> )
<a name="l00407"></a>00407             {
<a name="l00408"></a>00408                   <span class="keywordflow">try</span>
<a name="l00409"></a>00409                   {
<a name="l00410"></a>00410                         <span class="keywordflow">if</span>( $SingleLinkOnly &amp;&amp; $this-&gt;<a class="code" href="classlink__1__0__0.html#a0fd9a05d071a49e87c275e2d90386dd3">link_exists</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type ) )
<a name="l00411"></a>00411                         {
<a name="l00412"></a>00412                               <span class="comment">/* \~russian возможно создание только одной ссылки между объектами</span>
<a name="l00413"></a>00413 <span class="comment">                                 \~english only one link allowed */</span>
<a name="l00414"></a>00414                               <span class="keywordflow">return</span>;
<a name="l00415"></a>00415                         }
<a name="l00416"></a>00416                         
<a name="l00417"></a>00417                         $Object1Id = $this-&gt;Security-&gt;get( $Object1Id , <span class="stringliteral">&#39;integer&#39;</span> );
<a name="l00418"></a>00418                         $Object2Id = $this-&gt;Security-&gt;get( $Object2Id , <span class="stringliteral">&#39;integer&#39;</span> );
<a name="l00419"></a>00419                         
<a name="l00420"></a>00420                         $LinkType = $this-&gt;<a class="code" href="classlink__1__0__0.html#a4f865d3fc401219538a03cb37bfe456e">get_link_type</a>( $Object1Type , $Object2Type );
<a name="l00421"></a>00421                         
<a name="l00422"></a>00422                         $this-&gt;Database-&gt;insert( <span class="stringliteral">&#39;umx_link&#39;</span> , <span class="stringliteral">&#39;object1_id , object2_id , type&#39;</span> , 
<a name="l00423"></a>00423                                                              <span class="stringliteral">&quot;$Object1Id , $Object2Id , $LinkType&quot;</span> );
<a name="l00424"></a>00424                         $this-&gt;Database-&gt;commit();
<a name="l00425"></a>00425                   }
<a name="l00426"></a>00426                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00427"></a>00427                   {
<a name="l00428"></a>00428                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00429"></a>00429                   }
<a name="l00430"></a>00430             }
<a name="l00431"></a>00431             
<a name="l00466"></a><a class="code" href="classlink__1__0__0.html#a906fcc7cce1e117abda4b6f2a1b0d148">00466</a>             function                <a class="code" href="classlink__1__0__0.html#a906fcc7cce1e117abda4b6f2a1b0d148">create_link</a>( $Object1Id , $Object2Id , $Object1Type , 
<a name="l00467"></a>00467                                                              $Object2Type , $SingleLinkOnly = <span class="keyword">false</span> )
<a name="l00468"></a>00468             {
<a name="l00469"></a>00469                   <span class="keywordflow">try</span>
<a name="l00470"></a>00470                   {
<a name="l00471"></a>00471                         <span class="keywordflow">if</span>( is_array( $Object1Id ) )
<a name="l00472"></a>00472                         {
<a name="l00473"></a>00473                               <span class="keywordflow">foreach</span>( $Object1Id as $k =&gt; $o1id )
<a name="l00474"></a>00474                               {
<a name="l00475"></a>00475                                     $this-&gt;<a class="code" href="classlink__1__0__0.html#a906fcc7cce1e117abda4b6f2a1b0d148">create_link</a>( $o1id , $Object2Id , $Object1Type , $Object2Type , $SingleLinkOnly );
<a name="l00476"></a>00476                               }
<a name="l00477"></a>00477                         }
<a name="l00478"></a>00478                         elseif( is_array( $Object2Id ) )
<a name="l00479"></a>00479                         {
<a name="l00480"></a>00480                               <span class="keywordflow">foreach</span>( $Object2Id as $k =&gt; $o2id )
<a name="l00481"></a>00481                               {
<a name="l00482"></a>00482                                     $this-&gt;<a class="code" href="classlink__1__0__0.html#a906fcc7cce1e117abda4b6f2a1b0d148">create_link</a>( $Object1Id , $o2id , $Object1Type , $Object2Type , $SingleLinkOnly );
<a name="l00483"></a>00483                               }
<a name="l00484"></a>00484                         }
<a name="l00485"></a>00485                         <span class="keywordflow">else</span>
<a name="l00486"></a>00486                         {
<a name="l00487"></a>00487                               $this-&gt;<a class="code" href="classlink__1__0__0.html#aadd34bab3e726d2a6b604302c5849036">create_link_object</a>( 
<a name="l00488"></a>00488                                     $Object1Id , $Object2Id , $Object1Type , $Object2Type , $SingleLinkOnly
<a name="l00489"></a>00489                               );
<a name="l00490"></a>00490                         }
<a name="l00491"></a>00491                   }
<a name="l00492"></a>00492                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00493"></a>00493                   {
<a name="l00494"></a>00494                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00495"></a>00495                   }
<a name="l00496"></a>00496             }
<a name="l00497"></a>00497             
<a name="l00528"></a><a class="code" href="classlink__1__0__0.html#a3b5dd6bcea2f615da8d56ec2d583dddc">00528</a>             function                <a class="code" href="classlink__1__0__0.html#a3b5dd6bcea2f615da8d56ec2d583dddc">compile_select_condition</a>( $ObjectId , $FieldName , $Conditions )
<a name="l00529"></a>00529             {
<a name="l00530"></a>00530                   <span class="keywordflow">try</span>
<a name="l00531"></a>00531                   {
<a name="l00532"></a>00532                         <span class="keywordflow">if</span>( $ObjectId !== <span class="keyword">false</span> )
<a name="l00533"></a>00533                         {
<a name="l00534"></a>00534                               <span class="keywordflow">if</span>( is_array( $ObjectId ) )
<a name="l00535"></a>00535                               {
<a name="l00536"></a>00536                                     $ObjectId = implode( <span class="charliteral">&#39;,&#39;</span> , $ObjectId );
<a name="l00537"></a>00537                               }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539                               $ObjectId = $this-&gt;Security-&gt;get( $ObjectId , <span class="stringliteral">&#39;integer_list&#39;</span> );
<a name="l00540"></a>00540                               
<a name="l00541"></a>00541                               $Conditions [] = <span class="stringliteral">&quot;$FieldName IN ( $ObjectId )&quot;</span>;
<a name="l00542"></a>00542                         }
<a name="l00543"></a>00543                         
<a name="l00544"></a>00544                         <span class="keywordflow">return</span>( $Conditions );
<a name="l00545"></a>00545                   }
<a name="l00546"></a>00546                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00547"></a>00547                   {
<a name="l00548"></a>00548                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00549"></a>00549                   }
<a name="l00550"></a>00550             }
<a name="l00551"></a>00551             
<a name="l00586"></a><a class="code" href="classlink__1__0__0.html#a54d1b92c871251dfc8d67267d39a2d2d">00586</a>             function                <a class="code" href="classlink__1__0__0.html#a54d1b92c871251dfc8d67267d39a2d2d">prepare_conditions</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type )
<a name="l00587"></a>00587             {
<a name="l00588"></a>00588                   <span class="keywordflow">try</span>
<a name="l00589"></a>00589                   {
<a name="l00590"></a>00590                         $Conditions = array();
<a name="l00591"></a>00591                         
<a name="l00592"></a>00592                         $Conditions = $this-&gt;<a class="code" href="classlink__1__0__0.html#a3b5dd6bcea2f615da8d56ec2d583dddc">compile_select_condition</a>( $Object1Id , <span class="stringliteral">&#39;object1_id&#39;</span> , $Conditions );
<a name="l00593"></a>00593                         
<a name="l00594"></a>00594                         $Conditions = $this-&gt;<a class="code" href="classlink__1__0__0.html#a3b5dd6bcea2f615da8d56ec2d583dddc">compile_select_condition</a>( $Object2Id , <span class="stringliteral">&#39;object2_id&#39;</span> , $Conditions );
<a name="l00595"></a>00595                         
<a name="l00596"></a>00596                         <span class="keywordflow">if</span>( $Object1Type !== <span class="keyword">false</span> || $Object2Type != <span class="keyword">false</span> )
<a name="l00597"></a>00597                         {
<a name="l00598"></a>00598                               $Conditions [] = <span class="stringliteral">&#39;type IN ( &#39;</span>.$this-&gt;get_link_type( $Object1Type , $Object2Type ).<span class="stringliteral">&#39; )&#39;</span>;
<a name="l00599"></a>00599                         }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601                         <span class="keywordflow">return</span>( implode( <span class="stringliteral">&#39; AND &#39;</span> , $Conditions ) );
<a name="l00602"></a>00602                   }
<a name="l00603"></a>00603                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00604"></a>00604                   {
<a name="l00605"></a>00605                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00606"></a>00606                   }
<a name="l00607"></a>00607             }
<a name="l00608"></a>00608             
<a name="l00643"></a><a class="code" href="classlink__1__0__0.html#a5ca4f857941b3fa94b5b2d43fefbe971">00643</a>             function                <a class="code" href="classlink__1__0__0.html#a5ca4f857941b3fa94b5b2d43fefbe971">get_links</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type )
<a name="l00644"></a>00644             {
<a name="l00645"></a>00645                   <span class="keywordflow">try</span>
<a name="l00646"></a>00646                   {
<a name="l00647"></a>00647                         $Conditions = $this-&gt;<a class="code" href="classlink__1__0__0.html#a54d1b92c871251dfc8d67267d39a2d2d">prepare_conditions</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type );
<a name="l00648"></a>00648 
<a name="l00649"></a>00649                         <span class="keywordflow">return</span>( 
<a name="l00650"></a>00650                               $this-&gt;Database-&gt;select( 
<a name="l00651"></a>00651                                     <span class="stringliteral">&#39;umx_link.* , umx_link_dictionary.object1_type , umx_link_dictionary.object2_type&#39;</span> , 
<a name="l00652"></a>00652                                     <span class="stringliteral">&#39;umx_link , umx_link_dictionary&#39;</span> , <span class="stringliteral">&quot;umx_link.type = umx_link_dictionary.id AND $Conditions&quot;</span> 
<a name="l00653"></a>00653                               )
<a name="l00654"></a>00654                         );
<a name="l00655"></a>00655                   }
<a name="l00656"></a>00656                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00657"></a>00657                   {
<a name="l00658"></a>00658                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00659"></a>00659                   }
<a name="l00660"></a>00660             }
<a name="l00661"></a>00661             
<a name="l00692"></a><a class="code" href="classlink__1__0__0.html#ac42c7ff85dd46f95f4d6195791cbeaf2">00692</a>             function                <a class="code" href="classlink__1__0__0.html#ac42c7ff85dd46f95f4d6195791cbeaf2">delete_link</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type )
<a name="l00693"></a>00693             {
<a name="l00694"></a>00694                   <span class="keywordflow">try</span>
<a name="l00695"></a>00695                   {
<a name="l00696"></a>00696                         <span class="keywordflow">if</span>( $Object1Type === <span class="keyword">false</span> &amp;&amp; $Object2Type === <span class="keyword">false</span> )
<a name="l00697"></a>00697                         {
<a name="l00698"></a>00698                               <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&quot;At least one type must be set&quot;</span> ) );
<a name="l00699"></a>00699                         }
<a name="l00700"></a>00700                         
<a name="l00701"></a>00701                         $Conditions = $this-&gt;<a class="code" href="classlink__1__0__0.html#a54d1b92c871251dfc8d67267d39a2d2d">prepare_conditions</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type );
<a name="l00702"></a>00702                         
<a name="l00703"></a>00703                         $this-&gt;Database-&gt;delete( <span class="stringliteral">&#39;umx_link&#39;</span> , $Conditions );
<a name="l00704"></a>00704                         $this-&gt;Database-&gt;commit();
<a name="l00705"></a>00705                   }
<a name="l00706"></a>00706                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00707"></a>00707                   {
<a name="l00708"></a>00708                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00709"></a>00709                   }
<a name="l00710"></a>00710             }
<a name="l00711"></a>00711             
<a name="l00758"></a><a class="code" href="classlink__1__0__0.html#aa33a757333e3d8a86d5cb7d2641ebb04">00758</a>             function                <a class="code" href="classlink__1__0__0.html#aa33a757333e3d8a86d5cb7d2641ebb04">get_sub_records</a>( $Object1Type , $Object2Type , &amp;$Records , $FieldName1 , 
<a name="l00759"></a>00759                                                          $JoiningTableName , $FieldName2 , $Fields = <span class="charliteral">&#39;*&#39;</span> )
<a name="l00760"></a>00760             {
<a name="l00761"></a>00761                   <span class="keywordflow">try</span>
<a name="l00762"></a>00762                   {
<a name="l00763"></a>00763                         <span class="keywordflow">if</span>( isset( $Records[ 0 ] ) )
<a name="l00764"></a>00764                         {
<a name="l00765"></a>00765                               $LinkType = $this-&gt;<a class="code" href="classlink__1__0__0.html#a4f865d3fc401219538a03cb37bfe456e">get_link_type</a>( $Object1Type , $Object2Type );
<a name="l00766"></a>00766                               $Ids = <a class="code" href="functional__programming_8php.html#a1214d3a2cfe95621fb50a088cc734b9b">implode_ex</a>( <span class="charliteral">&#39;,&#39;</span> , $Records , $FieldName1 );
<a name="l00767"></a>00767                               
<a name="l00768"></a>00768                               $Fields = <span class="stringliteral">&quot;$Fields , umx_link.object1_id AS _record_original_id&quot;</span>;
<a name="l00769"></a>00769                               $Tables = <span class="stringliteral">&quot;$JoiningTableName , umx_link&quot;</span>;
<a name="l00770"></a>00770                               $JoinConditions = <span class="stringliteral">&quot;umx_link.type $LinkType AND umx_link.object1_id IN ( $Ids ) AND </span>
<a name="l00771"></a>00771 <span class="stringliteral">                                    umx_link.object2_id = $JoiningTableName&quot;</span>.<span class="stringliteral">&quot;.$FieldName2&quot;</span>;
<a name="l00772"></a>00772                               
<a name="l00773"></a>00773                               <span class="keywordflow">return</span>( $this-&gt;Database-&gt;select( $Fields , $Tables , $JoinConditions ) );
<a name="l00774"></a>00774                         }
<a name="l00775"></a>00775                         <span class="keywordflow">else</span>
<a name="l00776"></a>00776                         {
<a name="l00777"></a>00777                               <span class="keywordflow">return</span>( array() );
<a name="l00778"></a>00778                         }
<a name="l00779"></a>00779                   }
<a name="l00780"></a>00780                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00781"></a>00781                   {
<a name="l00782"></a>00782                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00783"></a>00783                   }
<a name="l00784"></a>00784             }
<a name="l00785"></a>00785             
<a name="l00828"></a><a class="code" href="classlink__1__0__0.html#a0ae1c5b2f57ff14421d2ccdaccbaef0f">00828</a>             function                <a class="code" href="classlink__1__0__0.html#a0ae1c5b2f57ff14421d2ccdaccbaef0f">get_joining_records</a>( &amp;$Records , $FieldName1 , $FieldName2 , $JoiningTableName , 
<a name="l00829"></a>00829                                                                   $ExtendingFields , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l00830"></a>00830             {
<a name="l00831"></a>00831                   <span class="keywordflow">try</span>
<a name="l00832"></a>00832                   {
<a name="l00833"></a>00833                         <span class="keywordflow">if</span>( isset( $Records[ 0 ] ) )
<a name="l00834"></a>00834                         {
<a name="l00835"></a>00835                               $Values = implode( <span class="stringliteral">&#39; , &#39;</span> , array_unique( <a class="code" href="functional__programming_8php.html#a9c56c5cb857578644fdd5deaba4cd63f">get_field_ex</a>( $Records , $FieldName1 ) ) );
<a name="l00836"></a>00836                               
<a name="l00837"></a>00837                               $SubRecords = $this-&gt;Database-&gt;select( 
<a name="l00838"></a>00838                                     <span class="stringliteral">&quot;$FieldName2 AS _joining_field , $ExtendingFields&quot;</span> , <span class="stringliteral">&quot;$JoiningTableName&quot;</span> , 
<a name="l00839"></a>00839                                     <span class="stringliteral">&quot;$FieldName2 IN ( $Values ) AND ( $Condition )&quot;</span>
<a name="l00840"></a>00840                               );
<a name="l00841"></a>00841                               
<a name="l00842"></a>00842                               <span class="keywordflow">return</span>( $SubRecords );
<a name="l00843"></a>00843                         }
<a name="l00844"></a>00844                         
<a name="l00845"></a>00845                         <span class="keywordflow">return</span>( array() );
<a name="l00846"></a>00846                   }
<a name="l00847"></a>00847                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00848"></a>00848                   {
<a name="l00849"></a>00849                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00850"></a>00850                   }
<a name="l00851"></a>00851             }
<a name="l00852"></a>00852             
<a name="l00903"></a><a class="code" href="classlink__1__0__0.html#a842dba87ce2b60dca619fec31ad5d487">00903</a>             function                <a class="code" href="classlink__1__0__0.html#a842dba87ce2b60dca619fec31ad5d487">join_data</a>( &amp;$Records , $Object1Type , $Object2Type , $FieldName1 , 
<a name="l00904"></a>00904                                                          $FieldName2 , $JoiningTableName , $JoinName , $Fields = <span class="charliteral">&#39;*&#39;</span> )
<a name="l00905"></a>00905             {
<a name="l00906"></a>00906                   <span class="keywordflow">try</span>
<a name="l00907"></a>00907                   {
<a name="l00908"></a>00908                         $SubRecords = $this-&gt;<a class="code" href="classlink__1__0__0.html#aa33a757333e3d8a86d5cb7d2641ebb04">get_sub_records</a>( $Object1Type , $Object2Type , $Records , $FieldName1 , 
<a name="l00909"></a>00909                                                          $JoiningTableName , $FieldName2 );
<a name="l00910"></a>00910                                                          
<a name="l00911"></a>00911                         <span class="keywordflow">foreach</span>( $Records as $k1 =&gt; $v1 )
<a name="l00912"></a>00912                         {
<a name="l00913"></a>00913                               <a class="code" href="functional__programming_8php.html#aeb504a5f142413c2643d5e8f315978e5">set_field</a>( $Records[ $k1 ] , $JoinName , array() );
<a name="l00914"></a>00914                               
<a name="l00915"></a>00915                               <span class="keywordflow">foreach</span>( $SubRecords as $k2 =&gt; $v2 )
<a name="l00916"></a>00916                               {
<a name="l00917"></a>00917                                     <span class="keywordflow">if</span>( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v1 , $FieldName1 ) == <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v2 , $FieldName2 ) )
<a name="l00918"></a>00918                                     {
<a name="l00919"></a>00919                                           <a class="code" href="functional__programming_8php.html#aa785f5b026522387cab22ccc163c8e46">append_to_field</a>( $Records[ $k1 ] , $JoinName , $v2 );
<a name="l00920"></a>00920                                     }
<a name="l00921"></a>00921                               }
<a name="l00922"></a>00922                         }
<a name="l00923"></a>00923                         
<a name="l00924"></a>00924                         <span class="keywordflow">return</span>( $Records );
<a name="l00925"></a>00925                   }
<a name="l00926"></a>00926                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00927"></a>00927                   {
<a name="l00928"></a>00928                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00929"></a>00929                   }
<a name="l00930"></a>00930             }
<a name="l00931"></a>00931             
<a name="l00978"></a><a class="code" href="classlink__1__0__0.html#ac31196318f0f7ee392a821841ba77a0c">00978</a>             function                <a class="code" href="classlink__1__0__0.html#ac31196318f0f7ee392a821841ba77a0c">join_single_to_single_data</a>( &amp;$Records , $FieldName1 , 
<a name="l00979"></a>00979                                                       $FieldName2 , $JoiningTableName , $JoinName , $Fields = <span class="charliteral">&#39;*&#39;</span> , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l00980"></a>00980             {
<a name="l00981"></a>00981                   <span class="keywordflow">try</span>
<a name="l00982"></a>00982                   {
<a name="l00983"></a>00983                         $SubRecords = $this-&gt;<a class="code" href="classlink__1__0__0.html#a0ae1c5b2f57ff14421d2ccdaccbaef0f">get_joining_records</a>( 
<a name="l00984"></a>00984                               $Records , $FieldName1 , $FieldName2 , $JoiningTableName , $Fields , $Condition
<a name="l00985"></a>00985                         );
<a name="l00986"></a>00986                         <span class="keywordflow">foreach</span>( $Records as $k1 =&gt; $v1 )
<a name="l00987"></a>00987                         {
<a name="l00988"></a>00988                               <span class="keywordflow">foreach</span>( $SubRecords as $k2 =&gt; $v2 )
<a name="l00989"></a>00989                               {
<a name="l00990"></a>00990                                     <span class="keywordflow">if</span>( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v1 , $FieldName1 ) == <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v2 , <span class="stringliteral">&#39;_joining_field&#39;</span> ) )
<a name="l00991"></a>00991                                     {
<a name="l00992"></a>00992                                           <span class="keywordflow">if</span>( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Records[ $k1 ] , $JoinName , <span class="keyword">false</span> ) !== <span class="keyword">false</span> )
<a name="l00993"></a>00993                                           {
<a name="l00994"></a>00994                                                 <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&quot;The field \&quot;$JoinName\&quot; was already set&quot;</span> ) );
<a name="l00995"></a>00995                                           }
<a name="l00996"></a>00996                                           <span class="keywordflow">else</span>
<a name="l00997"></a>00997                                           {
<a name="l00998"></a>00998                                                 <a class="code" href="functional__programming_8php.html#aeb504a5f142413c2643d5e8f315978e5">set_field</a>( $Records[ $k1 ] , $JoinName , <a class="code" href="functional__programming_8php.html#a38d0a128fc76a5d70988674952cce5bc">remove_fields</a>( $v2 , <span class="stringliteral">&#39;_joining_field&#39;</span> ) );
<a name="l00999"></a>00999                                           }
<a name="l01000"></a>01000                                     }
<a name="l01001"></a>01001                               }
<a name="l01002"></a>01002                         }
<a name="l01003"></a>01003                         <span class="keywordflow">return</span>( $Records );
<a name="l01004"></a>01004                   }
<a name="l01005"></a>01005                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l01006"></a>01006                   {
<a name="l01007"></a>01007                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l01008"></a>01008                   }
<a name="l01009"></a>01009             }
<a name="l01010"></a>01010             
<a name="l01057"></a><a class="code" href="classlink__1__0__0.html#a1ba5d308f00cf28cca7b3a4d7b940578">01057</a>             function                <a class="code" href="classlink__1__0__0.html#a1ba5d308f00cf28cca7b3a4d7b940578">join_single_to_many_data</a>( &amp;$Records , $FieldName1 , 
<a name="l01058"></a>01058                                                       $FieldName2 , $JoiningTableName , $JoinName , $Fields = <span class="charliteral">&#39;*&#39;</span> , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l01059"></a>01059             {
<a name="l01060"></a>01060                   <span class="keywordflow">try</span>
<a name="l01061"></a>01061                   {
<a name="l01062"></a>01062                         $SubRecords = $this-&gt;<a class="code" href="classlink__1__0__0.html#a0ae1c5b2f57ff14421d2ccdaccbaef0f">get_joining_records</a>( 
<a name="l01063"></a>01063                               $Records , $FieldName1 , $FieldName2 , $JoiningTableName , $Fields , $Condition
<a name="l01064"></a>01064                         );
<a name="l01065"></a>01065                         
<a name="l01066"></a>01066                         <span class="keywordflow">foreach</span>( $Records as $k1 =&gt; $v1 )
<a name="l01067"></a>01067                         {
<a name="l01068"></a>01068                               <a class="code" href="functional__programming_8php.html#aeb504a5f142413c2643d5e8f315978e5">set_field</a>( $Records[ $k1 ] , $JoinName , array() );
<a name="l01069"></a>01069                               <span class="keywordflow">foreach</span>( $SubRecords as $k2 =&gt; $v2 )
<a name="l01070"></a>01070                               {
<a name="l01071"></a>01071                                     <span class="keywordflow">if</span>( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v1 , $FieldName1 ) == <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v2 , <span class="stringliteral">&#39;_joining_field&#39;</span> ) )
<a name="l01072"></a>01072                                     {
<a name="l01073"></a>01073                                           <a class="code" href="functional__programming_8php.html#aa785f5b026522387cab22ccc163c8e46">append_to_field</a>( $Records[ $k1 ] , $JoinName , <a class="code" href="functional__programming_8php.html#a38d0a128fc76a5d70988674952cce5bc">remove_fields</a>( $v2 , <span class="stringliteral">&#39;_joining_field&#39;</span> ) );
<a name="l01074"></a>01074                                     }
<a name="l01075"></a>01075                               }
<a name="l01076"></a>01076                         }
<a name="l01077"></a>01077                         
<a name="l01078"></a>01078                         <span class="keywordflow">return</span>( $Records );
<a name="l01079"></a>01079                   }
<a name="l01080"></a>01080                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l01081"></a>01081                   {
<a name="l01082"></a>01082                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l01083"></a>01083                   }
<a name="l01084"></a>01084             }
<a name="l01085"></a>01085             
<a name="l01128"></a><a class="code" href="classlink__1__0__0.html#a63a7480c9c2bb5aa3ae6f4c6e489d656">01128</a>             function                <a class="code" href="classlink__1__0__0.html#a63a7480c9c2bb5aa3ae6f4c6e489d656">extend_records</a>( &amp;$Records , $FieldName1 , $FieldName2 , $JoiningTableName , 
<a name="l01129"></a>01129                                                                   $ExtendingFields , $Condition = <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l01130"></a>01130             {
<a name="l01131"></a>01131                   <span class="keywordflow">try</span>
<a name="l01132"></a>01132                   {
<a name="l01133"></a>01133                         $SubRecords = $this-&gt;<a class="code" href="classlink__1__0__0.html#a0ae1c5b2f57ff14421d2ccdaccbaef0f">get_joining_records</a>( 
<a name="l01134"></a>01134                               $Records , $FieldName1 , $FieldName2 , $JoiningTableName , 
<a name="l01135"></a>01135                               implode( <span class="stringliteral">&#39; , &#39;</span> , $ExtendingFields ) , $Condition
<a name="l01136"></a>01136                         );
<a name="l01137"></a>01137                         
<a name="l01138"></a>01138                         <span class="keywordflow">foreach</span>( $Records as $k1 =&gt; $v1 )
<a name="l01139"></a>01139                         {
<a name="l01140"></a>01140                               <span class="keywordflow">foreach</span>( $SubRecords as $k2 =&gt; $v2 )
<a name="l01141"></a>01141                               {
<a name="l01142"></a>01142                                     <span class="keywordflow">if</span>( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v1 , $FieldName1 ) == <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $v2 , <span class="stringliteral">&#39;_joining_field&#39;</span> ) )
<a name="l01143"></a>01143                                     {
<a name="l01144"></a>01144                                           <a class="code" href="functional__programming_8php.html#a27c87dd75ef4f5927750fe65c5e2a1a4">extend</a>( $Records[ $k1 ] , <a class="code" href="functional__programming_8php.html#a38d0a128fc76a5d70988674952cce5bc">remove_fields</a>( $v2 , <span class="stringliteral">&#39;_joining_field&#39;</span> ) );
<a name="l01145"></a>01145                                     }
<a name="l01146"></a>01146                               }
<a name="l01147"></a>01147                         }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149                         <span class="keywordflow">return</span>( $Records );
<a name="l01150"></a>01150                   }
<a name="l01151"></a>01151                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l01152"></a>01152                   {
<a name="l01153"></a>01153                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l01154"></a>01154                   }
<a name="l01155"></a>01155             }
<a name="l01156"></a>01156             
<a name="l01191"></a><a class="code" href="classlink__1__0__0.html#ad7186b1eaa4d25253c6ccdb39cdec0bc">01191</a>             function                <a class="code" href="classlink__1__0__0.html#ad7186b1eaa4d25253c6ccdb39cdec0bc">get_links_count</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type )
<a name="l01192"></a>01192             {
<a name="l01193"></a>01193                   <span class="keywordflow">try</span>
<a name="l01194"></a>01194                   {
<a name="l01195"></a>01195                         $Conditions = $this-&gt;<a class="code" href="classlink__1__0__0.html#a54d1b92c871251dfc8d67267d39a2d2d">prepare_conditions</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type );
<a name="l01196"></a>01196 
<a name="l01197"></a>01197                         $Records = $this-&gt;Database-&gt;select( <span class="stringliteral">&#39;COUNT( * ) AS links_count&#39;</span> , <span class="stringliteral">&#39;umx_link&#39;</span> , $Conditions );
<a name="l01198"></a>01198                         
<a name="l01199"></a>01199                         <span class="keywordflow">if</span>( isset( $Records[ 0 ] ) === <span class="keyword">false</span> )
<a name="l01200"></a>01200                         {
<a name="l01201"></a>01201                               <span class="keywordflow">return</span>( 0 );
<a name="l01202"></a>01202                         }
<a name="l01203"></a>01203                         <span class="keywordflow">else</span>
<a name="l01204"></a>01204                         {
<a name="l01205"></a>01205                               <span class="keywordflow">return</span>( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Records[ 0 ] , <span class="stringliteral">&#39;links_count&#39;</span> ) );
<a name="l01206"></a>01206                         }
<a name="l01207"></a>01207                   }
<a name="l01208"></a>01208                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l01209"></a>01209                   {
<a name="l01210"></a>01210                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l01211"></a>01211                   }
<a name="l01212"></a>01212             }
<a name="l01213"></a>01213             
<a name="l01248"></a><a class="code" href="classlink__1__0__0.html#a0fd9a05d071a49e87c275e2d90386dd3">01248</a>             function                <a class="code" href="classlink__1__0__0.html#a0fd9a05d071a49e87c275e2d90386dd3">link_exists</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type )
<a name="l01249"></a>01249             {
<a name="l01250"></a>01250                   <span class="keywordflow">try</span>
<a name="l01251"></a>01251                   {
<a name="l01252"></a>01252                         <span class="keywordflow">return</span>( $this-&gt;<a class="code" href="classlink__1__0__0.html#ad7186b1eaa4d25253c6ccdb39cdec0bc">get_links_count</a>( $Object1Id , $Object2Id , $Object1Type , $Object2Type ) &gt; 0 );
<a name="l01253"></a>01253                   }
<a name="l01254"></a>01254                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l01255"></a>01255                   {
<a name="l01256"></a>01256                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l01257"></a>01257                   }
<a name="l01258"></a>01258             }
<a name="l01259"></a>01259             
<a name="l01294"></a><a class="code" href="classlink__1__0__0.html#afa3525f4dbe6df26b617b5aec4708bfa">01294</a>             function                <a class="code" href="classlink__1__0__0.html#afa3525f4dbe6df26b617b5aec4708bfa">update_link</a>( $Object1Id , $OldObject2Id , $NewObject2Id , $Object1Type , $Object2Type )
<a name="l01295"></a>01295             {
<a name="l01296"></a>01296                   <span class="keywordflow">try</span>
<a name="l01297"></a>01297                   {
<a name="l01298"></a>01298                         <span class="keywordflow">if</span>( strpos( $Object1Id , <span class="charliteral">&#39;,&#39;</span> ) === <span class="keyword">true</span> )
<a name="l01299"></a>01299                         {
<a name="l01300"></a>01300                               $Object1Id = explode( <span class="charliteral">&#39;,&#39;</span> , $Object1Id );
<a name="l01301"></a>01301                         }
<a name="l01302"></a>01302                         <span class="keywordflow">else</span>
<a name="l01303"></a>01303                         {
<a name="l01304"></a>01304                               $Object1Id = array( $Object1Id );
<a name="l01305"></a>01305                         }
<a name="l01306"></a>01306                         
<a name="l01307"></a>01307                         <span class="keywordflow">foreach</span>( $Object1Id as $k =&gt; $id )
<a name="l01308"></a>01308                         {
<a name="l01309"></a>01309                               $this-&gt;<a class="code" href="classlink__1__0__0.html#ac42c7ff85dd46f95f4d6195791cbeaf2">delete_link</a>( $id , $OldObject2Id , $Object1Type , $Object2Type );
<a name="l01310"></a>01310                               
<a name="l01311"></a>01311                               $this-&gt;<a class="code" href="classlink__1__0__0.html#a906fcc7cce1e117abda4b6f2a1b0d148">create_link</a>( $id , $NewObject2Id , $Object1Type , $Object2Type );
<a name="l01312"></a>01312                         }
<a name="l01313"></a>01313                   }
<a name="l01314"></a>01314                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l01315"></a>01315                   {
<a name="l01316"></a>01316                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l01317"></a>01317                   }
<a name="l01318"></a>01318             }
<a name="l01319"></a>01319       }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Oct 3 2011 14:49:51 for ultimix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
