<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ultimix: colorbox/jquery.colorbox.js Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>colorbox/jquery.colorbox.js</h1>  </div>
</div>
<div class="contents">
<a href="colorbox_2jquery_8colorbox_8js.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// ColorBox v1.3.9 - a full featured, light-weight, customizable lightbox based on jQuery 1.3</span>
<a name="l00002"></a>00002 <span class="comment">// c) 2009 Jack Moore - www.colorpowered.com - jack@colorpowered.com</span>
<a name="l00003"></a>00003 <span class="comment">// Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php</span>
<a name="l00004"></a>00004 (function ($, <a class="code" href="jquery-1_84_82_8js.html#ad55530ae1e5978df8e721017c1fc8466">window</a>) {
<a name="l00005"></a>00005       
<a name="l00006"></a>00006       var
<a name="l00007"></a>00007       <span class="comment">// ColorBox Default Settings. </span>
<a name="l00008"></a>00008       <span class="comment">// See http://colorpowered.com/colorbox for details.</span>
<a name="l00009"></a>00009       defaults = {
<a name="l00010"></a>00010             transition: <span class="stringliteral">&quot;elastic&quot;</span>,
<a name="l00011"></a>00011             speed: 300,
<a name="l00012"></a>00012             width: <span class="keyword">false</span>,
<a name="l00013"></a>00013             initialWidth: <span class="stringliteral">&quot;600&quot;</span>,
<a name="l00014"></a>00014             innerWidth: <span class="keyword">false</span>,
<a name="l00015"></a>00015             maxWidth: <span class="keyword">false</span>,
<a name="l00016"></a>00016             height: <span class="keyword">false</span>,
<a name="l00017"></a>00017             initialHeight: <span class="stringliteral">&quot;450&quot;</span>,
<a name="l00018"></a>00018             innerHeight: <span class="keyword">false</span>,
<a name="l00019"></a>00019             maxHeight: <span class="keyword">false</span>,
<a name="l00020"></a>00020             scalePhotos: <span class="keyword">true</span>,
<a name="l00021"></a>00021             scrolling: <span class="keyword">true</span>,
<a name="l00022"></a>00022             <span class="keyword">inline</span>: <span class="keyword">false</span>,
<a name="l00023"></a>00023             html: <span class="keyword">false</span>,
<a name="l00024"></a>00024             iframe: <span class="keyword">false</span>,
<a name="l00025"></a>00025             photo: <span class="keyword">false</span>,
<a name="l00026"></a>00026             href: <span class="keyword">false</span>,
<a name="l00027"></a>00027             title: <span class="keyword">false</span>,
<a name="l00028"></a>00028             rel: <span class="keyword">false</span>,
<a name="l00029"></a>00029             opacity: 0.9,
<a name="l00030"></a>00030             preloading: <span class="keyword">true</span>,
<a name="l00031"></a>00031             current: <span class="stringliteral">&quot;image {current} of {total}&quot;</span>,
<a name="l00032"></a>00032             previous: <span class="stringliteral">&quot;previous&quot;</span>,
<a name="l00033"></a>00033             next: <span class="stringliteral">&quot;next&quot;</span>,
<a name="l00034"></a>00034             close: <span class="stringliteral">&quot;close&quot;</span>,
<a name="l00035"></a>00035             open: <span class="keyword">false</span>,
<a name="l00036"></a>00036             loop: <span class="keyword">true</span>,
<a name="l00037"></a>00037             slideshow: <span class="keyword">false</span>,
<a name="l00038"></a>00038             slideshowAuto: <span class="keyword">true</span>,
<a name="l00039"></a>00039             slideshowSpeed: 2500,
<a name="l00040"></a>00040             slideshowStart: <span class="stringliteral">&quot;start slideshow&quot;</span>,
<a name="l00041"></a>00041             slideshowStop: <span class="stringliteral">&quot;stop slideshow&quot;</span>,
<a name="l00042"></a>00042             onOpen: <span class="keyword">false</span>,
<a name="l00043"></a>00043             onLoad: <span class="keyword">false</span>,
<a name="l00044"></a>00044             onComplete: <span class="keyword">false</span>,
<a name="l00045"></a>00045             onCleanup: <span class="keyword">false</span>,
<a name="l00046"></a>00046             onClosed: <span class="keyword">false</span>,
<a name="l00047"></a>00047             overlayClose: <span class="keyword">true</span>,           
<a name="l00048"></a>00048             escKey: <span class="keyword">true</span>,
<a name="l00049"></a>00049             arrowKey: <span class="keyword">true</span>
<a name="l00050"></a>00050       },
<a name="l00051"></a>00051       
<a name="l00052"></a>00052       <span class="comment">// Abstracting the HTML and event identifiers for easy rebranding</span>
<a name="l00053"></a>00053       colorbox = <span class="stringliteral">&#39;colorbox&#39;</span>,
<a name="l00054"></a>00054       prefix = <span class="stringliteral">&#39;cbox&#39;</span>,
<a name="l00055"></a>00055       
<a name="l00056"></a>00056       <span class="comment">// Events   </span>
<a name="l00057"></a>00057       event_open = prefix + <span class="stringliteral">&#39;_open&#39;</span>,
<a name="l00058"></a>00058       event_load = prefix + <span class="stringliteral">&#39;_load&#39;</span>,
<a name="l00059"></a>00059       event_complete = prefix + <span class="stringliteral">&#39;_complete&#39;</span>,
<a name="l00060"></a>00060       event_cleanup = prefix + <span class="stringliteral">&#39;_cleanup&#39;</span>,
<a name="l00061"></a>00061       event_closed = prefix + <span class="stringliteral">&#39;_closed&#39;</span>,
<a name="l00062"></a>00062       
<a name="l00063"></a>00063       <span class="comment">// Special Handling for IE</span>
<a name="l00064"></a>00064       isIE = $.browser.msie &amp;&amp; !$.support.opacity, <span class="comment">// feature detection alone gave a false positive on at least one phone browser and on some development versions of Chrome.</span>
<a name="l00065"></a>00065       isIE6 = isIE &amp;&amp; $.browser.version &lt; 7,
<a name="l00066"></a>00066       event_ie6 = prefix + <span class="stringliteral">&#39;_IE6&#39;</span>,
<a name="l00067"></a>00067 
<a name="l00068"></a>00068       <span class="comment">// Cached jQuery Object Variables</span>
<a name="l00069"></a>00069       $overlay,
<a name="l00070"></a>00070       $box,
<a name="l00071"></a>00071       $wrap,
<a name="l00072"></a>00072       $content,
<a name="l00073"></a>00073       $topBorder,
<a name="l00074"></a>00074       $leftBorder,
<a name="l00075"></a>00075       $rightBorder,
<a name="l00076"></a>00076       $bottomBorder,
<a name="l00077"></a>00077       $related,
<a name="l00078"></a>00078       $window,
<a name="l00079"></a>00079       $loaded,
<a name="l00080"></a>00080       $loadingBay,
<a name="l00081"></a>00081       $loadingOverlay,
<a name="l00082"></a>00082       $title,
<a name="l00083"></a>00083       $current,
<a name="l00084"></a>00084       $slideshow,
<a name="l00085"></a>00085       $next,
<a name="l00086"></a>00086       $prev,
<a name="l00087"></a>00087       $close,
<a name="l00088"></a>00088 
<a name="l00089"></a>00089       <span class="comment">// Variables for cached values or use across multiple functions</span>
<a name="l00090"></a>00090       interfaceHeight,
<a name="l00091"></a>00091       interfaceWidth,
<a name="l00092"></a>00092       loadedHeight,
<a name="l00093"></a>00093       loadedWidth,
<a name="l00094"></a>00094       element,
<a name="l00095"></a>00095       bookmark,
<a name="l00096"></a>00096       index,
<a name="l00097"></a>00097       settings,
<a name="l00098"></a>00098       open,
<a name="l00099"></a>00099       active,
<a name="l00100"></a>00100       
<a name="l00101"></a>00101       publicMethod,
<a name="l00102"></a>00102       boxElement = prefix + <span class="stringliteral">&#39;Element&#39;</span>;
<a name="l00103"></a>00103       
<a name="l00104"></a>00104       <span class="comment">// ****************</span>
<a name="l00105"></a>00105       <span class="comment">// HELPER FUNCTIONS</span>
<a name="l00106"></a>00106       <span class="comment">// ****************</span>
<a name="l00107"></a>00107 
<a name="l00108"></a>00108       <span class="comment">// jQuery object generator to reduce code size</span>
<a name="l00109"></a>00109       function $div(<span class="keywordtype">id</span>, css) { 
<a name="l00110"></a>00110             <span class="keywordtype">id</span> = <span class="keywordtype">id</span> ? <span class="stringliteral">&#39; id=&quot;&#39;</span> + prefix + <span class="keywordtype">id</span> + <span class="charliteral">&#39;&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00111"></a>00111             css = css ? <span class="stringliteral">&#39; style=&quot;&#39;</span> + css + <span class="charliteral">&#39;&quot;&#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00112"></a>00112             <span class="keywordflow">return</span> $(<span class="stringliteral">&#39;&lt;div&#39;</span> + <span class="keywordtype">id</span> + css + <span class="stringliteral">&#39;/&gt;&#39;</span>);
<a name="l00113"></a>00113       }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115       <span class="comment">// Convert % values to pixels</span>
<a name="l00116"></a>00116       function setSize(size, dimension) {
<a name="l00117"></a>00117             dimension = dimension === <span class="charliteral">&#39;x&#39;</span> ? $window.width() : $window.height();
<a name="l00118"></a>00118             <span class="keywordflow">return</span> (typeof size === <span class="stringliteral">&#39;string&#39;</span>) ? Math.round((size.match(/%/) ? (dimension / 100) * parseInt(size, 10) : parseInt(size, 10))) : size;
<a name="l00119"></a>00119       }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121       <span class="comment">// Checks an href to see if it is a photo.</span>
<a name="l00122"></a>00122       <span class="comment">// There is a force photo option (photo: true) for hrefs that cannot be matched by this regex.</span>
<a name="l00123"></a>00123       function isImage(url) {
<a name="l00124"></a>00124             url = $.isFunction(url) ? url.call(element) : url;
<a name="l00125"></a>00125             <span class="keywordflow">return</span> settings.photo || url.match(/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i);
<a name="l00126"></a>00126       }
<a name="l00127"></a>00127       
<a name="l00128"></a>00128       <span class="comment">// Assigns functions results to their respective settings.  This allows functions to be used to set ColorBox options.</span>
<a name="l00129"></a>00129       function process() {
<a name="l00130"></a>00130             <span class="keywordflow">for</span> (var i in settings) {
<a name="l00131"></a>00131                   <span class="keywordflow">if</span> ($.isFunction(settings[i]) &amp;&amp; i.substring(0, 2) !== <span class="stringliteral">&#39;on&#39;</span>) { <span class="comment">// checks to make sure the function isn&#39;t one of the callbacks, they will be handled at the appropriate time.</span>
<a name="l00132"></a>00132                       settings[i] = settings[i].call(element);
<a name="l00133"></a>00133                   }
<a name="l00134"></a>00134             }
<a name="l00135"></a>00135             settings.rel = settings.rel || element.rel || <span class="stringliteral">&#39;nofollow&#39;</span>;
<a name="l00136"></a>00136             settings.href = settings.href || $(element).attr(<span class="stringliteral">&#39;href&#39;</span>);
<a name="l00137"></a>00137             settings.title = settings.title || element.title;
<a name="l00138"></a>00138       }
<a name="l00139"></a>00139 
<a name="l00140"></a>00140       function launch(elem) {
<a name="l00141"></a>00141             
<a name="l00142"></a>00142             element = elem;
<a name="l00143"></a>00143             
<a name="l00144"></a>00144             settings = $.extend({}, $(element).data(colorbox));
<a name="l00145"></a>00145             
<a name="l00146"></a>00146             process(); <span class="comment">// Convert functions to their returned values.</span>
<a name="l00147"></a>00147             
<a name="l00148"></a>00148             <span class="keywordflow">if</span> (settings.rel !== <span class="stringliteral">&#39;nofollow&#39;</span>) {
<a name="l00149"></a>00149                   $related = $(<span class="charliteral">&#39;.&#39;</span> + boxElement).filter(function () {
<a name="l00150"></a>00150                         var relRelated = $(<span class="keyword">this</span>).data(colorbox).rel || this.rel;
<a name="l00151"></a>00151                         <span class="keywordflow">return</span> (relRelated === settings.rel);
<a name="l00152"></a>00152                   });
<a name="l00153"></a>00153                   index = $related.index(element);
<a name="l00154"></a>00154                   
<a name="l00155"></a>00155                   <span class="comment">// Check direct calls to ColorBox.</span>
<a name="l00156"></a>00156                   <span class="keywordflow">if</span> (index === -1) {
<a name="l00157"></a>00157                         $related = $related.add(element);
<a name="l00158"></a>00158                         index = $related.length - 1;
<a name="l00159"></a>00159                   }
<a name="l00160"></a>00160             } <span class="keywordflow">else</span> {
<a name="l00161"></a>00161                   $related = $(element);
<a name="l00162"></a>00162                   index = 0;
<a name="l00163"></a>00163             }
<a name="l00164"></a>00164             
<a name="l00165"></a>00165             <span class="keywordflow">if</span> (!open) {
<a name="l00166"></a>00166                   open = active = <span class="keyword">true</span>; <span class="comment">// Prevents the page-change action from queuing up if the visitor holds down the left or right keys.</span>
<a name="l00167"></a>00167                   
<a name="l00168"></a>00168                   bookmark = element;
<a name="l00169"></a>00169                   
<a name="l00170"></a>00170                   <span class="keywordflow">try</span> {
<a name="l00171"></a>00171                         bookmark.blur(); <span class="comment">// Remove the focus from the calling element.</span>
<a name="l00172"></a>00172                   }<span class="keywordflow">catch</span> (e) {}
<a name="l00173"></a>00173                   
<a name="l00174"></a>00174                   $.event.trigger(event_open);
<a name="l00175"></a>00175                   <span class="keywordflow">if</span> (settings.onOpen) {
<a name="l00176"></a>00176                         settings.onOpen.call(element);
<a name="l00177"></a>00177                   }
<a name="l00178"></a>00178                   
<a name="l00179"></a>00179                   <span class="comment">// +settings.opacity avoids a problem in IE when using non-zero-prefixed-string-values, like &#39;.5&#39;</span>
<a name="l00180"></a>00180                   $overlay.css({<span class="stringliteral">&quot;opacity&quot;</span>: +settings.opacity, <span class="stringliteral">&quot;cursor&quot;</span>: settings.overlayClose ? <span class="stringliteral">&quot;pointer&quot;</span> : <span class="stringliteral">&quot;auto&quot;</span>}).show();
<a name="l00181"></a>00181                   
<a name="l00182"></a>00182                   <span class="comment">// Opens inital empty ColorBox prior to content being loaded.</span>
<a name="l00183"></a>00183                   settings.w = setSize(settings.initialWidth, <span class="charliteral">&#39;x&#39;</span>);
<a name="l00184"></a>00184                   settings.h = setSize(settings.initialHeight, <span class="charliteral">&#39;y&#39;</span>);
<a name="l00185"></a>00185                   publicMethod.position(0);
<a name="l00186"></a>00186                   
<a name="l00187"></a>00187                   <span class="keywordflow">if</span> (isIE6) {
<a name="l00188"></a>00188                         $window.bind(<span class="stringliteral">&#39;resize.&#39;</span> + event_ie6 + <span class="stringliteral">&#39; scroll.&#39;</span> + event_ie6, function () {
<a name="l00189"></a>00189                               $overlay.css({width: $window.width(), height: $window.height(), top: $window.scrollTop(), left: $window.scrollLeft()});
<a name="l00190"></a>00190                         }).trigger(<span class="stringliteral">&#39;scroll.&#39;</span> + event_ie6);
<a name="l00191"></a>00191                   }
<a name="l00192"></a>00192             }
<a name="l00193"></a>00193             
<a name="l00194"></a>00194             $current.add($prev).add($next).add($slideshow).add($title).hide();
<a name="l00195"></a>00195             
<a name="l00196"></a>00196             $close.html(settings.close).show();
<a name="l00197"></a>00197             
<a name="l00198"></a>00198             publicMethod.slideshow();
<a name="l00199"></a>00199             
<a name="l00200"></a>00200             publicMethod.load();
<a name="l00201"></a>00201       }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203       <span class="comment">// ****************</span>
<a name="l00204"></a>00204       <span class="comment">// PUBLIC FUNCTIONS</span>
<a name="l00205"></a>00205       <span class="comment">// Usage format: $.fn.colorbox.close();</span>
<a name="l00206"></a>00206       <span class="comment">// Usage from within an iframe: parent.$.fn.colorbox.close();</span>
<a name="l00207"></a>00207       <span class="comment">// ****************</span>
<a name="l00208"></a>00208       
<a name="l00209"></a>00209       publicMethod = $.fn[colorbox] = $[colorbox] = function (options, callback) {
<a name="l00210"></a>00210             var $this = <span class="keyword">this</span>;
<a name="l00211"></a>00211             
<a name="l00212"></a>00212             <span class="keywordflow">if</span> (!$this[0] &amp;&amp; $this.selector) { <span class="comment">// if a selector was given and it didn&#39;t match any elements, go ahead and exit.</span>
<a name="l00213"></a>00213                   <span class="keywordflow">return</span> $this;
<a name="l00214"></a>00214             }
<a name="l00215"></a>00215             
<a name="l00216"></a>00216             options = options || {};
<a name="l00217"></a>00217             
<a name="l00218"></a>00218             <span class="keywordflow">if</span> (callback) {
<a name="l00219"></a>00219                   options.onComplete = callback;
<a name="l00220"></a>00220             }
<a name="l00221"></a>00221             
<a name="l00222"></a>00222             <span class="keywordflow">if</span> (!$this[0] || $this.selector === undefined) { <span class="comment">// detects $.colorbox() and $.fn.colorbox()</span>
<a name="l00223"></a>00223                   $this = $(<span class="stringliteral">&#39;&lt;a/&gt;&#39;</span>);
<a name="l00224"></a>00224                   options.open = <span class="keyword">true</span>; <span class="comment">// assume an immediate open</span>
<a name="l00225"></a>00225             }
<a name="l00226"></a>00226             
<a name="l00227"></a>00227             $this.<a class="code" href="jquery-1_84_82_8min_8js.html#af26dafe485841955325b4da81685341e">each</a>(function () {
<a name="l00228"></a>00228                   $(<span class="keyword">this</span>).data(colorbox, $.<a class="code" href="core_8php.html#a1c2422e2f6958b2e69483a83dad5297c">extend</a>({}, $(<span class="keyword">this</span>).data(colorbox) || defaults, options)).addClass(boxElement);
<a name="l00229"></a>00229             });
<a name="l00230"></a>00230             
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (options.open) {
<a name="l00232"></a>00232                   launch($this[0]);
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234             
<a name="l00235"></a>00235             <span class="keywordflow">return</span> $this;
<a name="l00236"></a>00236       };
<a name="l00237"></a>00237 
<a name="l00238"></a>00238       <span class="comment">// Initialize ColorBox: store common calculations, preload the interface graphics, append the html.</span>
<a name="l00239"></a>00239       <span class="comment">// This preps colorbox for a speedy open when clicked, and lightens the burdon on the browser by only</span>
<a name="l00240"></a>00240       <span class="comment">// having to run once, instead of each time colorbox is opened.</span>
<a name="l00241"></a>00241       publicMethod.init = function () {
<a name="l00242"></a>00242             <span class="comment">// Create &amp; Append jQuery Objects</span>
<a name="l00243"></a>00243             $window = $(<a class="code" href="jquery-1_84_82_8js.html#ad55530ae1e5978df8e721017c1fc8466">window</a>);
<a name="l00244"></a>00244             $box = $div().attr({<span class="keywordtype">id</span>: colorbox, <span class="stringliteral">&#39;class&#39;</span>: isIE ? prefix + <span class="stringliteral">&#39;IE&#39;</span> : <span class="stringliteral">&#39;&#39;</span>});
<a name="l00245"></a>00245             $overlay = $div(<span class="stringliteral">&quot;Overlay&quot;</span>, isIE6 ? <span class="stringliteral">&#39;position:absolute&#39;</span> : <span class="stringliteral">&#39;&#39;</span>).hide();
<a name="l00246"></a>00246             
<a name="l00247"></a>00247             $wrap = $div(<span class="stringliteral">&quot;Wrapper&quot;</span>);
<a name="l00248"></a>00248             $content = $div(<span class="stringliteral">&quot;Content&quot;</span>).append(
<a name="l00249"></a>00249                   $loaded = $div(<span class="stringliteral">&quot;LoadedContent&quot;</span>, <span class="stringliteral">&#39;width:0; height:0&#39;</span>),
<a name="l00250"></a>00250                   $loadingOverlay = $div(<span class="stringliteral">&quot;LoadingOverlay&quot;</span>).add($div(<span class="stringliteral">&quot;LoadingGraphic&quot;</span>)),
<a name="l00251"></a>00251                   $title = $div(<span class="stringliteral">&quot;Title&quot;</span>),
<a name="l00252"></a>00252                   $current = $div(<span class="stringliteral">&quot;Current&quot;</span>),
<a name="l00253"></a>00253                   $next = $div(<span class="stringliteral">&quot;Next&quot;</span>),
<a name="l00254"></a>00254                   $prev = $div(<span class="stringliteral">&quot;Previous&quot;</span>),
<a name="l00255"></a>00255                   $slideshow = $div(<span class="stringliteral">&quot;Slideshow&quot;</span>),
<a name="l00256"></a>00256                   $close = $div(<span class="stringliteral">&quot;Close&quot;</span>)
<a name="l00257"></a>00257             );
<a name="l00258"></a>00258             $wrap.append( <span class="comment">// The 3x3 Grid that makes up ColorBox</span>
<a name="l00259"></a>00259                   $div().append(
<a name="l00260"></a>00260                         $div(<span class="stringliteral">&quot;TopLeft&quot;</span>),
<a name="l00261"></a>00261                         $topBorder = $div(<span class="stringliteral">&quot;TopCenter&quot;</span>),
<a name="l00262"></a>00262                         $div(<span class="stringliteral">&quot;TopRight&quot;</span>)
<a name="l00263"></a>00263                   ),
<a name="l00264"></a>00264                   $div().append(
<a name="l00265"></a>00265                         $leftBorder = $div(<span class="stringliteral">&quot;MiddleLeft&quot;</span>),
<a name="l00266"></a>00266                         $content,
<a name="l00267"></a>00267                         $rightBorder = $div(<span class="stringliteral">&quot;MiddleRight&quot;</span>)
<a name="l00268"></a>00268                   ),
<a name="l00269"></a>00269                   $div().append(
<a name="l00270"></a>00270                         $div(<span class="stringliteral">&quot;BottomLeft&quot;</span>),
<a name="l00271"></a>00271                         $bottomBorder = $div(<span class="stringliteral">&quot;BottomCenter&quot;</span>),
<a name="l00272"></a>00272                         $div(<span class="stringliteral">&quot;BottomRight&quot;</span>)
<a name="l00273"></a>00273                   )
<a name="l00274"></a>00274             ).children().children().css({<span class="stringliteral">&#39;float&#39;</span>: <span class="stringliteral">&#39;left&#39;</span>});
<a name="l00275"></a>00275             
<a name="l00276"></a>00276             $loadingBay = $div(<span class="keyword">false</span>, <span class="stringliteral">&#39;position:absolute; width:9999px; visibility:hidden; display:none&#39;</span>);
<a name="l00277"></a>00277             
<a name="l00278"></a>00278             $(<span class="stringliteral">&#39;body&#39;</span>).prepend($overlay, $box.append($wrap, $loadingBay));
<a name="l00279"></a>00279             
<a name="l00280"></a>00280             $content.children()
<a name="l00281"></a>00281             .hover(function () {
<a name="l00282"></a>00282                   $(<span class="keyword">this</span>).addClass(<span class="stringliteral">&#39;hover&#39;</span>);
<a name="l00283"></a>00283             }, function () {
<a name="l00284"></a>00284                   $(<span class="keyword">this</span>).removeClass(<span class="stringliteral">&#39;hover&#39;</span>);
<a name="l00285"></a>00285             }).addClass(<span class="stringliteral">&#39;hover&#39;</span>);
<a name="l00286"></a>00286             
<a name="l00287"></a>00287             <span class="comment">// Cache values needed for size calculations</span>
<a name="l00288"></a>00288             interfaceHeight = $topBorder.height() + $bottomBorder.height() + $content.outerHeight(<span class="keyword">true</span>) - $content.height();<span class="comment">//Subtraction needed for IE6</span>
<a name="l00289"></a>00289             interfaceWidth = $leftBorder.width() + $rightBorder.width() + $content.outerWidth(<span class="keyword">true</span>) - $content.width();
<a name="l00290"></a>00290             loadedHeight = $loaded.outerHeight(<span class="keyword">true</span>);
<a name="l00291"></a>00291             loadedWidth = $loaded.outerWidth(<span class="keyword">true</span>);
<a name="l00292"></a>00292             
<a name="l00293"></a>00293             <span class="comment">// Setting padding to remove the need to do size conversions during the animation step.</span>
<a name="l00294"></a>00294             $box.css({<span class="stringliteral">&quot;padding-bottom&quot;</span>: interfaceHeight, <span class="stringliteral">&quot;padding-right&quot;</span>: interfaceWidth}).hide();
<a name="l00295"></a>00295             
<a name="l00296"></a>00296             <span class="comment">// Setup button events.</span>
<a name="l00297"></a>00297             $next.click(publicMethod.next);
<a name="l00298"></a>00298             $prev.click(publicMethod.prev);
<a name="l00299"></a>00299             $close.click(publicMethod.close);
<a name="l00300"></a>00300             
<a name="l00301"></a>00301             <span class="comment">// Adding the &#39;hover&#39; class allowed the browser to load the hover-state</span>
<a name="l00302"></a>00302             <span class="comment">// background graphics.  The class can now can be removed.</span>
<a name="l00303"></a>00303             $content.children().removeClass(<span class="stringliteral">&#39;hover&#39;</span>);
<a name="l00304"></a>00304             
<a name="l00305"></a>00305             $(<span class="charliteral">&#39;.&#39;</span> + boxElement).live(<span class="stringliteral">&#39;click&#39;</span>, function (e) {
<a name="l00306"></a>00306                   <span class="comment">// checks to see if it was a non-left mouse-click and for clicks modified with ctrl, shift, or alt.</span>
<a name="l00307"></a>00307                   <span class="keywordflow">if</span> ((e.button !== 0 &amp;&amp; typeof e.button !== <span class="stringliteral">&#39;undefined&#39;</span>) || e.ctrlKey || e.shiftKey || e.altKey) {
<a name="l00308"></a>00308                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00309"></a>00309                   } <span class="keywordflow">else</span> {
<a name="l00310"></a>00310                         launch(<span class="keyword">this</span>);                 
<a name="l00311"></a>00311                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00312"></a>00312                   }
<a name="l00313"></a>00313             });
<a name="l00314"></a>00314             
<a name="l00315"></a>00315             $overlay.click(function () {
<a name="l00316"></a>00316                   <span class="keywordflow">if</span> (settings.overlayClose) {
<a name="l00317"></a>00317                         publicMethod.close();
<a name="l00318"></a>00318                   }
<a name="l00319"></a>00319             });
<a name="l00320"></a>00320             
<a name="l00321"></a>00321             <span class="comment">// Set Navigation Key Bindings</span>
<a name="l00322"></a>00322             $(document).bind(<span class="stringliteral">&quot;keydown&quot;</span>, function (e) {
<a name="l00323"></a>00323                   <span class="keywordflow">if</span> (open &amp;&amp; settings.escKey &amp;&amp; e.keyCode === 27) {
<a name="l00324"></a>00324                         e.preventDefault();
<a name="l00325"></a>00325                         publicMethod.close();
<a name="l00326"></a>00326                   }
<a name="l00327"></a>00327                   <span class="keywordflow">if</span> (open &amp;&amp; settings.arrowKey &amp;&amp; !active &amp;&amp; $related[1]) {
<a name="l00328"></a>00328                         <span class="keywordflow">if</span> (e.keyCode === 37 &amp;&amp; (index || settings.loop)) {
<a name="l00329"></a>00329                               e.preventDefault();
<a name="l00330"></a>00330                               $prev.click();
<a name="l00331"></a>00331                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (e.keyCode === 39 &amp;&amp; (index &lt; $related.length - 1 || settings.loop)) {
<a name="l00332"></a>00332                               e.preventDefault();
<a name="l00333"></a>00333                               $next.click();
<a name="l00334"></a>00334                         }
<a name="l00335"></a>00335                   }
<a name="l00336"></a>00336             });
<a name="l00337"></a>00337       };
<a name="l00338"></a>00338       
<a name="l00339"></a>00339       publicMethod.remove = function () {
<a name="l00340"></a>00340             $box.add($overlay).remove();
<a name="l00341"></a>00341             $(<span class="charliteral">&#39;.&#39;</span> + boxElement).die(<span class="stringliteral">&#39;click&#39;</span>).removeData(colorbox).removeClass(boxElement);
<a name="l00342"></a>00342       };
<a name="l00343"></a>00343 
<a name="l00344"></a>00344       publicMethod.position = function (speed, loadedCallback) {
<a name="l00345"></a>00345             var
<a name="l00346"></a>00346             animate_speed,
<a name="l00347"></a>00347             <span class="comment">// keeps the top and left positions within the browser&#39;s viewport.</span>
<a name="l00348"></a>00348             posTop = Math.max($window.height() - settings.h - loadedHeight - interfaceHeight, 0) / 2 + $window.scrollTop(),
<a name="l00349"></a>00349             posLeft = Math.max($window.width() - settings.w - loadedWidth - interfaceWidth, 0) / 2 + $window.scrollLeft();
<a name="l00350"></a>00350             
<a name="l00351"></a>00351             <span class="comment">// setting the speed to 0 to reduce the delay between same-sized content.</span>
<a name="l00352"></a>00352             animate_speed = ($box.width() === settings.w + loadedWidth &amp;&amp; $box.height() === settings.h + loadedHeight) ? 0 : speed;
<a name="l00353"></a>00353             
<a name="l00354"></a>00354             <span class="comment">// this gives the wrapper plenty of breathing room so it&#39;s floated contents can move around smoothly,</span>
<a name="l00355"></a>00355             <span class="comment">// but it has to be shrank down around the size of div#colorbox when it&#39;s done.  If not,</span>
<a name="l00356"></a>00356             <span class="comment">// it can invoke an obscure IE bug when using iframes.</span>
<a name="l00357"></a>00357             $wrap[0].style.width = $wrap[0].style.height = <span class="stringliteral">&quot;9999px&quot;</span>;
<a name="l00358"></a>00358             
<a name="l00359"></a>00359             function modalDimensions(that) {
<a name="l00360"></a>00360                   <span class="comment">// loading overlay height has to be explicitly set for IE6.</span>
<a name="l00361"></a>00361                   $topBorder[0].style.width = $bottomBorder[0].style.width = $content[0].style.width = that.style.width;
<a name="l00362"></a>00362                   $loadingOverlay[0].style.height = $loadingOverlay[1].style.height = $content[0].style.height = $leftBorder[0].style.height = $rightBorder[0].style.height = that.style.height;
<a name="l00363"></a>00363             }
<a name="l00364"></a>00364             
<a name="l00365"></a>00365             $box.dequeue().animate({width: settings.w + loadedWidth, height: settings.h + loadedHeight, top: posTop, left: posLeft}, {
<a name="l00366"></a>00366                   duration: animate_speed,
<a name="l00367"></a>00367                   complete: function () {
<a name="l00368"></a>00368                         modalDimensions(<span class="keyword">this</span>);
<a name="l00369"></a>00369                         
<a name="l00370"></a>00370                         active = <span class="keyword">false</span>;
<a name="l00371"></a>00371                         
<a name="l00372"></a>00372                         <span class="comment">// shrink the wrapper down to exactly the size of colorbox to avoid a bug in IE&#39;s iframe implementation.</span>
<a name="l00373"></a>00373                         $wrap[0].style.width = (settings.w + loadedWidth + interfaceWidth) + <span class="stringliteral">&quot;px&quot;</span>;
<a name="l00374"></a>00374                         $wrap[0].style.height = (settings.h + loadedHeight + interfaceHeight) + <span class="stringliteral">&quot;px&quot;</span>;
<a name="l00375"></a>00375                         
<a name="l00376"></a>00376                         <span class="keywordflow">if</span> (loadedCallback) {
<a name="l00377"></a>00377                               loadedCallback();
<a name="l00378"></a>00378                         }
<a name="l00379"></a>00379                   },
<a name="l00380"></a>00380                   step: function () {
<a name="l00381"></a>00381                         modalDimensions(<span class="keyword">this</span>);
<a name="l00382"></a>00382                   }
<a name="l00383"></a>00383             });
<a name="l00384"></a>00384       };
<a name="l00385"></a>00385 
<a name="l00386"></a>00386       publicMethod.resize = function (options) {
<a name="l00387"></a>00387             <span class="keywordflow">if</span> (open) {
<a name="l00388"></a>00388                   options = options || {};
<a name="l00389"></a>00389                   
<a name="l00390"></a>00390                   <span class="keywordflow">if</span> (options.width) {
<a name="l00391"></a>00391                         settings.w = setSize(options.width, <span class="charliteral">&#39;x&#39;</span>) - loadedWidth - interfaceWidth;
<a name="l00392"></a>00392                   }
<a name="l00393"></a>00393                   <span class="keywordflow">if</span> (options.innerWidth) {
<a name="l00394"></a>00394                         settings.w = setSize(options.innerWidth, <span class="charliteral">&#39;x&#39;</span>);
<a name="l00395"></a>00395                   }
<a name="l00396"></a>00396                   $loaded.css({width: settings.w});
<a name="l00397"></a>00397                   
<a name="l00398"></a>00398                   <span class="keywordflow">if</span> (options.height) {
<a name="l00399"></a>00399                         settings.h = setSize(options.height, <span class="charliteral">&#39;y&#39;</span>) - loadedHeight - interfaceHeight;
<a name="l00400"></a>00400                   }
<a name="l00401"></a>00401                   <span class="keywordflow">if</span> (options.innerHeight) {
<a name="l00402"></a>00402                         settings.h = setSize(options.innerHeight, <span class="charliteral">&#39;y&#39;</span>);
<a name="l00403"></a>00403                   }
<a name="l00404"></a>00404                   <span class="keywordflow">if</span> (!options.innerHeight &amp;&amp; !options.height) {                    
<a name="l00405"></a>00405                         var $child = $loaded.wrapInner(<span class="stringliteral">&quot;&lt;div style=&#39;overflow:auto&#39;&gt;&lt;/div&gt;&quot;</span>).children(); <span class="comment">// temporary wrapper to get an accurate estimate of just how high the total content should be.</span>
<a name="l00406"></a>00406                         settings.h = $child.height();
<a name="l00407"></a>00407                         $child.replaceWith($child.children()); <span class="comment">// ditch the temporary wrapper div used in height calculation</span>
<a name="l00408"></a>00408                   }
<a name="l00409"></a>00409                   $loaded.css({height: settings.h});
<a name="l00410"></a>00410                   
<a name="l00411"></a>00411                   publicMethod.position(settings.transition === <span class="stringliteral">&quot;none&quot;</span> ? 0 : settings.speed);
<a name="l00412"></a>00412             }
<a name="l00413"></a>00413       };
<a name="l00414"></a>00414 
<a name="l00415"></a>00415       publicMethod.prep = function (<span class="keywordtype">object</span>) {
<a name="l00416"></a>00416             <span class="keywordflow">if</span> (!open) {
<a name="l00417"></a>00417                   <span class="keywordflow">return</span>;
<a name="l00418"></a>00418             }
<a name="l00419"></a>00419             
<a name="l00420"></a>00420             var photo,
<a name="l00421"></a>00421             speed = settings.transition === <span class="stringliteral">&quot;none&quot;</span> ? 0 : settings.speed;
<a name="l00422"></a>00422             
<a name="l00423"></a>00423             $window.unbind(<span class="stringliteral">&#39;resize.&#39;</span> + prefix);
<a name="l00424"></a>00424             $loaded.remove();
<a name="l00425"></a>00425             $loaded = $div(<span class="stringliteral">&#39;LoadedContent&#39;</span>).html(<span class="keywordtype">object</span>);
<a name="l00426"></a>00426             
<a name="l00427"></a>00427             function getWidth() {
<a name="l00428"></a>00428                   settings.w = settings.w || $loaded.width();
<a name="l00429"></a>00429                   settings.w = settings.mw &amp;&amp; settings.mw &lt; settings.w ? settings.mw : settings.w;
<a name="l00430"></a>00430                   <span class="keywordflow">return</span> settings.w;
<a name="l00431"></a>00431             }
<a name="l00432"></a>00432             function getHeight() {
<a name="l00433"></a>00433                   settings.h = settings.h || $loaded.height();
<a name="l00434"></a>00434                   settings.h = settings.mh &amp;&amp; settings.mh &lt; settings.h ? settings.mh : settings.h;
<a name="l00435"></a>00435                   <span class="keywordflow">return</span> settings.h;
<a name="l00436"></a>00436             }
<a name="l00437"></a>00437             
<a name="l00438"></a>00438             $loaded.hide()
<a name="l00439"></a>00439             .appendTo($loadingBay.show())<span class="comment">// content has to be appended to the DOM for accurate size calculations.</span>
<a name="l00440"></a>00440             .css({width: getWidth(), overflow: settings.scrolling ? <span class="stringliteral">&#39;auto&#39;</span> : <span class="stringliteral">&#39;hidden&#39;</span>})
<a name="l00441"></a>00441             .css({height: getHeight()})<span class="comment">// sets the height independently from the width in case the new width influences the value of height.</span>
<a name="l00442"></a>00442             .prependTo($content);
<a name="l00443"></a>00443             
<a name="l00444"></a>00444             $loadingBay.hide();
<a name="l00445"></a>00445             
<a name="l00446"></a>00446             $(<span class="charliteral">&#39;#&#39;</span> + prefix + <span class="stringliteral">&#39;Photo&#39;</span>).css({cssFloat: <span class="stringliteral">&#39;none&#39;</span>});<span class="comment">// floating the IMG removes the bottom line-height and fixed a problem where IE miscalculates the width of the parent element as 100% of the document width.</span>
<a name="l00447"></a>00447             
<a name="l00448"></a>00448             <span class="comment">// Hides SELECT elements in IE6 because they would otherwise sit on top of the overlay.</span>
<a name="l00449"></a>00449             <span class="keywordflow">if</span> (isIE6) {
<a name="l00450"></a>00450                   $(<span class="stringliteral">&#39;select&#39;</span>).not($box.find(<span class="stringliteral">&#39;select&#39;</span>)).filter(function () {
<a name="l00451"></a>00451                         <span class="keywordflow">return</span> this.style.visibility !== <span class="stringliteral">&#39;hidden&#39;</span>;
<a name="l00452"></a>00452                   }).css({<span class="stringliteral">&#39;visibility&#39;</span>: <span class="stringliteral">&#39;hidden&#39;</span>}).one(event_cleanup, function () {
<a name="l00453"></a>00453                         this.style.visibility = <span class="stringliteral">&#39;inherit&#39;</span>;
<a name="l00454"></a>00454                   });
<a name="l00455"></a>00455             }
<a name="l00456"></a>00456                         
<a name="l00457"></a>00457             function setPosition(s) {
<a name="l00458"></a>00458                   var prev, prevSrc, next, nextSrc, total = $related.length, loop = settings.loop;
<a name="l00459"></a>00459                   publicMethod.position(s, function () {
<a name="l00460"></a>00460                         function defilter() {
<a name="l00461"></a>00461                               <span class="keywordflow">if</span> (isIE) {
<a name="l00462"></a>00462                                     <span class="comment">//IE adds a filter when ColorBox fades in and out that can cause problems if the loaded content contains transparent pngs.</span>
<a name="l00463"></a>00463                                     $box[0].style.removeAttribute(<span class="stringliteral">&quot;filter&quot;</span>);
<a name="l00464"></a>00464                               }
<a name="l00465"></a>00465                         }
<a name="l00466"></a>00466                         
<a name="l00467"></a>00467                         <span class="keywordflow">if</span> (!open) {
<a name="l00468"></a>00468                               <span class="keywordflow">return</span>;
<a name="l00469"></a>00469                         }
<a name="l00470"></a>00470                         
<a name="l00471"></a>00471                         <span class="keywordflow">if</span> (isIE) {
<a name="l00472"></a>00472                               <span class="comment">//This fadeIn helps the bicubic resampling to kick-in.</span>
<a name="l00473"></a>00473                               <span class="keywordflow">if</span> (photo) {
<a name="l00474"></a>00474                                     $loaded.fadeIn(100);
<a name="l00475"></a>00475                               }
<a name="l00476"></a>00476                         }
<a name="l00477"></a>00477                         
<a name="l00478"></a>00478                         <span class="comment">//Waited until the iframe is added to the DOM &amp; it is visible before setting the src.</span>
<a name="l00479"></a>00479                         <span class="comment">//This increases compatability with pages using DOM dependent JavaScript.</span>
<a name="l00480"></a>00480                         <span class="keywordflow">if</span> (settings.iframe) {
<a name="l00481"></a>00481                               $(<span class="stringliteral">&quot;&lt;iframe frameborder=0&quot;</span> + (settings.scrolling ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; scrolling=&#39;no&#39;&quot;</span>) + (isIE ? <span class="stringliteral">&quot; allowtransparency=&#39;true&#39;&quot;</span> : <span class="stringliteral">&#39;&#39;</span>) + <span class="stringliteral">&quot;/&gt;&quot;</span>)
<a name="l00482"></a>00482                               .attr({src: settings.href, name: <span class="keyword">new</span> Date().getTime()})
<a name="l00483"></a>00483                               .appendTo($loaded);
<a name="l00484"></a>00484                         }
<a name="l00485"></a>00485                         
<a name="l00486"></a>00486                         $loaded.show();
<a name="l00487"></a>00487                         
<a name="l00488"></a>00488                         $title.show().html(settings.title);
<a name="l00489"></a>00489                         
<a name="l00490"></a>00490                         <span class="keywordflow">if</span> (total &gt; 1) { <span class="comment">// handle grouping</span>
<a name="l00491"></a>00491                               $current.html(settings.current.replace(/\{current\}/, index + 1).replace(/\{total\}/, total)).show();
<a name="l00492"></a>00492                               
<a name="l00493"></a>00493                               $next[(loop || index &lt; total - 1) ? <span class="stringliteral">&quot;show&quot;</span> : <span class="stringliteral">&quot;hide&quot;</span>]().html(settings.next);
<a name="l00494"></a>00494                               $prev[(loop || index) ? <span class="stringliteral">&quot;show&quot;</span> : <span class="stringliteral">&quot;hide&quot;</span>]().html(settings.previous);
<a name="l00495"></a>00495                               
<a name="l00496"></a>00496                               prev = index ? $related[index - 1] : $related[total - 1];
<a name="l00497"></a>00497                               next = index &lt; total - 1 ? $related[index + 1] : $related[0];
<a name="l00498"></a>00498                               
<a name="l00499"></a>00499                               <span class="keywordflow">if</span> (settings.slideshow) {
<a name="l00500"></a>00500                                     $slideshow.show();
<a name="l00501"></a>00501                                     <span class="keywordflow">if</span> (index === total - 1 &amp;&amp; !loop &amp;&amp; $box.is(<span class="charliteral">&#39;.&#39;</span> + prefix + <span class="stringliteral">&#39;Slideshow_on&#39;</span>)) {
<a name="l00502"></a>00502                                           $slideshow.click();
<a name="l00503"></a>00503                                     }
<a name="l00504"></a>00504                               }
<a name="l00505"></a>00505                               
<a name="l00506"></a>00506                               <span class="comment">// Preloads images within a rel group</span>
<a name="l00507"></a>00507                               <span class="keywordflow">if</span> (settings.preloading) {
<a name="l00508"></a>00508                                     nextSrc = $(next).data(colorbox).href || next.href;
<a name="l00509"></a>00509                                     prevSrc = $(prev).data(colorbox).href || prev.href;
<a name="l00510"></a>00510                                     
<a name="l00511"></a>00511                                     <span class="keywordflow">if</span> (isImage(nextSrc)) {
<a name="l00512"></a>00512                                           $(<span class="stringliteral">&#39;&lt;img/&gt;&#39;</span>)[0].src = nextSrc;
<a name="l00513"></a>00513                                     }
<a name="l00514"></a>00514                                     
<a name="l00515"></a>00515                                     <span class="keywordflow">if</span> (isImage(prevSrc)) {
<a name="l00516"></a>00516                                           $(<span class="stringliteral">&#39;&lt;img/&gt;&#39;</span>)[0].src = prevSrc;
<a name="l00517"></a>00517                                     }
<a name="l00518"></a>00518                               }
<a name="l00519"></a>00519                         }
<a name="l00520"></a>00520                         
<a name="l00521"></a>00521                         $loadingOverlay.hide();
<a name="l00522"></a>00522                         
<a name="l00523"></a>00523                         <span class="keywordflow">if</span> (settings.transition === <span class="stringliteral">&#39;fade&#39;</span>) {
<a name="l00524"></a>00524                               $box.fadeTo(speed, 1, function () {
<a name="l00525"></a>00525                                     defilter();
<a name="l00526"></a>00526                               });
<a name="l00527"></a>00527                         } <span class="keywordflow">else</span> {
<a name="l00528"></a>00528                               defilter();
<a name="l00529"></a>00529                         }
<a name="l00530"></a>00530                         
<a name="l00531"></a>00531                         $window.bind(<span class="stringliteral">&#39;resize.&#39;</span> + prefix, function () {
<a name="l00532"></a>00532                               publicMethod.position(0);
<a name="l00533"></a>00533                         });
<a name="l00534"></a>00534                         
<a name="l00535"></a>00535                         $.event.trigger(event_complete);
<a name="l00536"></a>00536                         <span class="keywordflow">if</span> (settings.onComplete) {
<a name="l00537"></a>00537                               settings.onComplete.call(element);
<a name="l00538"></a>00538                         }
<a name="l00539"></a>00539                   });
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541             
<a name="l00542"></a>00542             <span class="keywordflow">if</span> (settings.transition === <span class="stringliteral">&#39;fade&#39;</span>) {
<a name="l00543"></a>00543                   $box.fadeTo(speed, 0, function () {
<a name="l00544"></a>00544                         setPosition(0);
<a name="l00545"></a>00545                   });
<a name="l00546"></a>00546             } <span class="keywordflow">else</span> {
<a name="l00547"></a>00547                   setPosition(speed);
<a name="l00548"></a>00548             }
<a name="l00549"></a>00549       };
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       publicMethod.load = function () {
<a name="l00552"></a>00552             var href, img, setResize, prep = publicMethod.prep;
<a name="l00553"></a>00553             
<a name="l00554"></a>00554             active = <span class="keyword">true</span>;
<a name="l00555"></a>00555             
<a name="l00556"></a>00556             element = $related[index];
<a name="l00557"></a>00557             
<a name="l00558"></a>00558             settings = $.extend({}, $(element).data(colorbox));
<a name="l00559"></a>00559             
<a name="l00560"></a>00560             <span class="comment">//convert functions to static values</span>
<a name="l00561"></a>00561             process();
<a name="l00562"></a>00562             
<a name="l00563"></a>00563             $.event.trigger(event_load);
<a name="l00564"></a>00564             <span class="keywordflow">if</span> (settings.onLoad) {
<a name="l00565"></a>00565                   settings.onLoad.call(element);
<a name="l00566"></a>00566             }
<a name="l00567"></a>00567             
<a name="l00568"></a>00568             settings.h = settings.height ?
<a name="l00569"></a>00569                         setSize(settings.height, <span class="charliteral">&#39;y&#39;</span>) - loadedHeight - interfaceHeight :
<a name="l00570"></a>00570                         settings.innerHeight &amp;&amp; setSize(settings.innerHeight, <span class="charliteral">&#39;y&#39;</span>);
<a name="l00571"></a>00571             
<a name="l00572"></a>00572             settings.w = settings.width ?
<a name="l00573"></a>00573                         setSize(settings.width, <span class="charliteral">&#39;x&#39;</span>) - loadedWidth - interfaceWidth :
<a name="l00574"></a>00574                         settings.innerWidth &amp;&amp; setSize(settings.innerWidth, <span class="charliteral">&#39;x&#39;</span>);
<a name="l00575"></a>00575             
<a name="l00576"></a>00576             <span class="comment">// Sets the minimum dimensions for use in image scaling</span>
<a name="l00577"></a>00577             settings.mw = settings.w;
<a name="l00578"></a>00578             settings.mh = settings.h;
<a name="l00579"></a>00579             
<a name="l00580"></a>00580             <span class="comment">// Re-evaluate the minimum width and height based on maxWidth and maxHeight values.</span>
<a name="l00581"></a>00581             <span class="comment">// If the width or height exceed the maxWidth or maxHeight, use the maximum values instead.</span>
<a name="l00582"></a>00582             <span class="keywordflow">if</span> (settings.maxWidth) {
<a name="l00583"></a>00583                   settings.mw = setSize(settings.maxWidth, <span class="charliteral">&#39;x&#39;</span>) - loadedWidth - interfaceWidth;
<a name="l00584"></a>00584                   settings.mw = settings.w &amp;&amp; settings.w &lt; settings.mw ? settings.w : settings.mw;
<a name="l00585"></a>00585             }
<a name="l00586"></a>00586             <span class="keywordflow">if</span> (settings.maxHeight) {
<a name="l00587"></a>00587                   settings.mh = setSize(settings.maxHeight, <span class="charliteral">&#39;y&#39;</span>) - loadedHeight - interfaceHeight;
<a name="l00588"></a>00588                   settings.mh = settings.h &amp;&amp; settings.h &lt; settings.mh ? settings.h : settings.mh;
<a name="l00589"></a>00589             }
<a name="l00590"></a>00590             
<a name="l00591"></a>00591             href = settings.href;
<a name="l00592"></a>00592             
<a name="l00593"></a>00593             $loadingOverlay.show();
<a name="l00594"></a>00594             
<a name="l00595"></a>00595             <span class="keywordflow">if</span> (settings.inline) {
<a name="l00596"></a>00596                   <span class="comment">// Inserts an empty placeholder where inline content is being pulled from.</span>
<a name="l00597"></a>00597                   <span class="comment">// An event is bound to put inline content back when ColorBox closes or loads new content.</span>
<a name="l00598"></a>00598                   $div(<span class="stringliteral">&#39;InlineTemp&#39;</span>).hide().insertBefore($(href)[0]).bind(event_load + <span class="charliteral">&#39; &#39;</span> + event_cleanup, function () {
<a name="l00599"></a>00599                         $(<span class="keyword">this</span>).replaceWith($loaded.children());
<a name="l00600"></a>00600                   });
<a name="l00601"></a>00601                   prep($(href));
<a name="l00602"></a>00602             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.iframe) {
<a name="l00603"></a>00603                   <span class="comment">// IFrame element won&#39;t be added to the DOM until it is ready to be displayed,</span>
<a name="l00604"></a>00604                   <span class="comment">// to avoid problems with DOM-ready JS that might be trying to run in that iframe.</span>
<a name="l00605"></a>00605                   prep(<span class="stringliteral">&quot; &quot;</span>);
<a name="l00606"></a>00606             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings.html) {
<a name="l00607"></a>00607                   prep(settings.html);
<a name="l00608"></a>00608             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isImage(href)) {
<a name="l00609"></a>00609                   img = <span class="keyword">new</span> Image();
<a name="l00610"></a>00610                   img.onload = function () {
<a name="l00611"></a>00611                         var percent;
<a name="l00612"></a>00612                         
<a name="l00613"></a>00613                         img.onload = null;
<a name="l00614"></a>00614                         img.id = prefix + <span class="stringliteral">&#39;Photo&#39;</span>;
<a name="l00615"></a>00615                         $(img).css({margin: <span class="stringliteral">&#39;auto&#39;</span>, border: <span class="stringliteral">&#39;none&#39;</span>, display: <span class="stringliteral">&#39;block&#39;</span>, cssFloat: <span class="stringliteral">&#39;left&#39;</span>});
<a name="l00616"></a>00616                         
<a name="l00617"></a>00617                         <span class="keywordflow">if</span> (settings.scalePhotos) {
<a name="l00618"></a>00618                               setResize = function () {
<a name="l00619"></a>00619                                     img.height -= img.height * percent;
<a name="l00620"></a>00620                                     img.width -= img.width * percent;   
<a name="l00621"></a>00621                               };
<a name="l00622"></a>00622                               <span class="keywordflow">if</span> (settings.mw &amp;&amp; img.width &gt; settings.mw) {
<a name="l00623"></a>00623                                     percent = (img.width - settings.mw) / img.width;
<a name="l00624"></a>00624                                     setResize();
<a name="l00625"></a>00625                               }
<a name="l00626"></a>00626                               <span class="keywordflow">if</span> (settings.mh &amp;&amp; img.height &gt; settings.mh) {
<a name="l00627"></a>00627                                     percent = (img.height - settings.mh) / img.height;
<a name="l00628"></a>00628                                     setResize();
<a name="l00629"></a>00629                               }
<a name="l00630"></a>00630                         }
<a name="l00631"></a>00631                         
<a name="l00632"></a>00632                         <span class="keywordflow">if</span> (settings.h) {
<a name="l00633"></a>00633                               img.style.marginTop = Math.max(settings.h - img.height, 0) / 2 + <span class="stringliteral">&#39;px&#39;</span>;
<a name="l00634"></a>00634                         }
<a name="l00635"></a>00635                         
<a name="l00636"></a>00636                         setTimeout(function () { <span class="comment">// Chrome will sometimes report a 0 by 0 size if there isn&#39;t pause in execution</span>
<a name="l00637"></a>00637                               prep(img);
<a name="l00638"></a>00638                         }, 1);
<a name="l00639"></a>00639                         
<a name="l00640"></a>00640                         <span class="keywordflow">if</span> ($related[1] &amp;&amp; (index &lt; $related.length - 1 || settings.loop)) {
<a name="l00641"></a>00641                               $(img).css({cursor: <span class="stringliteral">&#39;pointer&#39;</span>}).click(publicMethod.next);
<a name="l00642"></a>00642                         }
<a name="l00643"></a>00643                         
<a name="l00644"></a>00644                         <span class="keywordflow">if</span> (isIE) {
<a name="l00645"></a>00645                               img.style.msInterpolationMode = <span class="stringliteral">&#39;bicubic&#39;</span>;
<a name="l00646"></a>00646                         }
<a name="l00647"></a>00647                   };
<a name="l00648"></a>00648                   img.src = href;
<a name="l00649"></a>00649             } <span class="keywordflow">else</span> {
<a name="l00650"></a>00650                   $div().appendTo($loadingBay).load(href, function (data, status, xhr) {
<a name="l00651"></a>00651                         prep(status === <span class="stringliteral">&#39;error&#39;</span> ? <span class="stringliteral">&#39;Request unsuccessful: &#39;</span> + xhr.statusText : <span class="keyword">this</span>);
<a name="l00652"></a>00652                   });
<a name="l00653"></a>00653             }
<a name="l00654"></a>00654       };
<a name="l00655"></a>00655 
<a name="l00656"></a>00656       <span class="comment">// Navigates to the next page/image in a set.</span>
<a name="l00657"></a>00657       publicMethod.next = function () {
<a name="l00658"></a>00658             <span class="keywordflow">if</span> (!active) {
<a name="l00659"></a>00659                   index = index &lt; $related.length - 1 ? index + 1 : 0;
<a name="l00660"></a>00660                   publicMethod.load();
<a name="l00661"></a>00661             }
<a name="l00662"></a>00662       };
<a name="l00663"></a>00663       
<a name="l00664"></a>00664       publicMethod.prev = function () {
<a name="l00665"></a>00665             <span class="keywordflow">if</span> (!active) {
<a name="l00666"></a>00666                   index = index ? index - 1 : $related.length - 1;
<a name="l00667"></a>00667                   publicMethod.load();
<a name="l00668"></a>00668             }
<a name="l00669"></a>00669       };
<a name="l00670"></a>00670 
<a name="l00671"></a>00671       publicMethod.slideshow = function () {
<a name="l00672"></a>00672             var stop, timeOut, className = prefix + <span class="stringliteral">&#39;Slideshow_&#39;</span>;
<a name="l00673"></a>00673             
<a name="l00674"></a>00674             $slideshow.bind(event_closed, function () {
<a name="l00675"></a>00675                   $slideshow.unbind();
<a name="l00676"></a>00676                   clearTimeout(timeOut);
<a name="l00677"></a>00677                   $box.removeClass(className + <span class="stringliteral">&quot;off &quot;</span> + className + <span class="stringliteral">&quot;on&quot;</span>);
<a name="l00678"></a>00678             });
<a name="l00679"></a>00679             
<a name="l00680"></a>00680             function start() {
<a name="l00681"></a>00681                   $slideshow
<a name="l00682"></a>00682                   .text(settings.slideshowStop)
<a name="l00683"></a>00683                   .bind(event_complete, function () {
<a name="l00684"></a>00684                         timeOut = setTimeout(publicMethod.next, settings.slideshowSpeed);
<a name="l00685"></a>00685                   })
<a name="l00686"></a>00686                   .bind(event_load, function () {
<a name="l00687"></a>00687                         clearTimeout(timeOut);  
<a name="l00688"></a>00688                   }).one(<span class="stringliteral">&quot;click&quot;</span>, function () {
<a name="l00689"></a>00689                         stop();
<a name="l00690"></a>00690                   });
<a name="l00691"></a>00691                   $box.removeClass(className + <span class="stringliteral">&quot;off&quot;</span>).addClass(className + <span class="stringliteral">&quot;on&quot;</span>);
<a name="l00692"></a>00692             }
<a name="l00693"></a>00693             
<a name="l00694"></a>00694             stop = function () {
<a name="l00695"></a>00695                   clearTimeout(timeOut);
<a name="l00696"></a>00696                   $slideshow
<a name="l00697"></a>00697                   .text(settings.slideshowStart)
<a name="l00698"></a>00698                   .unbind(event_complete + <span class="charliteral">&#39; &#39;</span> + event_load)
<a name="l00699"></a>00699                   .one(<span class="stringliteral">&quot;click&quot;</span>, function () {
<a name="l00700"></a>00700                         start();
<a name="l00701"></a>00701                         timeOut = setTimeout(publicMethod.next, settings.slideshowSpeed);
<a name="l00702"></a>00702                   });
<a name="l00703"></a>00703                   $box.removeClass(className + <span class="stringliteral">&quot;on&quot;</span>).addClass(className + <span class="stringliteral">&quot;off&quot;</span>);
<a name="l00704"></a>00704             };
<a name="l00705"></a>00705             
<a name="l00706"></a>00706             <span class="keywordflow">if</span> (settings.slideshow &amp;&amp; $related[1]) {
<a name="l00707"></a>00707                   <span class="keywordflow">if</span> (settings.slideshowAuto) {
<a name="l00708"></a>00708                         start();
<a name="l00709"></a>00709                   } <span class="keywordflow">else</span> {
<a name="l00710"></a>00710                         stop();
<a name="l00711"></a>00711                   }
<a name="l00712"></a>00712             }
<a name="l00713"></a>00713       };
<a name="l00714"></a>00714 
<a name="l00715"></a>00715       <span class="comment">// Note: to use this within an iframe use the following format: parent.$.fn.colorbox.close();</span>
<a name="l00716"></a>00716       publicMethod.close = function () {
<a name="l00717"></a>00717             <span class="keywordflow">if</span> (open) {
<a name="l00718"></a>00718                   open = <span class="keyword">false</span>;
<a name="l00719"></a>00719                   
<a name="l00720"></a>00720                   $.event.trigger(event_cleanup);
<a name="l00721"></a>00721                   
<a name="l00722"></a>00722                   <span class="keywordflow">if</span> (settings.onCleanup) {
<a name="l00723"></a>00723                         settings.onCleanup.call(element);
<a name="l00724"></a>00724                   }
<a name="l00725"></a>00725                   
<a name="l00726"></a>00726                   $window.unbind(<span class="charliteral">&#39;.&#39;</span> + prefix + <span class="stringliteral">&#39; .&#39;</span> + event_ie6);
<a name="l00727"></a>00727                   
<a name="l00728"></a>00728                   $overlay.fadeTo(<span class="stringliteral">&#39;fast&#39;</span>, 0);
<a name="l00729"></a>00729                   
<a name="l00730"></a>00730                   $box.stop().fadeTo(<span class="stringliteral">&#39;fast&#39;</span>, 0, function () {
<a name="l00731"></a>00731                         $box.find(<span class="stringliteral">&#39;iframe&#39;</span>).attr(<span class="stringliteral">&#39;src&#39;</span>, <span class="stringliteral">&#39;about:blank&#39;</span>); <span class="comment">// change the location of the iframe to avoid a problem in IE with flash objects not clearing.</span>
<a name="l00732"></a>00732                         
<a name="l00733"></a>00733                         $loaded.remove();
<a name="l00734"></a>00734                         
<a name="l00735"></a>00735                         $box.add($overlay).css({<span class="stringliteral">&#39;opacity&#39;</span>: 1, cursor: <span class="stringliteral">&#39;auto&#39;</span>}).hide();
<a name="l00736"></a>00736                         
<a name="l00737"></a>00737                         <span class="keywordflow">try</span> {
<a name="l00738"></a>00738                               bookmark.focus();
<a name="l00739"></a>00739                         } <span class="keywordflow">catch</span> (e) {
<a name="l00740"></a>00740                               <span class="comment">// do nothing</span>
<a name="l00741"></a>00741                         }
<a name="l00742"></a>00742                         
<a name="l00743"></a>00743                         setTimeout(function () {
<a name="l00744"></a>00744                               $.event.trigger(event_closed);
<a name="l00745"></a>00745                               <span class="keywordflow">if</span> (settings.onClosed) {
<a name="l00746"></a>00746                                     settings.onClosed.call(element);
<a name="l00747"></a>00747                               }
<a name="l00748"></a>00748                         }, 1);
<a name="l00749"></a>00749                   });
<a name="l00750"></a>00750             }
<a name="l00751"></a>00751       };
<a name="l00752"></a>00752 
<a name="l00753"></a>00753       <span class="comment">// A method for fetching the current element ColorBox is referencing.</span>
<a name="l00754"></a>00754       <span class="comment">// returns a jQuery object.</span>
<a name="l00755"></a>00755       publicMethod.element = function () {
<a name="l00756"></a>00756             <span class="keywordflow">return</span> $(element);
<a name="l00757"></a>00757       };
<a name="l00758"></a>00758 
<a name="l00759"></a>00759       publicMethod.settings = defaults;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761       <span class="comment">// Initializes ColorBox when the DOM has loaded</span>
<a name="l00762"></a>00762       $(publicMethod.init);
<a name="l00763"></a>00763 
<a name="l00764"></a>00764 }(<a class="code" href="jquery-1_84_82_8min_8js.html#a08ed7883a43db897232a2b0104ce2c17">jQuery</a>, <span class="keyword">this</span>));
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Oct 5 2010 21:16:40 for ultimix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
