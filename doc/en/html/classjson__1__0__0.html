<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ultimix: json_1_0_0 Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="classes.html"><span>Class&nbsp;Index</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<h1>json_1_0_0 Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="json_1_0_0" -->
<p><a href="classjson__1__0__0-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#ad3eddaf4bad655b1005b6c2e449eeb6f">json_1_0_0</a> ($use=0)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#aa7b1b36cd3a4995bbb60f5def6a216e2">utf162utf8</a> ($utf16)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#af9687bbf6bcddc9c847d608f9a1fa4c0">utf82utf16</a> ($utf8)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#acdf1c85111e34b3048d436228bf39819">encode</a> ($var)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#aa7f3e18209717e584f01f53a0325e9ff">name_value</a> ($name, $value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#ae463a3baa44e95fa5b5151ab2334df1c">reduce_string</a> ($str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode</a> ($str)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">isError</a> ($data, $code=null)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Converts to and from JSON format.</p>
<p>Brief example of use:</p>
<p><code> // create a new instance of <a class="el" href="classjson__1__0__0.html">json_1_0_0</a> $json = new <a class="el" href="classjson__1__0__0.html#ad3eddaf4bad655b1005b6c2e449eeb6f">json_1_0_0()</a>;</code></p>
<p><code> // convert a complexe value to JSON notation, and send it to the browser $value = array('foo', 'bar', array(1, 2, 'baz'), array(3, array(4))); $output = $json-&gt;encode($value);</code></p>
<p><code> print($output); // prints: ["foo","bar",[1,2,"baz"],[3,[4]]]</code></p>
<p><code> // accept incoming POST data, assumed to be in JSON notation $input = file_get_contents('php://input', 1000000); $value = $json-&gt;decode($input); </code> </p>

<p>Definition at line <a class="el" href="json_8php_source.html#l00111">111</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a4afbb486f4a5ff5a8170c832f5997986"></a><!-- doxytag: member="json_1_0_0::decode" ref="a4afbb486f4a5ff5a8170c832f5997986" args="($str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">decode </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>str</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>decodes a JSON string into appropriate variable</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$str</em>&nbsp;</td><td>JSON-formatted string</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>number, boolean, string, array, or object corresponding to given JSON input string. See argument 1 to <a class="el" href="classjson__1__0__0.html#ad3eddaf4bad655b1005b6c2e449eeb6f">json_1_0_0()</a> above for object-output behavior. Note that <a class="el" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode()</a> always returns strings in ASCII or UTF-8 format! </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00478">478</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
                  <span class="keywordflow">if</span>( version_compare( PHP_VERSION , <span class="stringliteral">&#39;5.2.0&#39;</span> ) &gt;= 0 )
                  {
                        <span class="keywordflow">return</span>( json_decode( $var ) );
                  }
              $str = $this-&gt;<a class="code" href="classjson__1__0__0.html#ae463a3baa44e95fa5b5151ab2334df1c">reduce_string</a>($str);

              <span class="keywordflow">switch</span> (strtolower($str)) {
                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;true&#39;</span>:
                      <span class="keywordflow">return</span> <span class="keyword">true</span>;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;false&#39;</span>:
                      <span class="keywordflow">return</span> <span class="keyword">false</span>;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;null&#39;</span>:
                      <span class="keywordflow">return</span> null;

                  <span class="keywordflow">default</span>:
                      $m = array();

                      <span class="keywordflow">if</span> (is_numeric($str)) {
                          <span class="comment">// This would work on its own, but I&#39;m trying to be</span>
                          <span class="comment">// good about returning integers where appropriate:</span>
                          <span class="comment">// return (float)$str;</span>

                          <span class="comment">// Return float or int, as appropriate</span>
                          <span class="keywordflow">return</span> ((<span class="keywordtype">float</span>)$str == (integer)$str)
                              ? (integer)$str
                              : (<span class="keywordtype">float</span>)$str;

                      } elseif (preg_match(<span class="stringliteral">&#39;/^(&quot;|\&#39;).*(\1)$/s&#39;</span>, $str, $m) &amp;&amp; $m[1] == $m[2]) {
                          <span class="comment">// STRINGS RETURNED IN UTF-8 FORMAT</span>
                          $delim = substr($str, 0, 1);
                          $chrs = substr($str, 1, -1);
                          $utf8 = <span class="stringliteral">&#39;&#39;</span>;
                          $strlen_chrs = strlen($chrs);

                          <span class="keywordflow">for</span> ($c = 0; $c &lt; $strlen_chrs; ++$c) {

                              $substr_chrs_c_2 = substr($chrs, $c, 2);
                              $ord_chrs_c = ord($chrs{$c});

                              <span class="keywordflow">switch</span> (<span class="keyword">true</span>) {
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="charliteral">&#39;\b&#39;</span>:
                                      $utf8 .= chr(0x08);
                                      ++$c;
                                      <span class="keywordflow">break</span>;
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="charliteral">&#39;\t&#39;</span>:
                                      $utf8 .= chr(0x09);
                                      ++$c;
                                      <span class="keywordflow">break</span>;
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="charliteral">&#39;\n&#39;</span>:
                                      $utf8 .= chr(0x0A);
                                      ++$c;
                                      <span class="keywordflow">break</span>;
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="charliteral">&#39;\f&#39;</span>:
                                      $utf8 .= chr(0x0C);
                                      ++$c;
                                      <span class="keywordflow">break</span>;
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="charliteral">&#39;\r&#39;</span>:
                                      $utf8 .= chr(0x0D);
                                      ++$c;
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="stringliteral">&#39;\\&quot;&#39;</span>:
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="stringliteral">&#39;\\\&#39;&#39;</span>:
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="stringliteral">&#39;\\\\&#39;</span>:
                                  <span class="keywordflow">case</span> $substr_chrs_c_2 == <span class="stringliteral">&#39;\\/&#39;</span>:
                                      <span class="keywordflow">if</span> (($delim == <span class="charliteral">&#39;&quot;&#39;</span> &amp;&amp; $substr_chrs_c_2 != <span class="stringliteral">&#39;\\\&#39;&#39;</span>) ||
                                         ($delim == <span class="stringliteral">&quot;&#39;&quot;</span> &amp;&amp; $substr_chrs_c_2 != <span class="stringliteral">&#39;\\&quot;&#39;</span>)) {
                                          $utf8 .= $chrs{++$c};
                                      }
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> preg_match(<span class="stringliteral">&#39;/\\\u[0-9A-F]{4}/i&#39;</span>, substr($chrs, $c, 6)):
                                      <span class="comment">// single, escaped unicode character</span>
                                      $utf16 = chr(hexdec(substr($chrs, ($c + 2), 2)))
                                             . chr(hexdec(substr($chrs, ($c + 4), 2)));
                                      $utf8 .= $this-&gt;<a class="code" href="classjson__1__0__0.html#aa7b1b36cd3a4995bbb60f5def6a216e2">utf162utf8</a>($utf16);
                                      $c += 5;
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> ($ord_chrs_c &gt;= 0x20) &amp;&amp; ($ord_chrs_c &lt;= 0x7F):
                                      $utf8 .= $chrs{$c};
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> ($ord_chrs_c &amp; 0xE0) == 0xC0:
                                      <span class="comment">// characters U-00000080 - U-000007FF, mask 110XXXXX</span>
                                      <span class="comment">//see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                      $utf8 .= substr($chrs, $c, 2);
                                      ++$c;
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> ($ord_chrs_c &amp; 0xF0) == 0xE0:
                                      <span class="comment">// characters U-00000800 - U-0000FFFF, mask 1110XXXX</span>
                                      <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                      $utf8 .= substr($chrs, $c, 3);
                                      $c += 2;
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> ($ord_chrs_c &amp; 0xF8) == 0xF0:
                                      <span class="comment">// characters U-00010000 - U-001FFFFF, mask 11110XXX</span>
                                      <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                      $utf8 .= substr($chrs, $c, 4);
                                      $c += 3;
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> ($ord_chrs_c &amp; 0xFC) == 0xF8:
                                      <span class="comment">// characters U-00200000 - U-03FFFFFF, mask 111110XX</span>
                                      <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                      $utf8 .= substr($chrs, $c, 5);
                                      $c += 4;
                                      <span class="keywordflow">break</span>;

                                  <span class="keywordflow">case</span> ($ord_chrs_c &amp; 0xFE) == 0xFC:
                                      <span class="comment">// characters U-04000000 - U-7FFFFFFF, mask 1111110X</span>
                                      <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                      $utf8 .= substr($chrs, $c, 6);
                                      $c += 5;
                                      <span class="keywordflow">break</span>;

                              }

                          }

                          <span class="keywordflow">return</span> $utf8;

                      } elseif (preg_match(<span class="stringliteral">&#39;/^\[.*\]$/s&#39;</span>, $str) || preg_match(<span class="stringliteral">&#39;/^\{.*\}$/s&#39;</span>, $str)) {
                          <span class="comment">// array, or object notation</span>

                          <span class="keywordflow">if</span> ($str{0} == <span class="charliteral">&#39;[&#39;</span>) {
                              $stk = array(<a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>);
                              $arr = array();
                          } <span class="keywordflow">else</span> {
                              <span class="keywordflow">if</span> ($this-&gt;use &amp; <a class="code" href="json_8php.html#ad49c407e245b546ea6e0223d6e058519">SERVICES_JSON_LOOSE_TYPE</a>) {
                                  $stk = array(<a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>);
                                  $obj = array();
                              } <span class="keywordflow">else</span> {
                                  $stk = array(<a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>);
                                  $obj = <span class="keyword">new</span> stdClass();
                              }
                          }

                          array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span>  =&gt; <a class="code" href="json_8php.html#a131a40ade965cdcfcb0cb1a4df4c0e65">SERVICES_JSON_SLICE</a>,
                                                 <span class="stringliteral">&#39;where&#39;</span> =&gt; 0,
                                                 <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));

                          $chrs = substr($str, 1, -1);
                          $chrs = $this-&gt;<a class="code" href="classjson__1__0__0.html#ae463a3baa44e95fa5b5151ab2334df1c">reduce_string</a>($chrs);

                          <span class="keywordflow">if</span> ($chrs == <span class="stringliteral">&#39;&#39;</span>) {
                              <span class="keywordflow">if</span> (reset($stk) == <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>) {
                                  <span class="keywordflow">return</span> $arr;

                              } <span class="keywordflow">else</span> {
                                  <span class="keywordflow">return</span> $obj;

                              }
                          }

                          $strlen_chrs = strlen($chrs);

                          <span class="keywordflow">for</span> ($c = 0; $c &lt;= $strlen_chrs; ++$c) {

                              $top = end($stk);
                              $substr_chrs_c_2 = substr($chrs, $c, 2);

                              <span class="keywordflow">if</span> (($c == $strlen_chrs) || (($chrs{$c} == <span class="charliteral">&#39;,&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == <a class="code" href="json_8php.html#a131a40ade965cdcfcb0cb1a4df4c0e65">SERVICES_JSON_SLICE</a>))) {
                                  <span class="comment">// found a comma that is not inside a string, array, etc.,</span>
                                  <span class="comment">// OR we&#39;ve reached the end of the character list</span>
                                  $slice = substr($chrs, $top[<span class="stringliteral">&#39;where&#39;</span>], ($c - $top[<span class="stringliteral">&#39;where&#39;</span>]));
                                  array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; <a class="code" href="json_8php.html#a131a40ade965cdcfcb0cb1a4df4c0e65">SERVICES_JSON_SLICE</a>, <span class="stringliteral">&#39;where&#39;</span> =&gt; ($c + 1), <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));

                                  <span class="keywordflow">if</span> (reset($stk) == <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>) {
                                      <span class="comment">// we are in an array, so just push an element onto the stack</span>
                                      array_push($arr, $this-&gt;<a class="code" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode</a>($slice));

                                  } elseif (reset($stk) == <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>) {
                                      <span class="comment">// we are in an object, so figure</span>
                                      <span class="comment">// out the property name and set an</span>
                                      <span class="comment">// element in an associative array,</span>
                                      <span class="comment">// for now</span>
                                      $parts = array();
                                      
                                      <span class="keywordflow">if</span> (preg_match(<span class="stringliteral">&#39;/^\s*([&quot;\&#39;].*[^\\\][&quot;\&#39;])\s*:\s*(\S.*),?$/Uis&#39;</span>, $slice, $parts)) {
                                          <span class="comment">// &quot;name&quot;:value pair</span>
                                          $key = $this-&gt;<a class="code" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode</a>($parts[1]);
                                          $val = $this-&gt;<a class="code" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode</a>($parts[2]);

                                          <span class="keywordflow">if</span> ($this-&gt;use &amp; <a class="code" href="json_8php.html#ad49c407e245b546ea6e0223d6e058519">SERVICES_JSON_LOOSE_TYPE</a>) {
                                              $obj[$key] = $val;
                                          } <span class="keywordflow">else</span> {
                                              $obj-&gt;$key = $val;
                                          }
                                      } elseif (preg_match(<span class="stringliteral">&#39;/^\s*(\w+)\s*:\s*(\S.*),?$/Uis&#39;</span>, $slice, $parts)) {
                                          <span class="comment">// name:value pair, where name is unquoted</span>
                                          $key = $parts[1];
                                          $val = $this-&gt;<a class="code" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode</a>($parts[2]);

                                          <span class="keywordflow">if</span> ($this-&gt;use &amp; <a class="code" href="json_8php.html#ad49c407e245b546ea6e0223d6e058519">SERVICES_JSON_LOOSE_TYPE</a>) {
                                              $obj[$key] = $val;
                                          } <span class="keywordflow">else</span> {
                                              $obj-&gt;$key = $val;
                                          }
                                      }

                                  }

                              } elseif ((($chrs{$c} == <span class="charliteral">&#39;&quot;&#39;</span>) || ($chrs{$c} == <span class="stringliteral">&quot;&#39;&quot;</span>)) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] != <a class="code" href="json_8php.html#a4b7b3253265f40348456401b323f0ee0">SERVICES_JSON_IN_STR</a>)) {
                                  <span class="comment">// found a quote, and we are not inside a string</span>
                                  array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; <a class="code" href="json_8php.html#a4b7b3253265f40348456401b323f0ee0">SERVICES_JSON_IN_STR</a>, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; $chrs{$c}));
                              } elseif (($chrs{$c} == $top[<span class="stringliteral">&#39;delim&#39;</span>]) &amp;&amp;
                                       ($top[<span class="stringliteral">&#39;what&#39;</span>] == <a class="code" href="json_8php.html#a4b7b3253265f40348456401b323f0ee0">SERVICES_JSON_IN_STR</a>) &amp;&amp;
                                       ((strlen(substr($chrs, 0, $c)) - strlen(rtrim(substr($chrs, 0, $c), <span class="charliteral">&#39;\\&#39;</span>))) % 2 != 1)) {
                                  <span class="comment">// found a quote, we&#39;re in a string, and it&#39;s not escaped</span>
                                  <span class="comment">// we know that it&#39;s not escaped becase there is _not_ an</span>
                                  <span class="comment">// odd number of backslashes at the end of the string so far</span>
                                  array_pop($stk);
                              } elseif (($chrs{$c} == <span class="charliteral">&#39;[&#39;</span>) &amp;&amp;
                                       in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(<a class="code" href="json_8php.html#a131a40ade965cdcfcb0cb1a4df4c0e65">SERVICES_JSON_SLICE</a>, <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>, <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>))) {
                                  <span class="comment">// found a left-bracket, and we are in an array, object, or slice</span>
                                  array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
                              } elseif (($chrs{$c} == <span class="charliteral">&#39;]&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>)) {
                                  <span class="comment">// found a right-bracket, and we&#39;re in an array</span>
                                  array_pop($stk);
                              } elseif (($chrs{$c} == <span class="charliteral">&#39;{&#39;</span>) &amp;&amp;
                                       in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(<a class="code" href="json_8php.html#a131a40ade965cdcfcb0cb1a4df4c0e65">SERVICES_JSON_SLICE</a>, <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>, <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>))) {
                                  <span class="comment">// found a left-brace, and we are in an array, object, or slice</span>
                                  array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
                              } elseif (($chrs{$c} == <span class="charliteral">&#39;}&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>)) {
                                  <span class="comment">// found a right-brace, and we&#39;re in an object</span>
                                  array_pop($stk);
                              } elseif (($substr_chrs_c_2 == <span class="stringliteral">&#39;/*&#39;</span>) &amp;&amp;
                                       in_array($top[<span class="stringliteral">&#39;what&#39;</span>], array(<a class="code" href="json_8php.html#a131a40ade965cdcfcb0cb1a4df4c0e65">SERVICES_JSON_SLICE</a>, <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>, <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>))) {
                                  <span class="comment">// found a comment start, and we are in an array, object, or slice</span>
                                  array_push($stk, array(<span class="stringliteral">&#39;what&#39;</span> =&gt; <a class="code" href="json_8php.html#aa92ee6f67987534ea593e755a248929d">SERVICES_JSON_IN_CMT</a>, <span class="stringliteral">&#39;where&#39;</span> =&gt; $c, <span class="stringliteral">&#39;delim&#39;</span> =&gt; <span class="keyword">false</span>));
                                  $c++;
                              } elseif (($substr_chrs_c_2 == <span class="stringliteral">&#39;*/&#39;</span>) &amp;&amp; ($top[<span class="stringliteral">&#39;what&#39;</span>] == <a class="code" href="json_8php.html#aa92ee6f67987534ea593e755a248929d">SERVICES_JSON_IN_CMT</a>)) {
                                  <span class="comment">// found a comment end, and we&#39;re in one now</span>
                                  array_pop($stk);
                                  $c++;

                                  <span class="keywordflow">for</span> ($i = $top[<span class="stringliteral">&#39;where&#39;</span>]; $i &lt;= $c; ++$i)
                                      $chrs = substr_replace($chrs, <span class="charliteral">&#39; &#39;</span>, $i, 1);
                              }

                          }

                          <span class="keywordflow">if</span> (reset($stk) == <a class="code" href="json_8php.html#aa05d94043a2e3adb48a1633dd87bc80c">SERVICES_JSON_IN_ARR</a>) {
                              <span class="keywordflow">return</span> $arr;

                          } elseif (reset($stk) == <a class="code" href="json_8php.html#ad4e57f592e491c1a0b1701ee09f231b4">SERVICES_JSON_IN_OBJ</a>) {
                              <span class="keywordflow">return</span> $obj;

                          }

                      }
              }
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="acdf1c85111e34b3048d436228bf39819"></a><!-- doxytag: member="json_1_0_0::encode" ref="acdf1c85111e34b3048d436228bf39819" args="($var)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">encode </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>var</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>encodes an arbitrary variable into JSON format</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$var</em>&nbsp;</td><td>any number, boolean, string, array, or object to be encoded. see argument 1 to <a class="el" href="classjson__1__0__0.html#ad3eddaf4bad655b1005b6c2e449eeb6f">json_1_0_0()</a> above for array-parsing behavior. if var is a strng, note that <a class="el" href="classjson__1__0__0.html#acdf1c85111e34b3048d436228bf39819">encode()</a> always expects it to be in ASCII or UTF-8 format!</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>JSON string representation of input var or an error if a problem occurs </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00230">230</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
                  <span class="keywordflow">if</span>( version_compare( PHP_VERSION , <span class="stringliteral">&#39;5.2.0&#39;</span> ) &gt;= 0 )
                  {
                        <span class="keywordflow">return</span>( json_encode( $var ) );
                  }
              <span class="keywordflow">switch</span> (gettype($var)) {
                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;boolean&#39;</span>:
                      <span class="keywordflow">return</span> $var ? <span class="stringliteral">&#39;true&#39;</span> : <span class="stringliteral">&#39;false&#39;</span>;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;NULL&#39;</span>:
                      <span class="keywordflow">return</span> <span class="stringliteral">&#39;null&#39;</span>;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;integer&#39;</span>:
                      <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) $var;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;double&#39;</span>:
                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;float&#39;</span>:
                      <span class="keywordflow">return</span> (<span class="keywordtype">float</span>) $var;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;string&#39;</span>:
                      <span class="comment">// STRINGS ARE EXPECTED TO BE IN ASCII OR UTF-8 FORMAT</span>
                      $ascii = <span class="stringliteral">&#39;&#39;</span>;
                      $strlen_var = strlen($var);

                     <span class="comment">/*</span>
<span class="comment">                      * Iterate over every character in the string,</span>
<span class="comment">                      * escaping with a slash or encoding to UTF-8 where necessary</span>
<span class="comment">                      */</span>
                      <span class="keywordflow">for</span> ($c = 0; $c &lt; $strlen_var; ++$c) {

                          $ord_var_c = ord($var{$c});

                          <span class="keywordflow">switch</span> (<span class="keyword">true</span>) {
                              <span class="keywordflow">case</span> $ord_var_c == 0x08:
                                  $ascii .= <span class="charliteral">&#39;\b&#39;</span>;
                                  <span class="keywordflow">break</span>;
                              <span class="keywordflow">case</span> $ord_var_c == 0x09:
                                  $ascii .= <span class="charliteral">&#39;\t&#39;</span>;
                                  <span class="keywordflow">break</span>;
                              <span class="keywordflow">case</span> $ord_var_c == 0x0A:
                                  $ascii .= <span class="charliteral">&#39;\n&#39;</span>;
                                  <span class="keywordflow">break</span>;
                              <span class="keywordflow">case</span> $ord_var_c == 0x0C:
                                  $ascii .= <span class="charliteral">&#39;\f&#39;</span>;
                                  <span class="keywordflow">break</span>;
                              <span class="keywordflow">case</span> $ord_var_c == 0x0D:
                                  $ascii .= <span class="charliteral">&#39;\r&#39;</span>;
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> $ord_var_c == 0x22:
                              <span class="keywordflow">case</span> $ord_var_c == 0x2F:
                              <span class="keywordflow">case</span> $ord_var_c == 0x5C:
                                  <span class="comment">// double quote, slash, slosh</span>
                                  $ascii .= <span class="charliteral">&#39;\\&#39;</span>.$var{$c};
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> (($ord_var_c &gt;= 0x20) &amp;&amp; ($ord_var_c &lt;= 0x7F)):
                                  <span class="comment">// characters U-00000000 - U-0000007F (same as ASCII)</span>
                                  $ascii .= $var{$c};
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> (($ord_var_c &amp; 0xE0) == 0xC0):
                                  <span class="comment">// characters U-00000080 - U-000007FF, mask 110XXXXX</span>
                                  <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                  $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c, ord($var{$c + 1}));
                                  $c += 1;
                                  $utf16 = $this-&gt;<a class="code" href="classjson__1__0__0.html#af9687bbf6bcddc9c847d608f9a1fa4c0">utf82utf16</a>($char);
                                  $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> (($ord_var_c &amp; 0xF0) == 0xE0):
                                  <span class="comment">// characters U-00000800 - U-0000FFFF, mask 1110XXXX</span>
                                  <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                  $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
                                               ord($var{$c + 1}),
                                               ord($var{$c + 2}));
                                  $c += 2;
                                  $utf16 = $this-&gt;<a class="code" href="classjson__1__0__0.html#af9687bbf6bcddc9c847d608f9a1fa4c0">utf82utf16</a>($char);
                                  $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> (($ord_var_c &amp; 0xF8) == 0xF0):
                                  <span class="comment">// characters U-00010000 - U-001FFFFF, mask 11110XXX</span>
                                  <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                  $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
                                               ord($var{$c + 1}),
                                               ord($var{$c + 2}),
                                               ord($var{$c + 3}));
                                  $c += 3;
                                  $utf16 = $this-&gt;<a class="code" href="classjson__1__0__0.html#af9687bbf6bcddc9c847d608f9a1fa4c0">utf82utf16</a>($char);
                                  $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> (($ord_var_c &amp; 0xFC) == 0xF8):
                                  <span class="comment">// characters U-00200000 - U-03FFFFFF, mask 111110XX</span>
                                  <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                  $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
                                               ord($var{$c + 1}),
                                               ord($var{$c + 2}),
                                               ord($var{$c + 3}),
                                               ord($var{$c + 4}));
                                  $c += 4;
                                  $utf16 = $this-&gt;<a class="code" href="classjson__1__0__0.html#af9687bbf6bcddc9c847d608f9a1fa4c0">utf82utf16</a>($char);
                                  $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
                                  <span class="keywordflow">break</span>;

                              <span class="keywordflow">case</span> (($ord_var_c &amp; 0xFE) == 0xFC):
                                  <span class="comment">// characters U-04000000 - U-7FFFFFFF, mask 1111110X</span>
                                  <span class="comment">// see http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                                  $char = pack(<span class="stringliteral">&#39;C*&#39;</span>, $ord_var_c,
                                               ord($var{$c + 1}),
                                               ord($var{$c + 2}),
                                               ord($var{$c + 3}),
                                               ord($var{$c + 4}),
                                               ord($var{$c + 5}));
                                  $c += 5;
                                  $utf16 = $this-&gt;<a class="code" href="classjson__1__0__0.html#af9687bbf6bcddc9c847d608f9a1fa4c0">utf82utf16</a>($char);
                                  $ascii .= sprintf(<span class="stringliteral">&#39;\u%04s&#39;</span>, bin2hex($utf16));
                                  <span class="keywordflow">break</span>;
                          }
                      }

                      <span class="keywordflow">return</span> <span class="charliteral">&#39;&quot;&#39;</span>.$ascii.<span class="charliteral">&#39;&quot;&#39;</span>;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;array&#39;</span>:
                     <span class="comment">/*</span>
<span class="comment">                      * As per JSON spec if any array key is not an integer</span>
<span class="comment">                      * we must treat the the whole array as an object. We</span>
<span class="comment">                      * also try to catch a sparsely populated associative</span>
<span class="comment">                      * array with numeric keys here because some JS engines</span>
<span class="comment">                      * will create an array with empty indexes up to</span>
<span class="comment">                      * max_index which can cause memory issues and because</span>
<span class="comment">                      * the keys, which may be relevant, will be remapped</span>
<span class="comment">                      * otherwise.</span>
<span class="comment">                      *</span>
<span class="comment">                      * As per the ECMA and JSON specification an object may</span>
<span class="comment">                      * have any string as a property. Unfortunately due to</span>
<span class="comment">                      * a hole in the ECMA specification if the key is a</span>
<span class="comment">                      * ECMA reserved word or starts with a digit the</span>
<span class="comment">                      * parameter is only accessible using ECMAScript&#39;s</span>
<span class="comment">                      * bracket notation.</span>
<span class="comment">                      */</span>

                      <span class="comment">// treat as a JSON object</span>
                      <span class="keywordflow">if</span> (is_array($var) &amp;&amp; count($var) &amp;&amp; (array_keys($var) !== range(0, <span class="keyword">sizeof</span>($var) - 1))) {
                          $properties = array_map(array($this, <span class="stringliteral">&#39;name_value&#39;</span>),
                                                  array_keys($var),
                                                  array_values($var));

                          <span class="keywordflow">foreach</span>($properties as $property) {
                              <span class="keywordflow">if</span>(<a class="code" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">json_1_0_0::isError</a>($property)) {
                                  <span class="keywordflow">return</span> $property;
                              }
                          }

                          <span class="keywordflow">return</span> <span class="charliteral">&#39;{&#39;</span> . join(<span class="charliteral">&#39;,&#39;</span>, $properties) . <span class="charliteral">&#39;}&#39;</span>;
                      }

                      <span class="comment">// treat it like a regular array</span>
                      $elements = array_map(array($this, <span class="stringliteral">&#39;encode&#39;</span>), $var);

                      <span class="keywordflow">foreach</span>($elements as $element) {
                          <span class="keywordflow">if</span>(<a class="code" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">json_1_0_0::isError</a>($element)) {
                              <span class="keywordflow">return</span> $element;
                          }
                      }

                      <span class="keywordflow">return</span> <span class="charliteral">&#39;[&#39;</span> . join(<span class="charliteral">&#39;,&#39;</span>, $elements) . <span class="charliteral">&#39;]&#39;</span>;

                  <span class="keywordflow">case</span> <span class="stringliteral">&#39;object&#39;</span>:
                      $vars = get_object_vars($var);

                      $properties = array_map(array($this, <span class="stringliteral">&#39;name_value&#39;</span>),
                                              array_keys($vars),
                                              array_values($vars));

                      <span class="keywordflow">foreach</span>($properties as $property) {
                          <span class="keywordflow">if</span>(<a class="code" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">json_1_0_0::isError</a>($property)) {
                              <span class="keywordflow">return</span> $property;
                          }
                      }

                      <span class="keywordflow">return</span> <span class="charliteral">&#39;{&#39;</span> . join(<span class="charliteral">&#39;,&#39;</span>, $properties) . <span class="charliteral">&#39;}&#39;</span>;

                  <span class="keywordflow">default</span>:
                      <span class="keywordflow">return</span> ($this-&gt;use &amp; <a class="code" href="json_8php.html#a32f0ead758c174c2e5606a073d2ddb57">SERVICES_JSON_SUPPRESS_ERRORS</a>)
                          ? <span class="stringliteral">&#39;null&#39;</span>
                          : <span class="keyword">new</span> Services_JSON_Error(gettype($var).<span class="stringliteral">&quot; can not be encoded as JSON string&quot;</span>);
              }
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a55ae0955466c3970507b122f3f5d1b38"></a><!-- doxytag: member="json_1_0_0::isError" ref="a55ae0955466c3970507b122f3f5d1b38" args="($data, $code=null)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">isError </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>code</em> = <code>null</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>Ultimately, this should just call PEAR::isError() </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00742">742</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
              <span class="keywordflow">if</span> (class_exists(<span class="stringliteral">&#39;pear&#39;</span>)) {
                  <span class="keywordflow">return</span> <a class="code" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">PEAR::isError</a>($data, $code);
              } elseif (is_object($data) &amp;&amp; (get_class($data) == <span class="stringliteral">&#39;services_json_error&#39;</span> ||
                                       is_subclass_of($data, <span class="stringliteral">&#39;services_json_error&#39;</span>))) {
                  <span class="keywordflow">return</span> <span class="keyword">true</span>;
              }

              <span class="keywordflow">return</span> <span class="keyword">false</span>;
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ad3eddaf4bad655b1005b6c2e449eeb6f"></a><!-- doxytag: member="json_1_0_0::json_1_0_0" ref="ad3eddaf4bad655b1005b6c2e449eeb6f" args="($use=0)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classjson__1__0__0.html">json_1_0_0</a> </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>use</em> = <code>0</code></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>constructs a new JSON instance</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$use</em>&nbsp;</td><td>object behavior flags; combine with boolean-OR</td></tr>
  </table>
  </dd>
</dl>
<p>possible values:</p>
<ul>
<li>SERVICES_JSON_LOOSE_TYPE: loose typing. "{...}" syntax creates associative arrays instead of objects in <a class="el" href="classjson__1__0__0.html#a4afbb486f4a5ff5a8170c832f5997986">decode()</a>.</li>
<li>SERVICES_JSON_SUPPRESS_ERRORS: error suppression. Values which can't be encoded (e.g. resources) appear as NULL instead of throwing errors. By default, a deeply-nested resource will bubble up with an error, so all return values from <a class="el" href="classjson__1__0__0.html#acdf1c85111e34b3048d436228bf39819">encode()</a> should be checked with <a class="el" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">isError()</a> </li>
</ul>

<p>Definition at line <a class="el" href="json_8php_source.html#l00129">129</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
              $this-&gt;use = $use;
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa7f3e18209717e584f01f53a0325e9ff"></a><!-- doxytag: member="json_1_0_0::name_value" ref="aa7f3e18209717e584f01f53a0325e9ff" args="($name, $value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">name_value </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>array-walking function for use in generating JSON-formatted name-value pairs</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$name</em>&nbsp;</td><td>name of key to use </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$value</em>&nbsp;</td><td>reference to an array element to be encoded</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>JSON-formatted name-value pair, like '"name":value' </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00430">430</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
              $encoded_value = $this-&gt;<a class="code" href="classjson__1__0__0.html#acdf1c85111e34b3048d436228bf39819">encode</a>($value);

              <span class="keywordflow">if</span>(<a class="code" href="classjson__1__0__0.html#a55ae0955466c3970507b122f3f5d1b38">json_1_0_0::isError</a>($encoded_value)) {
                  <span class="keywordflow">return</span> $encoded_value;
              }

              <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classjson__1__0__0.html#acdf1c85111e34b3048d436228bf39819">encode</a>(strval($name)) . <span class="charliteral">&#39;:&#39;</span> . $encoded_value;
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ae463a3baa44e95fa5b5151ab2334df1c"></a><!-- doxytag: member="json_1_0_0::reduce_string" ref="ae463a3baa44e95fa5b5151ab2334df1c" args="($str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">reduce_string </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>str</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>reduce a string by removing leading and trailing comments and whitespace</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$str</em>&nbsp;</td><td>string value to strip of comments and whitespace</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>string value stripped of comments and whitespace </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00448">448</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
              $str = preg_replace(array(

                      <span class="comment">// eliminate single line comments in &#39;// ...&#39; form</span>
                      <span class="stringliteral">&#39;#^\s*//(.+)$#m&#39;</span>,

                      <span class="comment">// eliminate multi-line comments in &#39;/* ... */&#39; form, at start of string</span>
                      <span class="stringliteral">&#39;#^\s*/\*(.+)\*/#Us&#39;</span>,

                      <span class="comment">// eliminate multi-line comments in &#39;/* ... */&#39; form, at end of string</span>
                      <span class="stringliteral">&#39;#/\*(.+)\*/\s*$#Us&#39;</span>

                  ), <span class="stringliteral">&#39;&#39;</span>, $str);

              <span class="comment">// eliminate extraneous space</span>
              <span class="keywordflow">return</span> trim($str);
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aa7b1b36cd3a4995bbb60f5def6a216e2"></a><!-- doxytag: member="json_1_0_0::utf162utf8" ref="aa7b1b36cd3a4995bbb60f5def6a216e2" args="($utf16)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">utf162utf8 </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>utf16</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>convert a string from one UTF-16 char to one UTF-8 char</p>
<p>Normally should be handled by mb_convert_encoding, but provides a slower PHP-only method for installations that lack the multibye string extension.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$utf16</em>&nbsp;</td><td>UTF-16 character </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>character </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00144">144</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
              <span class="comment">// oh please oh please oh please oh please oh please</span>
              <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&#39;mb_convert_encoding&#39;</span>)) {
                  <span class="keywordflow">return</span> mb_convert_encoding($utf16, <span class="stringliteral">&#39;UTF-8&#39;</span>, <span class="stringliteral">&#39;UTF-16&#39;</span>);
              }

              $bytes = (ord($utf16{0}) &lt;&lt; 8) | ord($utf16{1});

              <span class="keywordflow">switch</span>(<span class="keyword">true</span>) {
                  <span class="keywordflow">case</span> ((0x7F &amp; $bytes) == $bytes):
                      <span class="comment">// this case should never be reached, because we are in ASCII range</span>
                      <span class="comment">// see: http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                      <span class="keywordflow">return</span> chr(0x7F &amp; $bytes);

                  <span class="keywordflow">case</span> (0x07FF &amp; $bytes) == $bytes:
                      <span class="comment">// return a 2-byte UTF-8 character</span>
                      <span class="comment">// see: http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                      <span class="keywordflow">return</span> chr(0xC0 | (($bytes &gt;&gt; 6) &amp; 0x1F))
                           . chr(0x80 | ($bytes &amp; 0x3F));

                  <span class="keywordflow">case</span> (0xFFFF &amp; $bytes) == $bytes:
                      <span class="comment">// return a 3-byte UTF-8 character</span>
                      <span class="comment">// see: http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                      <span class="keywordflow">return</span> chr(0xE0 | (($bytes &gt;&gt; 12) &amp; 0x0F))
                           . chr(0x80 | (($bytes &gt;&gt; 6) &amp; 0x3F))
                           . chr(0x80 | ($bytes &amp; 0x3F));
              }

              <span class="comment">// ignoring UTF-32 for now, sorry</span>
              <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
          }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af9687bbf6bcddc9c847d608f9a1fa4c0"></a><!-- doxytag: member="json_1_0_0::utf82utf16" ref="af9687bbf6bcddc9c847d608f9a1fa4c0" args="($utf8)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">utf82utf16 </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>utf8</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>convert a string from one UTF-8 char to one UTF-16 char</p>
<p>Normally should be handled by mb_convert_encoding, but provides a slower PHP-only method for installations that lack the multibye string extension.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$utf8</em>&nbsp;</td><td>UTF-8 character </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>character </dd></dl>

<p>Definition at line <a class="el" href="json_8php_source.html#l00187">187</a> of file <a class="el" href="json_8php_source.html">json.php</a>.</p>

<p><div class="fragment"><pre class="fragment">          {
              <span class="comment">// oh please oh please oh please oh please oh please</span>
              <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&#39;mb_convert_encoding&#39;</span>)) {
                  <span class="keywordflow">return</span> mb_convert_encoding($utf8, <span class="stringliteral">&#39;UTF-16&#39;</span>, <span class="stringliteral">&#39;UTF-8&#39;</span>);
              }

              <span class="keywordflow">switch</span>(strlen($utf8)) {
                  <span class="keywordflow">case</span> 1:
                      <span class="comment">// this case should never be reached, because we are in ASCII range</span>
                      <span class="comment">// see: http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                      <span class="keywordflow">return</span> $utf8;

                  <span class="keywordflow">case</span> 2:
                      <span class="comment">// return a UTF-16 character from a 2-byte UTF-8 char</span>
                      <span class="comment">// see: http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                      <span class="keywordflow">return</span> chr(0x07 &amp; (ord($utf8{0}) &gt;&gt; 2))
                           . chr((0xC0 &amp; (ord($utf8{0}) &lt;&lt; 6))
                               | (0x3F &amp; ord($utf8{1})));

                  <span class="keywordflow">case</span> 3:
                      <span class="comment">// return a UTF-16 character from a 3-byte UTF-8 char</span>
                      <span class="comment">// see: http://www.cl.cam.ac.uk/~mgk25/unicode.html#utf-8</span>
                      <span class="keywordflow">return</span> chr((0xF0 &amp; (ord($utf8{0}) &lt;&lt; 4))
                               | (0x0F &amp; (ord($utf8{1}) &gt;&gt; 2)))
                           . chr((0xC0 &amp; (ord($utf8{1}) &lt;&lt; 6))
                               | (0x7F &amp; ord($utf8{2})));
              }

              <span class="comment">// ignoring UTF-32 for now, sorry</span>
              <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
          }
</pre></div></p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>G:/projects/webdev/wwwroot/ultimix/packages/json/<a class="el" href="json_8php_source.html">json.php</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Oct 3 2011 14:50:21 for ultimix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
