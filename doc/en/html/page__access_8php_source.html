<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ultimix: G:/projects/webdev/wwwroot/ultimix/packages/page/packages/page_access/page_access.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>G:/projects/webdev/wwwroot/ultimix/packages/page/packages/page_access/page_access.php</h1>  </div>
</div>
<div class="contents">
<a href="page__access_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003       <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment">      *     This source code is a part of the Ultimix Project. </span>
<a name="l00005"></a>00005 <span class="comment">      *     It is distributed under BSD license. All other third side source code (like tinyMCE) is distributed under </span>
<a name="l00006"></a>00006 <span class="comment">      *     it&#39;s own license wich could be found from the corresponding files or sources. </span>
<a name="l00007"></a>00007 <span class="comment">      *     This source code is provided &quot;as is&quot; without any warranties or garanties.</span>
<a name="l00008"></a>00008 <span class="comment">      *</span>
<a name="l00009"></a>00009 <span class="comment">      *     Have a nice day!</span>
<a name="l00010"></a>00010 <span class="comment">      *</span>
<a name="l00011"></a>00011 <span class="comment">      *     @url http://ultimix.sorceforge.net</span>
<a name="l00012"></a>00012 <span class="comment">      *</span>
<a name="l00013"></a>00013 <span class="comment">      *     @author Alexey &quot;gdever&quot; Dodonov</span>
<a name="l00014"></a>00014 <span class="comment">      */</span>
<a name="l00015"></a>00015 
<a name="l00026"></a><a class="code" href="classpage__access__1__0__0.html">00026</a>       <span class="keyword">class </span><a class="code" href="classpage__access__1__0__0.html">page_access_1_0_0</a>{
<a name="l00027"></a>00027       
<a name="l00038"></a><a class="code" href="classpage__access__1__0__0.html#aaae5f70ebc2b60f22e8159944cd2d518">00038</a>             var                           <a class="code" href="classpage__access__1__0__0.html#aaae5f70ebc2b60f22e8159944cd2d518">$Security</a> = <span class="keyword">false</span>;
<a name="l00039"></a>00039             
<a name="l00050"></a><a class="code" href="classpage__access__1__0__0.html#a095c5d389db211932136b53f25f39685">00050</a>             function                <a class="code" href="classpage__access__1__0__0.html#a095c5d389db211932136b53f25f39685">__construct</a>()
<a name="l00051"></a>00051             {
<a name="l00052"></a>00052                   <span class="keywordflow">try</span>
<a name="l00053"></a>00053                   {
<a name="l00054"></a>00054                         $this-&gt;Security = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;security&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00055"></a>00055                   }
<a name="l00056"></a>00056                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00057"></a>00057                   {
<a name="l00058"></a>00058                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00059"></a>00059                   }
<a name="l00060"></a>00060             }
<a name="l00061"></a>00061       
<a name="l00072"></a><a class="code" href="classpage__access__1__0__0.html#a13352aef27c96654b4751d67b2cacfe9">00072</a>             var                           <a class="code" href="classpage__access__1__0__0.html#a13352aef27c96654b4751d67b2cacfe9">$AddLimitations</a> = <span class="stringliteral">&#39;1 = 1&#39;</span>;
<a name="l00073"></a>00073             
<a name="l00092"></a><a class="code" href="classpage__access__1__0__0.html#a53b3ad2447b87fa67af6d3a67e1b4ef6">00092</a>             function                <a class="code" href="classpage__access__1__0__0.html#a53b3ad2447b87fa67af6d3a67e1b4ef6">set_add_limitations</a>( $theAddLimitation )
<a name="l00093"></a>00093             {
<a name="l00094"></a>00094                   <span class="keywordflow">try</span>
<a name="l00095"></a>00095                   {
<a name="l00096"></a>00096                         <span class="keywordflow">if</span>( $this-&gt;AddLimitations === <span class="stringliteral">&#39;1 = 1&#39;</span> )
<a name="l00097"></a>00097                         {
<a name="l00098"></a>00098                               $this-&gt;AddLimitations = $theAddLimitation;
<a name="l00099"></a>00099                         }
<a name="l00100"></a>00100                         <span class="keywordflow">else</span>
<a name="l00101"></a>00101                         {
<a name="l00102"></a>00102                               <span class="keywordflow">throw</span>( <span class="keyword">new</span> Exception( <span class="stringliteral">&#39;&quot;AddLimitations&quot; was already set&#39;</span> ) );
<a name="l00103"></a>00103                         }
<a name="l00104"></a>00104                   }
<a name="l00105"></a>00105                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00106"></a>00106                   {
<a name="l00107"></a>00107                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00108"></a>00108                   }
<a name="l00109"></a>00109             }
<a name="l00110"></a>00110       
<a name="l00133"></a><a class="code" href="classpage__access__1__0__0.html#a84fa4f5a1652feebd2b8ce497f780df6">00133</a>             function                <a class="code" href="classpage__access__1__0__0.html#a84fa4f5a1652feebd2b8ce497f780df6">get_raw_page</a>( $PageName )
<a name="l00134"></a>00134             {
<a name="l00135"></a>00135                   <span class="keywordflow">try</span>
<a name="l00136"></a>00136                   {
<a name="l00137"></a>00137                         $PageName = $this-&gt;Security-&gt;get( $PageName , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00138"></a>00138                         
<a name="l00139"></a>00139                         $CachedMultyFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00140"></a>00140                         $FileName = dirname( __FILE__ ).<span class="stringliteral">&#39;/data/pa_&#39;</span>.$PageName;
<a name="l00141"></a>00141                         <span class="keywordflow">if</span>( $CachedMultyFS-&gt;file_exists( $FileName ) )
<a name="l00142"></a>00142                         {
<a name="l00143"></a>00143                               $RawPage = $CachedMultyFS-&gt;file_get_contents( $FileName , <span class="stringliteral">&#39;cleaned&#39;</span> );
<a name="l00144"></a>00144                         }
<a name="l00145"></a>00145                         <span class="keywordflow">else</span>
<a name="l00146"></a>00146                         {
<a name="l00147"></a>00147                               $RawPage = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00148"></a>00148                         }
<a name="l00149"></a>00149                         
<a name="l00150"></a>00150                         <span class="keywordflow">return</span>( $RawPage );
<a name="l00151"></a>00151                   }
<a name="l00152"></a>00152                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00153"></a>00153                   {
<a name="l00154"></a>00154                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00155"></a>00155                   }
<a name="l00156"></a>00156             }
<a name="l00157"></a>00157       
<a name="l00181"></a><a class="code" href="classpage__access__1__0__0.html#a309927382b815726b5e56459e8cff1ee">00181</a>             function                <a class="code" href="classpage__access__1__0__0.html#a309927382b815726b5e56459e8cff1ee">parse_raw_page</a>( $RawPage )
<a name="l00182"></a>00182             {
<a name="l00183"></a>00183                   <span class="keywordflow">try</span>
<a name="l00184"></a>00184                   {
<a name="l00185"></a>00185                         $Appliance = array();
<a name="l00186"></a>00186                                     
<a name="l00187"></a>00187                         $RawPage = explode( <span class="stringliteral">&quot;\n&quot;</span> , $RawPage );
<a name="l00188"></a>00188                         $c = count( $RawPage );
<a name="l00189"></a>00189                         
<a name="l00190"></a>00190                         <span class="keywordflow">for</span>( $i = 0 ; $i &lt; $c ; $i++ )
<a name="l00191"></a>00191                         {
<a name="l00192"></a>00192                               $RawPageInfo = explode( <span class="charliteral">&#39;#&#39;</span> , $RawPage[ $i ] );
<a name="l00193"></a>00193                               $Appliance [] = array( 
<a name="l00194"></a>00194                                     <span class="stringliteral">&#39;package&#39;</span> =&gt; @$RawPageInfo[ 0 ] , <span class="stringliteral">&#39;package_version&#39;</span> =&gt; @$RawPageInfo[ 1 ] , 
<a name="l00195"></a>00195                                     <span class="stringliteral">&#39;options&#39;</span> =&gt; @$RawPageInfo[ 2 ] , <span class="stringliteral">&#39;placeholder&#39;</span> =&gt; @$RawPageInfo[ 3 ]
<a name="l00196"></a>00196                               );
<a name="l00197"></a>00197                         }
<a name="l00198"></a>00198                         
<a name="l00199"></a>00199                         <span class="keywordflow">return</span>( $Appliance );
<a name="l00200"></a>00200                   }
<a name="l00201"></a>00201                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00202"></a>00202                   {
<a name="l00203"></a>00203                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00204"></a>00204                   }
<a name="l00205"></a>00205             }
<a name="l00206"></a>00206       
<a name="l00234"></a><a class="code" href="classpage__access__1__0__0.html#a837323a6b09f624dcf8fd4530a2071ae">00234</a>             function                <a class="code" href="classpage__access__1__0__0.html#a837323a6b09f624dcf8fd4530a2071ae">get_package_appliance</a>( $PageName , $Parse = <span class="keyword">true</span> )
<a name="l00235"></a>00235             {
<a name="l00236"></a>00236                   <span class="keywordflow">try</span>
<a name="l00237"></a>00237                   {
<a name="l00238"></a>00238                         $RawPage = $this-&gt;<a class="code" href="classpage__access__1__0__0.html#a84fa4f5a1652feebd2b8ce497f780df6">get_raw_page</a>( $PageName );
<a name="l00239"></a>00239                         
<a name="l00240"></a>00240                         <span class="keywordflow">if</span>( $Parse == <span class="keyword">true</span> )
<a name="l00241"></a>00241                         {
<a name="l00242"></a>00242                               <span class="keywordflow">if</span>( strlen( $RawPage ) !== 0 )
<a name="l00243"></a>00243                               {
<a name="l00244"></a>00244                                     <span class="keywordflow">return</span>( $this-&gt;<a class="code" href="classpage__access__1__0__0.html#a309927382b815726b5e56459e8cff1ee">parse_raw_page</a>( $RawPage ) );
<a name="l00245"></a>00245                               }
<a name="l00246"></a>00246                               <span class="keywordflow">else</span>
<a name="l00247"></a>00247                               {
<a name="l00248"></a>00248                                     <span class="keywordflow">return</span>( array() );
<a name="l00249"></a>00249                               }
<a name="l00250"></a>00250                         }
<a name="l00251"></a>00251                         <span class="keywordflow">else</span>
<a name="l00252"></a>00252                         {
<a name="l00253"></a>00253                               <span class="keywordflow">return</span>( $RawPage );
<a name="l00254"></a>00254                         }
<a name="l00255"></a>00255                   }
<a name="l00256"></a>00256                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00257"></a>00257                   {
<a name="l00258"></a>00258                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00259"></a>00259                   }
<a name="l00260"></a>00260             }
<a name="l00261"></a>00261       
<a name="l00284"></a><a class="code" href="classpage__access__1__0__0.html#af6f77c404d7ad81cd297791249a920cc">00284</a>             function                <a class="code" href="classpage__access__1__0__0.html#af6f77c404d7ad81cd297791249a920cc">set_package_appliance</a>( $PageName , $Packages )
<a name="l00285"></a>00285             {
<a name="l00286"></a>00286                   <span class="keywordflow">try</span>
<a name="l00287"></a>00287                   {
<a name="l00288"></a>00288                         $PageName = $this-&gt;Security-&gt;get( $PageName , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00289"></a>00289                         $Packages = $this-&gt;Security-&gt;get( $Packages , <span class="stringliteral">&#39;unsafe_string&#39;</span> );
<a name="l00290"></a>00290                         
<a name="l00291"></a>00291                         $CachedMultyFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00292"></a>00292                         $CachedMultyFS-&gt;file_put_contents( dirname( __FILE__ ).<span class="stringliteral">&#39;/data/pa_&#39;</span>.$PageName , $Packages );
<a name="l00293"></a>00293                   }
<a name="l00294"></a>00294                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00295"></a>00295                   {
<a name="l00296"></a>00296                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00297"></a>00297                   }
<a name="l00298"></a>00298             }
<a name="l00299"></a>00299             
<a name="l00318"></a><a class="code" href="classpage__access__1__0__0.html#aab08cbde456d1bc21e97c47eac85fe6d">00318</a>             function                <a class="code" href="classpage__access__1__0__0.html#aab08cbde456d1bc21e97c47eac85fe6d">get_list_of_pages</a>()
<a name="l00319"></a>00319             {
<a name="l00320"></a>00320                   <span class="keywordflow">try</span>
<a name="l00321"></a>00321                   {
<a name="l00322"></a>00322                         $ListOfPages = array();
<a name="l00323"></a>00323                         $CachedMultyFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00324"></a>00324                         $MountedStorages = $CachedMultyFS-&gt;get_mounted_storages();
<a name="l00325"></a>00325                         $MountedStorages [] = dirname( __FILE__ ).<span class="stringliteral">&#39;/data&#39;</span>;
<a name="l00326"></a>00326                         <span class="keywordflow">foreach</span>( $MountedStorages as $ms )
<a name="l00327"></a>00327                         {
<a name="l00328"></a>00328                               <span class="keywordflow">if</span>( $Handle = @opendir( $ms ) )
<a name="l00329"></a>00329                               {
<a name="l00330"></a>00330                                     <span class="keywordflow">while</span>( <span class="keyword">false</span> !== ( $File = readdir( $Handle ) ) )
<a name="l00331"></a>00331                                     {
<a name="l00332"></a>00332                                           <span class="keywordflow">if</span>( is_file( dirname( __FILE__ ).<span class="stringliteral">&#39;/data/&#39;</span>.$File ) &amp;&amp; 
<a name="l00333"></a>00333                                                 strpos( $File , <span class="stringliteral">&#39;pa_&#39;</span> ) !== 0 &amp;&amp; 
<a name="l00334"></a>00334                                                 strpos( $File , <span class="stringliteral">&#39;index.html&#39;</span> ) !== 0 )
<a name="l00335"></a>00335                                           {
<a name="l00336"></a>00336                                                 $ListOfPages [] = $this-&gt;<a class="code" href="classpage__access__1__0__0.html#a7afcd2100d401a403e1166757d858741">get_page_description</a>( $File );
<a name="l00337"></a>00337                                           }
<a name="l00338"></a>00338                                     }
<a name="l00339"></a>00339                                     closedir( $Handle );
<a name="l00340"></a>00340                               }
<a name="l00341"></a>00341                         }
<a name="l00342"></a>00342                         <span class="keywordflow">return</span>( $ListOfPages );
<a name="l00343"></a>00343                   }
<a name="l00344"></a>00344                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00345"></a>00345                   {
<a name="l00346"></a>00346                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00347"></a>00347                   }
<a name="l00348"></a>00348             }
<a name="l00349"></a>00349             
<a name="l00384"></a><a class="code" href="classpage__access__1__0__0.html#a4cc47b3edb0e43a25a5237d0f5b26360">00384</a>             function                <a class="code" href="classpage__access__1__0__0.html#a4cc47b3edb0e43a25a5237d0f5b26360">select</a>( $Start , $Limit , $Field = <span class="keyword">false</span> , $Order = <span class="keyword">false</span> , $Condition = <span class="keyword">false</span> )
<a name="l00385"></a>00385             {
<a name="l00386"></a>00386                   <span class="keywordflow">try</span>
<a name="l00387"></a>00387                   {
<a name="l00388"></a>00388                         $ListOfPages = $this-&gt;<a class="code" href="classpage__access__1__0__0.html#aab08cbde456d1bc21e97c47eac85fe6d">get_list_of_pages</a>();
<a name="l00389"></a>00389                         
<a name="l00390"></a>00390                         $Lang = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;lang&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00391"></a>00391                         $ListOfPages = $Lang-&gt;process_object( $ListOfPages );
<a name="l00392"></a>00392                         
<a name="l00393"></a>00393                         <span class="keywordflow">if</span>( $Order !== <span class="keyword">false</span> )
<a name="l00394"></a>00394                         {
<a name="l00395"></a>00395                               $SortSign = $Order === <span class="stringliteral">&#39;ascending&#39;</span> ? <span class="charliteral">&#39;&lt;&#39;</span> : <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l00396"></a>00396                               $SortFunc = create_function( 
<a name="l00397"></a>00397                                     <span class="stringliteral">&#39;$a , $b&#39;</span> , <span class="stringliteral">&quot;if( \$a[ &#39;$Field&#39; ] == \$b[ &#39;$Field&#39; ] )&quot;</span>.
<a name="l00398"></a>00398                                           <span class="stringliteral">&quot;return(0);return( \$a[ &#39;$Field&#39; ] $SortSign \$b[ &#39;$Field&#39; ] ? -1 : 1 );&quot;</span>
<a name="l00399"></a>00399                               );
<a name="l00400"></a>00400                               usort( $ListOfPages , $SortFunc );
<a name="l00401"></a>00401                         }
<a name="l00402"></a>00402                         
<a name="l00403"></a>00403                         $Ret = array();
<a name="l00404"></a>00404                         
<a name="l00405"></a>00405                         $SearchString = $this-&gt;Security-&gt;get_gp( <span class="stringliteral">&#39;search_string&#39;</span> , <span class="stringliteral">&#39;string&#39;</span> , <span class="stringliteral">&#39;&#39;</span> );
<a name="l00406"></a>00406                         
<a name="l00407"></a>00407                         $c = 0;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409                         <span class="keywordflow">foreach</span>( $ListOfPages as $i =&gt; $l )
<a name="l00410"></a>00410                         {
<a name="l00411"></a>00411                               <span class="keywordflow">if</span>( $SearchString !== <span class="stringliteral">&#39;&#39;</span> )
<a name="l00412"></a>00412                               {
<a name="l00413"></a>00413                                     <span class="keywordflow">if</span>( !( strpos( $l[ <span class="stringliteral">&#39;title&#39;</span> ] , $SearchString ) !== <span class="keyword">false</span> || 
<a name="l00414"></a>00414                                           strpos( $l[ <span class="stringliteral">&#39;alias&#39;</span> ] , $SearchString ) !== <span class="keyword">false</span> || 
<a name="l00415"></a>00415                                           strpos( $l[ <span class="stringliteral">&#39;template&#39;</span> ] , $SearchString ) !== <span class="keyword">false</span> || 
<a name="l00416"></a>00416                                           strpos( $l[ <span class="stringliteral">&#39;template_version&#39;</span> ] , $SearchString ) !== <span class="keyword">false</span> ) )
<a name="l00417"></a>00417                                     {
<a name="l00418"></a>00418                                           <span class="keywordflow">continue</span>;
<a name="l00419"></a>00419                                     }
<a name="l00420"></a>00420                               }
<a name="l00421"></a>00421                               <span class="keywordflow">if</span>( $c &lt; $Limit )
<a name="l00422"></a>00422                               {
<a name="l00423"></a>00423                                     $Ret [] = $l;
<a name="l00424"></a>00424                                     $c++;
<a name="l00425"></a>00425                               }
<a name="l00426"></a>00426                         }
<a name="l00427"></a>00427                         
<a name="l00428"></a>00428                         <span class="keywordflow">return</span>( $Ret );
<a name="l00429"></a>00429                   }
<a name="l00430"></a>00430                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00431"></a>00431                   {
<a name="l00432"></a>00432                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00433"></a>00433                   }
<a name="l00434"></a>00434             }
<a name="l00435"></a>00435             
<a name="l00469"></a><a class="code" href="classpage__access__1__0__0.html#a7afcd2100d401a403e1166757d858741">00469</a>             function                <a class="code" href="classpage__access__1__0__0.html#a7afcd2100d401a403e1166757d858741">get_page_description</a>( $PageName )
<a name="l00470"></a>00470             {
<a name="l00471"></a>00471                   <span class="keywordflow">try</span>
<a name="l00472"></a>00472                   {
<a name="l00473"></a>00473                         $PageName = $this-&gt;Security-&gt;get( $PageName , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00474"></a>00474                         $CachedMultyFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00475"></a>00475                         <span class="keywordflow">if</span>( $CachedMultyFS-&gt;file_exists( dirname( __FILE__ ).<span class="stringliteral">&#39;/data/&#39;</span>.$PageName ) )
<a name="l00476"></a>00476                         {
<a name="l00477"></a>00477                               $RawPage = $CachedMultyFS-&gt;file_get_contents( dirname( __FILE__ ).<span class="stringliteral">&#39;/data/&#39;</span>.$PageName );
<a name="l00478"></a>00478                         }
<a name="l00479"></a>00479                         <span class="keywordflow">else</span>
<a name="l00480"></a>00480                         {
<a name="l00481"></a>00481                               <span class="keywordflow">return</span>( <span class="keyword">false</span> );
<a name="l00482"></a>00482                         }
<a name="l00483"></a>00483                         
<a name="l00484"></a>00484                         $RawPage = explode( <span class="charliteral">&#39;#&#39;</span> , $RawPage );
<a name="l00485"></a>00485                         <span class="keywordflow">if</span>( count( $RawPage ) === 3 )
<a name="l00486"></a>00486                         {
<a name="l00487"></a>00487                               $RawPage[ 3 ] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00488"></a>00488                         }
<a name="l00489"></a>00489                         
<a name="l00490"></a>00490                         $Page = array( 
<a name="l00491"></a>00491                               <span class="stringliteral">&#39;title&#39;</span> =&gt; $RawPage[ 0 ] , <span class="stringliteral">&#39;alias&#39;</span> =&gt; $PageName , 
<a name="l00492"></a>00492                               <span class="stringliteral">&#39;template&#39;</span> =&gt; $RawPage[ 1 ] , <span class="stringliteral">&#39;template_version&#39;</span> =&gt; $RawPage[ 2 ] , <span class="stringliteral">&#39;options&#39;</span> =&gt; $RawPage[ 3 ]
<a name="l00493"></a>00493                         );
<a name="l00494"></a>00494                         
<a name="l00495"></a>00495                         <span class="keywordflow">return</span>( $Page );
<a name="l00496"></a>00496                   }
<a name="l00497"></a>00497                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00498"></a>00498                   {
<a name="l00499"></a>00499                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00500"></a>00500                   }
<a name="l00501"></a>00501             }
<a name="l00502"></a>00502             
<a name="l00525"></a><a class="code" href="classpage__access__1__0__0.html#aafb017c2ffb4139c57613471a685ed45">00525</a>             function                <a class="code" href="classpage__access__1__0__0.html#aafb017c2ffb4139c57613471a685ed45">page_exists</a>( $PageName )
<a name="l00526"></a>00526             {
<a name="l00527"></a>00527                   <span class="keywordflow">try</span>
<a name="l00528"></a>00528                   {
<a name="l00529"></a>00529                         $PageName = $this-&gt;Security-&gt;get( $PageName , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00530"></a>00530 
<a name="l00531"></a>00531                         $CachedFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00532"></a>00532                         
<a name="l00533"></a>00533                         <span class="keywordflow">return</span>( $CachedFS-&gt;file_exists( dirname( __FILE__ ).<span class="stringliteral">&quot;/data/&quot;</span>.$PageName ) );
<a name="l00534"></a>00534                   }
<a name="l00535"></a>00535                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00536"></a>00536                   {
<a name="l00537"></a>00537                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00538"></a>00538                   }
<a name="l00539"></a>00539             }
<a name="l00540"></a>00540             
<a name="l00579"></a><a class="code" href="classpage__access__1__0__0.html#ac1cabbba085c14178e840bf25a574163">00579</a>             function                <a class="code" href="classpage__access__1__0__0.html#ac1cabbba085c14178e840bf25a574163">create</a>( $Record )
<a name="l00580"></a>00580             {
<a name="l00581"></a>00581                   <span class="keywordflow">try</span>
<a name="l00582"></a>00582                   {
<a name="l00583"></a>00583                         $PageName = $this-&gt;Security-&gt;get( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Record , <span class="stringliteral">&#39;page_alias&#39;</span> ) , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00584"></a>00584                         
<a name="l00585"></a>00585                         <span class="keywordflow">if</span>( $this-&gt;<a class="code" href="classpage__access__1__0__0.html#aafb017c2ffb4139c57613471a685ed45">page_exists</a>( $PageName ) )
<a name="l00586"></a>00586                         {
<a name="l00587"></a>00587                               <span class="keywordflow">return</span>( $PageName );
<a name="l00588"></a>00588                         }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590                         $Title = $this-&gt;Security-&gt;get( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Record , <span class="stringliteral">&#39;page_title&#39;</span> ) , <span class="stringliteral">&#39;string&#39;</span> );
<a name="l00591"></a>00591                         $Template = $this-&gt;Security-&gt;get( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Record , <span class="stringliteral">&#39;page_template&#39;</span> ) , <span class="stringliteral">&#39;string&#39;</span> );
<a name="l00592"></a>00592                         $TemplateVersion = <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Record , <span class="stringliteral">&#39;page_template_version&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> );
<a name="l00593"></a>00593                         $TemplateVersion = $this-&gt;Security-&gt;get( $TemplateVersion , <span class="stringliteral">&#39;string&#39;</span> );
<a name="l00594"></a>00594                         $Settings = $this-&gt;Security-&gt;get( <a class="code" href="functional__programming_8php.html#a113f39218a0e805d475fbc5ab87a16ab">get_field</a>( $Record , <span class="stringliteral">&#39;page_predefined_packages&#39;</span>,  <span class="stringliteral">&#39;&#39;</span> ) , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00595"></a>00595                         $Settings = $Settings == <span class="stringliteral">&#39;on&#39;</span> ? <span class="stringliteral">&#39;predefined_packages=1&#39;</span> : <span class="stringliteral">&#39;predefined_packages=0&#39;</span>;
<a name="l00596"></a>00596                         
<a name="l00597"></a>00597                         $CachedMultyFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00598"></a>00598                         
<a name="l00599"></a>00599                         $Page = <span class="stringliteral">&quot;$Title#$Template#$TemplateVersion#$Settings&quot;</span>;
<a name="l00600"></a>00600                         $CachedMultyFS-&gt;file_put_contents( dirname( __FILE__ ).<span class="stringliteral">&quot;/data/&quot;</span>.$PageName , $Page );
<a name="l00601"></a>00601                         $CachedMultyFS-&gt;file_put_contents( dirname( __FILE__ ).<span class="stringliteral">&quot;/data/pa_&quot;</span>.$PageName , <span class="stringliteral">&#39;&#39;</span> );
<a name="l00602"></a>00602                         
<a name="l00603"></a>00603                         <span class="keywordflow">return</span>( $PageName );
<a name="l00604"></a>00604                   }
<a name="l00605"></a>00605                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00606"></a>00606                   {
<a name="l00607"></a>00607                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00608"></a>00608                   }
<a name="l00609"></a>00609             }
<a name="l00610"></a>00610             
<a name="l00645"></a><a class="code" href="classpage__access__1__0__0.html#af76190723984429f8bdee6e3e772132f">00645</a>             function                <a class="code" href="classpage__access__1__0__0.html#af76190723984429f8bdee6e3e772132f">update</a>( $PageName , $Title , $Template , $TemplateVersion , $PredefinedPackages )
<a name="l00646"></a>00646             {
<a name="l00647"></a>00647                   <span class="keywordflow">try</span>
<a name="l00648"></a>00648                   {
<a name="l00649"></a>00649                         print_r( 1 );
<a name="l00650"></a>00650                         exit( 0 );
<a name="l00651"></a>00651                         <span class="comment">/*$PageName = $this-&gt;Security-&gt;get( $PageName , &#39;command&#39; );</span>
<a name="l00652"></a>00652 <span class="comment">                        $Page = $this-&gt;get_page_description( $PageName );</span>
<a name="l00653"></a>00653 <span class="comment">                        </span>
<a name="l00654"></a>00654 <span class="comment">                        $Title = $this-&gt;Security-&gt;get( $Title , &#39;string&#39; );</span>
<a name="l00655"></a>00655 <span class="comment">                        $Template = $this-&gt;Security-&gt;get( $Template , &#39;string&#39; );</span>
<a name="l00656"></a>00656 <span class="comment">                        $TemplateVersion = $this-&gt;Security-&gt;get( $TemplateVersion , &#39;command&#39; );</span>
<a name="l00657"></a>00657 <span class="comment">                        $PredefinedPackages = $this-&gt;Security-&gt;get( $PredefinedPackages , &#39;string&#39; );</span>
<a name="l00658"></a>00658 <span class="comment">                        </span>
<a name="l00659"></a>00659 <span class="comment">                        $Title = $Title == &#39;_no_update&#39; ? $Page[ &#39;title&#39; ] : $Title;</span>
<a name="l00660"></a>00660 <span class="comment">                        $Template = $Template == &#39;_no_update&#39; ? $Page[ &#39;template&#39; ] : $Template;</span>
<a name="l00661"></a>00661 <span class="comment">                        $TemplateVersion = $TemplateVersion == &#39;_no_update&#39; ? $Page[ &#39;template_version&#39; ] : $TemplateVersion;</span>
<a name="l00662"></a>00662 <span class="comment">                        $Options = $PredefinedPackages == &#39;_no_update&#39; ? $Page[ &#39;predefinded_packages&#39; ] : $PredefinedPackages;</span>
<a name="l00663"></a>00663 <span class="comment">                        </span>
<a name="l00664"></a>00664 <span class="comment">                        $CachedFS = get_package( &#39;cached_multy_fs&#39; , &#39;last&#39; , __FILE__ );</span>
<a name="l00665"></a>00665 <span class="comment">                        $CachedFS-&gt;file_put_contents( </span>
<a name="l00666"></a>00666 <span class="comment">                              dirname( __FILE__ ).&quot;/data/$PageName&quot; , &quot;$Title#$Template#$TemplateVersion#$Options&quot;</span>
<a name="l00667"></a>00667 <span class="comment">                        );*/</span>
<a name="l00668"></a>00668                   }
<a name="l00669"></a>00669                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00670"></a>00670                   {
<a name="l00671"></a>00671                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00672"></a>00672                   }
<a name="l00673"></a>00673             }
<a name="l00674"></a>00674             
<a name="l00693"></a><a class="code" href="classpage__access__1__0__0.html#a52600716168ecf7fc762c3e4d1edd988">00693</a>             function                <span class="keyword">delete</span>( $PageNames )
<a name="l00694"></a>00694             {
<a name="l00695"></a>00695                   <span class="keywordflow">try</span>
<a name="l00696"></a>00696                   {
<a name="l00697"></a>00697                         $PageNames = explode( <span class="charliteral">&#39;,&#39;</span> , $PageNames );
<a name="l00698"></a>00698                         
<a name="l00699"></a>00699                         <span class="keywordflow">foreach</span>( $PageNames as $i =&gt; $PageName )
<a name="l00700"></a>00700                         {
<a name="l00701"></a>00701                               $PageName = $this-&gt;Security-&gt;get( $PageName , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00702"></a>00702                               
<a name="l00703"></a>00703                               @unlink( dirname( __FILE__ ).<span class="stringliteral">&#39;/data/&#39;</span>.$PageName );
<a name="l00704"></a>00704                               @unlink( dirname( __FILE__ ).<span class="stringliteral">&#39;/data/pa_&#39;</span>.$PageName );
<a name="l00705"></a>00705                               
<a name="l00706"></a>00706                               $EventManager = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;event_manager&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00707"></a>00707                               $EventManager-&gt;trigger_event( <span class="stringliteral">&#39;on_after_delete_page&#39;</span> , array( <span class="stringliteral">&#39;page_name&#39;</span> =&gt; $PageName ) );
<a name="l00708"></a>00708                         }
<a name="l00709"></a>00709                   }
<a name="l00710"></a>00710                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00711"></a>00711                   {
<a name="l00712"></a>00712                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00713"></a>00713                   }
<a name="l00714"></a>00714             }
<a name="l00715"></a>00715             
<a name="l00750"></a><a class="code" href="classpage__access__1__0__0.html#ac7f85f7bdc71e6c396225fe07fa502ac">00750</a>             function                <a class="code" href="classpage__access__1__0__0.html#ac7f85f7bdc71e6c396225fe07fa502ac">add_package</a>( $PageName , $PackageName , $PackageVersion , $Params , $PlaceHolder )
<a name="l00751"></a>00751             {
<a name="l00752"></a>00752                   <span class="keywordflow">try</span>
<a name="l00753"></a>00753                   {
<a name="l00754"></a>00754                         $PageName = $this-&gt;Security-&gt;get( $PageName , <span class="stringliteral">&#39;command&#39;</span> );
<a name="l00755"></a>00755                         
<a name="l00756"></a>00756                         $CachedFS = <a class="code" href="core__public__api_8php.html#a3ba50cf690fa88e981b38b4779f18759">get_package</a>( <span class="stringliteral">&#39;cached_multy_fs&#39;</span> , <span class="stringliteral">&#39;last&#39;</span> , __FILE__ );
<a name="l00757"></a>00757                         $CachedFS-&gt;file_put_contents( 
<a name="l00758"></a>00758                               dirname( __FILE__ ).<span class="stringliteral">&#39;/data/pa_&#39;</span>.$PageName , 
<a name="l00759"></a>00759                               $PackageName.<span class="charliteral">&#39;#&#39;</span>.$PackageVersion.<span class="charliteral">&#39;#&#39;</span>.$Params.<span class="charliteral">&#39;#&#39;</span>.$PlaceHolder.<span class="stringliteral">&quot;\r\n&quot;</span> , FILE_APPEND
<a name="l00760"></a>00760                         );
<a name="l00761"></a>00761                   }
<a name="l00762"></a>00762                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00763"></a>00763                   {
<a name="l00764"></a>00764                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00765"></a>00765                   }
<a name="l00766"></a>00766             }
<a name="l00767"></a>00767             
<a name="l00790"></a><a class="code" href="classpage__access__1__0__0.html#af2c08017e9bf058c2f8aedbda1bf73f6">00790</a>             function                <a class="code" href="classpage__access__1__0__0.html#af2c08017e9bf058c2f8aedbda1bf73f6">select_list</a>( $PageNames )
<a name="l00791"></a>00791             {
<a name="l00792"></a>00792                   <span class="keywordflow">try</span>
<a name="l00793"></a>00793                   {
<a name="l00794"></a>00794                         <span class="keywordflow">if</span>( is_string( $PageNames ) )
<a name="l00795"></a>00795                         {
<a name="l00796"></a>00796                               $PageNames = explode( <span class="charliteral">&#39;,&#39;</span> , $PageNames );
<a name="l00797"></a>00797                         }
<a name="l00798"></a>00798                         
<a name="l00799"></a>00799                         $Pages = array();
<a name="l00800"></a>00800                         
<a name="l00801"></a>00801                         <span class="keywordflow">foreach</span>( $PageNames as $i =&gt; $PageName )
<a name="l00802"></a>00802                         {
<a name="l00803"></a>00803                               $Pages [] = $this-&gt;<a class="code" href="classpage__access__1__0__0.html#a7afcd2100d401a403e1166757d858741">get_page_description</a>( $PageName );
<a name="l00804"></a>00804                         }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806                         <span class="keywordflow">return</span>( $Pages );
<a name="l00807"></a>00807                   }
<a name="l00808"></a>00808                   <span class="keywordflow">catch</span>( Exception $e )
<a name="l00809"></a>00809                   {
<a name="l00810"></a>00810                         $a = func_get_args();<a class="code" href="core__utilities_8php.html#abfba210aa5ad8e9a273b3342263c2961">_throw_exception_object</a>( __METHOD__ , $a , $e );
<a name="l00811"></a>00811                   }
<a name="l00812"></a>00812             }
<a name="l00813"></a>00813       }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Oct 3 2011 14:49:52 for ultimix by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
